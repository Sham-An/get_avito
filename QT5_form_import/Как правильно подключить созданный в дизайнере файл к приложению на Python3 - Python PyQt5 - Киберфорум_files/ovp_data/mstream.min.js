!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=16)}([function(t,e,i){"use strict";function n(){}function s(t,e,i,n){var s=document.createElement("iframe");return null!==e&&(s.src=e),s.width="100%",s.height="100%",s.referrerPolicy="unsafe-url",s.setAttribute("frameborder","0"),s.setAttribute("allow","autoplay"),s.setAttribute("scrolling","no"),s.setAttribute("frameborder","0"),s.setAttribute("marginheight","0px"),s.setAttribute("marginwidth","0px"),s.setAttribute("webkitallowfullscreen","true"),s.setAttribute("allowfullscreen","true"),s.setAttribute("mozallowfullscreen","true"),"function"==typeof n&&(s.onload=n.bind(this,s)),r(s),i&&(s.style.zIndex=i),s.setAttribute("SCROLLING","NO"),t.appendChild(s),s}function r(t){t&&(t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.margin="0px",t.style.padding="0px",t.style.border="none",t.style.width="100%",t.style.height="100%")}function o(t,e){return Object.keys(e).forEach((function(i){var n="object"==typeof n?JSON.stringify(e[i]):e[i];t=t.replace(new RegExp("{{"+i+"}}","g"),n)})),t}function a(t,e){var i=t.contentWindow&&t.contentWindow.document;return!!i&&(setTimeout((function(){i.open(),i.write(e),i.close()}),100),!0)}t.exports={noop:n,validate:function(t,e){return t?null:new Error(e)},callbackTimeout:function(t,e,i){var s;return s=setTimeout((function(){e=n,i()}),t),function(){e.apply(this,arguments)&&clearTimeout(s)}},createElementInEl:function(t,e,i){if(void 0!==t){var n=document.createElement(e);return i&&(n.id=i),t.appendChild(n),n}},createIframeWithContent:function(t,e,i){var n,r;return s(t,null,i.zIndex,(n=function(t){a(t,o(e,i))},function(){return n&&(r=n.apply(this,arguments),n=null),r}))},createIframe:s,setFullSizeStyle:r,simpleTemplate:o,setIframeContent:a,extend:function(t,e){return Object.keys(e).forEach((function(i){t[i]=e[i]})),t},unique:function(t){var e=-1;return function(){return t+"_"+ ++e}}}},function(t,e,i){var n=i(2),s=i(3);function r(t,e){this.w=void 0!==t?t:window,this.volUp=null,this.volDown=null,this.volContainer=null,this.adPaused=!1,this.lastTag=0,this.impsCount=0,this.impressedTags=[],this.visibility=0,this.startFlag=!1,this.stageCallback=null,this.usingOurVideoElem=!1,this.haveDirectAds=!1,this.directAdsPlayed=!1,this.messagePort=null,this.currentPartner={tag:null,id:0,mvt:null,fl:!1,tmts:{evt:30,int:30,sti:30},platform:"desktop"},this.lastEvent=null,this.errorState=!1,this.preloader=null,this.vastLoader=null,this.vastTracker=null,this.vastLoaderOptions={withCredentials:!0,resolveAll:!1,timeout:15e3},this.initTimeout=3e4,this.startToImpTimeout=3e4,this.videoSubscribed=!1,this.countdownTimer=null,this.currentAdType=null,this.currentAdId=null,this.volumeRetries=5,this.volumeConfig={volume:0,muted:!0},this.ads=[],this.adUnit=null,this.vpClient=null,this.listeners={},this.videoEvents=["abort","canplay","canplaythrought","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","playing","ratechange","seeked","stalled","volumechange","waiting"],this.subscribeToVideoEvents=function(t){"b"in t&&-1!=t.b.indexOf("goog")||"true"!=t.getAttribute("videoSubscribed")&&(t.setAttribute("videoSubscribed","true"),this.videoEvents.forEach(function(e){t.addEventListener(e,function(i){this.log("VPAID Video Event",e),"volumechange"==i.type&&(this.logger("video_volume_change",t.volume),this.log("VOLUME CHANGE!",t.volume)),"canplay"==i.type&&(this.log("video elem params",t.readyState,t.paused,t.volume,t.muted,t.src),this.currentAdType="vpaid_video",t.style.display="",t.duration%60>=5&&(this.haveDirectAds=!0,this.callStageFn("sendStageManagerMessage",[this.HAVE_DIRECT_ADS]),this.log("Probably direct ad received, src: ",t.src),this.logger("direct_ads",t.src,void 0,void 0,!0)),t.paused&&t.volume>0&&t.muted)}.bind(this))}.bind(this)))},this.log=function(){if(this.config.debug||this.config.showLog){var t=["%cMOVIEADS-stagePlayer ["+this.config.stageNum+"]: ","background-color: blue; color: white; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}else if(this.config.logall){var i=["init module","vpaid module","adUnit"];if(e=Array.prototype.slice.call(arguments),-1!=i.indexOf(e[0]))return;this.logger("logger1","movieads_ima",JSON.stringify(e))}},this.getCreativeType=function(t){return"type"in t?t.type:"mimeType"in t?t.mimeType:null},this.getVPAIDMedia=function(t){var e=null;return t.forEach(function(t){-1!=this.getCreativeType(t).indexOf("javascript")&&"VPAID"==t.apiFramework&&(e=t)}.bind(this)),null==e&&t.forEach(function(t){"js"==t.fileURL.split(/[#?]/)[0].split(".").pop().trim()&&(e=t)}.bind(this)),e},this.vpaidModule=null,this.AD_ERROR="movieads_error",this.AD_SKIP="movieads_ad_skip",this.AD_CLICK="movieads_ad_click",this.AD_NOADS="movieads_no_ads",this.AD_IMP="movieads_ad_imp",this.AD_FQ="movieads_ad_fq",this.AD_MP="movieads_ad_mp",this.AD_TQ="movieads_ad_tq",this.AD_COMP="movieads_ad_complete",this.AD_VSTART="movieads_ad_vstart",this.MOVIEADS_MODULE_READY="movieads_ready",this.AD_ROLL_COMP="movieads_ad_roll_complete",this.HAVE_DIRECT_ADS="movieads_have_direct_ads",this.config={autoplay:!0,mute:!0,volume:0,tags:[],proxyVideo:null,videoContainer:"contentElement",key:null,vastUrl:"",slot:null,debug:!1,mips:50,session:null,logall:!1,frameId:null,friendly:!0,disableLogger:!0,pxy:!1,fle:[]},this.showPreloader=function(){},this.hidePreloader=function(){},this.showVolContainer=function(){let t="close0"in this.currentPartner.partner&&0==this.currentPartner.partner.close0||!("close0"in this.currentPartner.partner);this.currentPartner.partner.dcont||t&&(this.volContainer.style.display="")},this.hideVolContainer=function(){this.currentPartner.partner.dcont||(this.volContainer.style.display="none")},this.initVisibilityTracker=function(){"undefined"!=typeof IntersectionObserver&&new IntersectionObserver(function(t){for(var e in t){var i=t[e];"NaN"!=Math.floor(100*i.intersectionRatio).toString()&&(this.visibility=Math.floor(100*i.intersectionRatio),this.log("PLAYER VISIBLE: "+this.visibility.toString()))}}.bind(this),{threshold:[0,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1],trackVisibility:!0,delay:100}).observe(this.w.document.body)},this.initVolumeControl=function(){this.config.currentPartner.dcont||(this.volContainer=this.w.document.createElement("div"),this.volContainer.style.position="absolute",this.volContainer.style.zIndex="99999",this.volContainer.style.left="15px",this.volContainer.style.bottom="15px",this.volContainer.style.width="48px",this.volContainer.style.height="48px",this.volContainer.style.display="none",this.volContainer.setAttribute("class","volcontrol"),this.volDown=this.w.document.createElement("img"),this.volDown.src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGhlaWdodD0iMTAwJSIgc3R5bGU9InNoYXBlLXJlbmRlcmluZzpnZW9tZXRyaWNQcmVjaXNpb247IHRleHQtcmVuZGVyaW5nOmdlb21ldHJpY1ByZWNpc2lvbjsgaW1hZ2UtcmVuZGVyaW5nOm9wdGltaXplUXVhbGl0eTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IGNsaXAtcnVsZTpldmVub2RkIiB2aWV3Qm94PSIwIDAgMTc3ODAwIDE3NzgwMCIgd2lkdGg9IjEwMCUiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgIDwhW0NEQVRBWwogICAgLmZpbDAge2ZpbGw6I0ZGNDE0MX0KICAgIC5maWwxIHtmaWxsOndoaXRlfQogICBdXT4KICA8L3N0eWxlPjwvZGVmcz48ZyBpZD0i5Zu+5bGCX3gwMDIwXzEiPjxjaXJjbGUgY2xhc3M9ImZpbDAiIGN4PSI4ODkwMCIgY3k9Ijg4OTAwIiByPSI4ODkwMSIvPjxnIGlkPSJfMTM2OTUyNDgwIj48cGF0aCBjbGFzcz0iZmlsMSIgZD0iTTU0ODM4IDYwNTQ4bDQxMDU0IC0yNjA4OGMxNTkyLC0xMDEyIDM1OTEsLTM5OCA1MTM3LDY4NyAxNTQ1LDEwODYgMjM4OCwyNzEyIDIzODgsNDYwMWwwIDk4MzM1YzAsMTg4OSAtODQzLDM1MTMgLTIzODgsNDU5OSAtMTU0NiwxMDg1IC0zNTQ1LDE2MzIgLTUxMzcsNjg4bC00MTA1NCAtMjYwOTFjLTUzMiwtMzM5IC0xMjgzLC0zMzMgLTE5MDcsLTMzM2wtMTc2NzggMGMtMzAxMCwwIC01NjE5LC0yNTI2IC01NjE5LC01NjIxbDAgLTQ0ODI0YzAsLTMwOTUgMjUyOSwtNTYyMCA1NjE5LC01NjIwbDE3Njc4IDBjNjgwLDAgMTMyMywxMyAxOTA3LC0zMzN6IiBpZD0iXzEzNjk1MjY0OCIvPjxwYXRoIGNsYXNzPSJmaWwxIiBkPSJNMTMzOTk3IDkxODAwbDI4NiAtMjg3bTIyNDkgLTIyNDhsMjg2IC0yODhtLTYwNTEgLTYwNTFsLTI4OCAyODZtLTIyNDggMjI0OWwtMjg3IDI4Nm0xNjQzOSAtNDMzNWwtMTg2NCAxODY0IC01NzAxIDU3MDEgLTE4NjMgMTg2NSAtMjg3IDI4NyAtMzg1IDM4NCAtMTg2NCAxODY0IC0yODYgMjg3IC02OTEyIDY5MTEgLTE4NjUgMTg2NCAtNjcxIDY3MSAtMTg2NCAxODY0Yy0xNjYzLDE2NjUgLTQzODcsMTY2NSAtNjA1MSwwbDAgMGMtMTY2NSwtMTY2NCAtMTY2NSwtNDM4OCAwLC02MDUxbDE4NjQgLTE4NjQgNjcxIC02NzIgMTg2NCAtMTg2NCA2OTExIC02OTEyIDI4NiAtMjg2IDE4NjUgLTE4NjQgMzg0IC0zODUgMjg3IC0yODcgMTg2NSAtMTg2MyA1NzAxIC01NzAxIDE4NjQgLTE4NjUgNjcxIC02NzEgMTg2NCAtMTg2NGMxNjYyLC0xNjYyIDQzODcsLTE2NjUgNjA1MiwwbDAgMGMxNjY0LDE2NjUgMTY2NCw0Mzg4IDAsNjA1MWwtMTg2NCAxODY1IC02NzIgNjcxeiIgaWQ9Il8xMzY5NTI1NzYiLz48cGF0aCBjbGFzcz0iZmlsMSIgZD0iTTEzMzc0NCA4NTc0N2wtMjg4IC0yODZtLTIyNDggLTIyNDlsLTI4NyAtMjg2bS02MDUxIDYwNTFsMjg2IDI4OG0yMjQ5IDIyNDhsMjg2IDI4N20tNDMzNSAtMTY0NDBsMTg2NCAxODY1IDU3MDEgNTcwMSAxODY1IDE4NjMgMjg3IDI4NyAzODMgMzg1IDE4NjUgMTg2NCAyODcgMjg2IDY5MTAgNjkxMiAxODY1IDE4NjQgNjcxIDY3MiAxODY0IDE4NjRjMTY2NSwxNjYzIDE2NjUsNDM4NyAwLDYwNTFsMCAwYy0xNjY1LDE2NjUgLTQzODgsMTY2NSAtNjA1MSwwbC0xODY1IC0xODY0IC02NzEgLTY3MSAtMTg2NCAtMTg2NCAtNjkxMiAtNjkxMSAtMjg3IC0yODcgLTE4NjMgLTE4NjQgLTM4NSAtMzg0IC0yODcgLTI4NyAtMTg2MyAtMTg2NSAtNTcwMiAtNTcwMSAtMTg2NCAtMTg2NCAtNjcxIC02NzEgLTE4NjQgLTE4NjVjLTE2NjIsLTE2NjEgLTE2NjUsLTQzODYgMCwtNjA1MWwwIDBjMTY2NSwtMTY2NSA0Mzg4LC0xNjY1IDYwNTEsMGwxODY0IDE4NjQgNjcyIDY3MXoiIGlkPSJfMTM2OTUyNTA0Ii8+PC9nPjwvZz48L3N2Zz4=",this.volDown.setAttribute("width","48"),this.volDown.setAttribute("height","48"),this.volDown.style.cursor="pointer",this.volUp=this.w.document.createElement("img"),this.volUp.src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGhlaWdodD0iMTAwJSIgc3R5bGU9InNoYXBlLXJlbmRlcmluZzpnZW9tZXRyaWNQcmVjaXNpb247IHRleHQtcmVuZGVyaW5nOmdlb21ldHJpY1ByZWNpc2lvbjsgaW1hZ2UtcmVuZGVyaW5nOm9wdGltaXplUXVhbGl0eTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IGNsaXAtcnVsZTpldmVub2RkIiB2aWV3Qm94PSIwIDAgMTc3ODAwIDE3NzgwMCIgd2lkdGg9IjEwMCUiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgIDwhW0NEQVRBWwogICAgLmZpbDEge2ZpbGw6d2hpdGV9CiAgICAuZmlsMCB7ZmlsbDojMTc4RkVCO2ZpbGwtcnVsZTpub256ZXJvfQogICAgLmZpbDIge2ZpbGw6d2hpdGU7ZmlsbC1ydWxlOm5vbnplcm99CiAgIF1dPgogIDwvc3R5bGU+PC9kZWZzPjxnIGlkPSLlm77lsYJfeDAwMjBfMSI+PHBhdGggY2xhc3M9ImZpbDAiIGQ9Ik04ODg5OSAwYzI0NTQ0LDAgNDY3NjksOTk1NCA2Mjg1OCwyNjA0MiAxNjA4OSwxNjA4OCAyNjA0MywzODMxMyAyNjA0Myw2Mjg1NyAwLDI0NTQzIC05OTU0LDQ2NzcxIC0yNjA0Myw2Mjg1OCAtMTYwODcsMTYwODkgLTM4MzE1LDI2MDQzIC02Mjg1OCwyNjA0MyAtMjQ1NDQsMCAtNDY3NjksLTk5NTQgLTYyODU3LC0yNjA0MyAtMTYwODgsLTE2MDg5IC0yNjA0MiwtMzgzMTQgLTI2MDQyLC02Mjg1OCAwLC0yNDU0MSA5OTU0LC00Njc2OSAyNjA0MiwtNjI4NTcgMTYwODgsLTE2MDg4IDM4MzE2LC0yNjA0MiA2Mjg1NywtMjYwNDJ6Ii8+PGcgaWQ9Il8xMzY5NTI3OTIiPjxwYXRoIGNsYXNzPSJmaWwxIiBkPSJNNTM3MDkgNjE4MThsMzkyMTggLTI0OTIyYzE1MjAsLTk2NyAzNDMwLC0zODAgNDkwNiw2NTcgMTQ3NywxMDM3IDIyODIsMjU5MCAyMjgyLDQzOTRsMCA5MzkzNWMwLDE4MDQgLTgwNSwzMzU2IC0yMjgyLDQzOTMgLTE0NzYsMTAzNyAtMzM4NiwxNTU5IC00OTA2LDY1N2wtMzkyMTggLTI0OTIzYy01MDgsLTMyNCAtMTIyNSwtMzE4IC0xODIxLC0zMThsLTE2ODg3IDBjLTI4NzUsMCAtNTM2NywtMjQxMyAtNTM2NywtNTM3MGwwIC00MjgxNmMwLC0yOTU2IDI0MTUsLTUzNjkgNTM2NywtNTM2OWwxNjg4NyAwYzY1MCwwIDEyNjQsMTIgMTgyMSwtMzE4eiIgaWQ9Il8xMzY5NTI5NjAiLz48cGF0aCBjbGFzcz0iZmlsMiIgZD0iTTExMTYxNSA2MTM3MmMtMTcxOSwtMTQ1NSAtMTkzNCwtNDAzMCAtNDc4LC01NzUwIDE0NTUsLTE3MTkgNDAyOSwtMTkzNCA1NzQ5LC00NzggNDk3NSw0MTk3IDg5MDQsOTM5NiAxMTU4OCwxNTE3MiAyNjg0LDU3NzUgNDEyMywxMjEyMSA0MTIzLDE4NjIzIDAsNjQ3NiAtMTQzMCwxMjgwNSAtNDA5OCwxODU2OSAtMjY2NSw1NzU5IC02NTcyLDEwOTQ4IC0xMTUxOSwxNTE0OCAtMTcyMCwxNDU1IC00Mjk1LDEyNDAgLTU3NTAsLTQ3OSAtMTQ1NSwtMTcyMCAtMTI0MSwtNDI5NSA0NzksLTU3NTAgNDAyOCwtMzQxOCA3MjEwLC03NjQ1IDkzNzksLTEyMzM2IDIxNjksLTQ2ODUgMzMzMiwtOTg0OSAzMzMyLC0xNTE1MiAwLC01MzI0IC0xMTcyLC0xMDUwNSAtMzM1NiwtMTUyMDYgLTIxODMsLTQ2OTkgLTUzODcsLTg5MzQgLTk0NDksLTEyMzYxeiIgaWQ9Il8xMzY5NTI4ODgiLz48cGF0aCBjbGFzcz0iZmlsMiIgZD0iTTExOTUwNyA0OTU0NWMtMTg1MiwtMTI3OSAtMjMxNywtMzgxNyAtMTAzOCwtNTY2OSAxMjc4LC0xODUyIDM4MTcsLTIzMTcgNTY2OSwtMTAzOCA2Nzg3LDQ3MDUgMTIzNTgsMTA3ODEgMTY0MTMsMTc3MjEgNDA0OSw2OTMyIDY2MDcsMTQ3NjkgNzM3NSwyMzAwMiA5NDYsMTAxNDQgLTkwNywyMDE0MyAtNTEwMiwyOTAyOSAtNDE5NSw4ODg0IC0xMDc0NCwxNjY3MCAtMTkxODQsMjIzODcgLTE4NTksMTI2MSAtNDM5MSw3NzQgLTU2NTIsLTEwODUgLTEyNjEsLTE4NjAgLTc3NSwtNDM5MiAxMDg1LC01NjUzIDcxOTMsLTQ4NzIgMTI3ODMsLTExNTI2IDE2MzczLC0xOTEzMSAzNTkwLC03NjA0IDUxNzcsLTE2MTUwIDQzNjksLTI0ODEzIC02NTEsLTY5NzcgLTI4NDQsLTEzNjYyIC02MzIzLC0xOTYxNyAtMzQ3NiwtNTk1MCAtODIyMywtMTExMzggLTEzOTg1LC0xNTEzM3oiIGlkPSJfMTM2OTUyODE2Ii8+PC9nPjwvZz48L3N2Zz4=",this.volUp.setAttribute("width","48"),this.volUp.setAttribute("height","48"),this.volUp.style.cursor="pointer",this.volUp.style.display="none",this.volDown.addEventListener("click",function(){this.setAdVolume(0,!0),this.volDown.style.display="none",this.volUp.style.display="",this.logger("mute_ad","",void 0,void 0,!0)}.bind(this)),this.volUp.addEventListener("click",function(){this.setAdVolume(70,!0),this.volUp.style.display="none",this.volDown.style.display="",this.logger("unmute_ad","",void 0,void 0,!0)}.bind(this)),this.volContainer.appendChild(this.volDown),this.volContainer.appendChild(this.volUp),this.w.document.body.appendChild(this.volContainer))},this.initDebugMarker=function(){if(this.config.debug){let t=this.w.document.querySelector(".debugmarker");t.style.display="",t.innerHTML=this.config.stageNum}},this.initPreloader=function(){},this.resizeVpaid=function(t,e,i){-1!=["vpaid","vpaid_video"].indexOf(this.currentAdType)&&null!==this.adUnit&&this.adUnit.resizeAd(t,e,i)},this.setAdVolume=function(t,e){this.log("Setting Ad volume",t,e),this.volumeConfig.volume=t,this.volumeConfig.muted=0==t;var i=t>1?t/100:t;if("video"==this.currentAdType||"vpaid_video"==this.currentAdType)this.videoElem.player.volume=i,this.videoElem.player.muted=0==t,"vpaid"==this.currentAdType&&this.adUnit.setAdVolume(i,(function(t,e){}));else if("vpaid"==this.currentAdType&&null!==this.adUnit){if("volumeRetries"in this.adUnit||(this.adUnit.volumeRetries=this.volumeRetries),0==this.adUnit.volumeRetries&&void 0===e)return;0==this.adUnit.volumeRetries&&(this.adUnit.volumeRetries=this.volumeRetries),this.adUnit.setAdVolume(i,(function(t,e){})),this.w.setTimeout(function(){this.setAdVolume(i)}.bind(this),500),this.adUnit.volumeRetries--}},this.clearListeners=function(t,e){for(const[i,n]of Object.entries(e))n.forEach(e=>{t.removeEventListener(i,e)})},this.createVideoElem=function(t){this.usingOurVideoElem=!1;var e=this.w.document.getElementById("player-vpaid-wrapper");null!==e&&e.parentNode.removeChild(e);var i,n=this.w.document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="relative",n.style.top=0,n.style.left=0,n.setAttribute("id","player-vpaid-wrapper"),0==this.config.pxy?((i=this.w.document.createElement("video")).setAttribute("id","a"+(new Date).getTime().toString()),i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",i.preload="auto",i.addEventListener("play",function(){this.log("playing_video",this.currentPartner.id),this.usingOurVideoElem=!0}.bind(this))):i=this.config.proxyVideo;var s=this.volumeConfig.volume>1?this.volumeConfig.volume/100:this.volumeConfig.volume;i.volume=s,i.muted=0==s,"b"in i&&-1!=i.b.indexOf("goog")||(i.setAttribute("playsinline",""),i.playsInline=""),0==this.config.pxy&&n.appendChild(i),this.w.document.body.appendChild(n),this.log("Created video elem",n,i.smuted,i.muted,i.fmute,i.volume,i.ovol,i.svol),this.videoElem={player:i,wrapper:n};var r=this,o=1,a=!1;function l(){}["addEventListener","removeEventListener","canPlayType","load","play","pause","setAttribute"].forEach((function(t){l.prototype[t]=function(...e){if(r.log("calling proxy method, args",t,e),"addEventListener"!=t)return i[t].apply(i,e);{let t=t=>{let i=new Event(e[0]);e[1](i)};e[0]in r.listeners||(r.listeners[e[0]]=[]),r.listeners[e[0]].push(t),i.addEventListener(e[0],t)}}})),["currentTime","duration","ended","paused","playbackRate","src","type","readyState","networkState"].forEach((function(t){Object.defineProperty(l.prototype,t,{get:()=>i[t],set(e){i[t]=e}})})),new Proxy(i,{get:(t,e)=>"function"==typeof t[e]?function(...i){return r.log("calling proxy method, args",e,i),t[e].apply(t,i)}:"volume"==e?o:"muted"==e?a:t[e],set:(t,e,i)=>"volume"==e?(o=i,i):"muted"==e?(a=i,i):(t[e]=i,!0)}),this.log("PLATFORM",this.currentPartner.partner.platform,this.currentPartner.id);let c=i;return("mixed"==this.currentPartner.partner.ve&&"desktop"==this.currentPartner.partner.platform||"pxy"==this.currentPartner.partner.ve)&&(c=new l),{player:i,wrapper:n,proxy:c}},this.debounce=function(t,e){var i;return e=e||100,function(n){i&&clearTimeout(i),i=this.w.setTimeout(t,e,n)}.bind(this)},this.initSizeWatcher=function(){this.w.addEventListener("resize",this.debounce(function(){this.resizeVpaid(this.w.innerWidth,this.w.innerHeight,"normal")}.bind(this),200),!0)},this.initPinger=function(){this.log("PINGER WINDOW",document.body),setInterval(function(){this.vpaidModule.touch()}.bind(this),500)},this.init=function(t){this.initInterventionObserver(),this.fireClick(document.body);var e=t||{};if(this.config=this.extend(this.config,e),this.log("friendly",this.config.friendly),this.log("init module",t),this.log("DOCUMENT",document.body,window),this.log("PROXY VIDEO",this.config.proxyVideo),this.log("slot",this.config.slot),"string"==typeof this.config.slot&&0==this.config.friendly){let t=document.getElementById(this.config.slot);this.config.slot=t}this.log("slot",this.config.slot),this.volumeConfig.volume=this.config.volume,this.volumeConfig.muted=this.config.mute,this.config.friendly&&("vpaidModule"in this.config?this.vpaidModule=this.config.vpaidModule:this.vpaidModule=this.w.vpaidModule),this.initDebugMarker(),this.initPreloader(),this.initVolumeControl(),this.initVisibilityTracker(),this.initSizeWatcher(),this.autoplayChecksResolved()},this.checkAutoplaySupport=function(){var t=this.videoContent.player.play();void 0!==t?t.then(this.onAutoplayWithSoundSuccess.bind(this)).catch(this.onAutoplayWithSoundFail.bind(this)):this.onAutoplayWithSoundFail()},this.onAutoplayWithSoundSuccess=function(){this.log("Autoplay WITH SOUND"),this.videoContent.player.pause(),this.autoplayAllowed=!0,this.autoplayRequiresMuted=!1,this.autoplayChecksResolved()},this.onAutoplayWithSoundFail=function(){this.log("Autoplay WITH SOUND","FAILED"),this.checkMutedAutoplaySupport()},this.checkMutedAutoplaySupport=function(){this.videoContent.player.volume=0,this.videoContent.player.muted=!0,this.videoContent.player.play(),this.onMutedAutoplaySuccess()},this.onMutedAutoplaySuccess=function(){this.videoContent.player.pause(),this.autoplayAllowed=!0,this.autoplayRequiresMuted=!0,this.autoplayChecksResolved(),this.log("Autoplay MUTED")},this.onMutedAutoplayFail=function(){this.videoContent.player.volume=1,this.videoContent.player.muted=!1,this.autoplayAllowed=!1,this.autoplayRequiresMuted=!1,this.autoplayChecksResolved()},this.callStageFn=(t,e)=>{let i=e||[];if(this.config.friendly){if("function"==typeof this.vpaidModule[t])return this.vpaidModule[t].apply(this.vpaidModule,i)}else try{this.messagePort.postMessage({t:"st",f:t,stn:this.config.stageNum,p:i})}catch(t){this.log("MessagePort error",t)}},this.callManagerFn=(t,e)=>{let i=e||[];try{this.messagePort.postMessage({t:"stm",f:t,stn:this.config.stageNum,p:i})}catch(t){}},this.sendEvent=function(t){this.callStageFn("receiveEvent",[t])},this.autoplayChecksResolved=function(){this.callStageFn("moduleReady")},this.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.getDynamicParams=function(){return this.config.friendly?this.vpaidModule.dynamicParams:function(){return{}}},this.logger=function(t,e,i,n,s){if(-1==this.config.fle.indexOf(t)&&this.config.disableLogger&&("fl"in this.currentPartner&&0==this.currentPartner.fl||!("fl"in this.currentPartner))&&"intervention"!=t&&(void 0===s||0==s))return;let r=void 0===e?"":e;var o=void 0!==this.w.location.ancestorOrigins?JSON.stringify(this.w.location.ancestorOrigins):"",a={t:"stage_player",c:this.config.session,a:t,m:r,v:this.config.key,o:o,cid:void 0!==n?n:"object"==typeof this.currentPartner&&"id"in this.currentPartner?this.currentPartner.id:0},l=[];for(var c in a)"swapDict"!=c&&l.push(c+"="+encodeURIComponent(a[c]));var h=l.join("&"),d=new Image;void 0!==i&&(d.onload=i,d.onerror=i),d.src="https://l2.moviead55.ru/logger.php?"+h},this.eventTracker=function(t){(new Image).src=t},this.getStackTrace=function(){let t=(new Error).stack||"";return t=t.split("\n").map((function(t){return t.trim()})),t.splice("Error"==t[0]?2:1)},this.playAds=function(t,e){if("function"!=typeof e){let t=e;e=e=>{this.callStageFn(t,[e])}}this.stageCallback=e,this.currentPartner=t,this.log("VAST",n,t),this.vastLoader=new n.VASTClient,this.log("REF",document.referrer),this.vastLoader.get(t.tag,this.vastLoaderOptions).then(function(t,i){this.log("Response",t,i),t.ads.length>0?(this.callStageFn("recalculateTimeout",[t.ads.length]),this.ads=t.ads,this.tryAd(function(){this.log("All ads finished!",typeof e),this.logger("partner_ads_finished",this.config.stageNum),this.haveDirectAds&&0==this.directAdsPlayed&&this.logger("direct_ads_play_failed",JSON.stringify({readyState:this.videoElem.player.readyState,src:this.videoElem.player.src}),void 0,void 0,!0),this.w.setTimeout(function(){this.stageCallback("stagePlayer_all_ads_finished")}.bind(this),1e3)}.bind(this))):(this.log("No ads in tag!"),this.logger("no_ads_in_tag",this.config.stageNum),e("stagePlayer_no_ads_in_tag"))}.bind(this)).catch(function(i){console.trace(),this.log("Error loading tag!",i),"object"==typeof i?i.stack=this.getStackTrace():"string"==typeof i&&(i+=this.getStackTrace());var n={err:i,link:t.tag};this.logger("vast_loader_error",JSON.stringify(n)),e("stagePlayer_error_loading_tag")}.bind(this))},this.clearSlot=function(t){t.innerHTML=""},this.adComplete=function(t,e){this.showPreloader(),this.log("adComplete",this.config.mips,this.impsCount,this.config.mips),this.config.mips>0&&this.impsCount<this.config.mips?-1!=["vpaid","vpaid_video"].indexOf(this.currentAdType)||this.tryAd(t):-1!=["vpaid","vpaid_video"].indexOf(this.currentAdType)?(this.adUnit._destroy(),t("stagePlayer_max_imps1")):t("stagePlayer_max_imps2")},this.fireClick=function(t){if("object"!=typeof t||t instanceof HTMLMediaElement)if(document.createEvent){var e=this.w.document.createEvent("MouseEvents");e.initEvent("click",!0,!1),t.dispatchEvent(e)}else this.w.document.createEventObject?t.fireEvent("onclick"):"function"==typeof t.onclick&&t.onclick()},this.checkObjectAndProperty=function(t,e){return null!=t&&e in t},this.observer=null,this.clearAllTimeoutes=function(){this.clearTimeout("impTimeout",this.adUnit),this.clearTimeout("eventGapTimeout",this.adUnit),this.clearTimeout("initTimeout",this.adUnit),this.clearTimeout("startToImpTimeout",this.adUnit),clearTimeout(this.nextAdTimeoutHolder)},this.sendReports=function(t){for(let e of t)"body"in e&&-1!=e.body.message.indexOf("network")&&(e.body.videoUrl=this.videoElem.player.src),this.logger("intervention",JSON.stringify(e))},this.checkAlive=function(){return!0},this.initInterventionObserver=function(){"undefined"!=typeof ReportingObserver&&(this.w.addEventListener("pagehide",function(t){let e=this.observer.takeRecords();this.sendReports(e)}.bind(this)),this.observer=new ReportingObserver(function(t,e){this.sendReports(t)}.bind(this),{buffered:!0}),this.observer.observe())},this.clearAndNext=function(t){this.clearAllTimeoutes(),void 0!==this.videoElem&&"player"in this.videoElem&&this.clearListeners(this.videoElem.player,this.listeners),null!=this.vpClient&&0==this.vpClient.isDestroyed()&&(this.vpClient.unloadAdUnit(),this.vpClient.destroy()),null!==this.adUnit&&this.adUnit._destroy(),this.clearSlot(this.config.slot),this.adUnit=null,"function"==typeof t&&t("clear_and_next")},this.once=function(t,e){var i;return function(){return t&&(i=t.apply(e||this,arguments),t=null),i}},this.setTimeout=function(t,e,i,n){t in e&&null!=e[t]?this.logger("timeout_overlap",t):e[t]=this.w.setTimeout(i,n)},this.clearTimeout=function(t,e){null!=e&&t in e&&null!=e[t]&&(clearTimeout(e[t]),e[t]=null)},this.runAds=function(){if(this.startFlag=!0,-1!=["vpaid","vpaid_video"].indexOf(this.currentAdType)){if(this.config.autoplay&&0==this.usingOurVideoElem&&this.setAdVolume(0,!0),null==this.adUnit)return void this.stageCallback("ad_unit_is_null");this.w.setTimeout(function(){if(null==this.adUnit)return this.log("ADUNIT IS NULL"),void this.logger("adunit_is_null");this.adUnit.startAd(function(){this.log("Ad start callback",arguments),this.logger("ad_start_callback")}.bind(this)),this.adPaused&&(this.adPaused=!1,this.adUnit.resumeAd())}.bind(this),500)}else this.playVideoAd()},this.tryAd=function(t){if(this.haveDirectAds&&0==this.directAdsPlayed&&this.logger("direct_ads_play_failed",JSON.stringify({readyState:this.videoElem.player.readyState,src:this.videoElem.player.src}),void 0,void 0,!0),this.haveDirectAds=!1,this.directAdsPlayed=!1,this.showPreloader(),this.hideVolContainer(),this.clearAndNext(),this.log("this.ads.length",this.ads.length),this.logger("try_ad",this.ads.length),0==this.ads.length)return this.log("No more ads!",typeof t),void("function"==typeof t&&t("stagePlayer_ads_length_0"));this.switchNext=this.once((function(e){this.logger("switch_next",e),this.tryAd(t)}),this);var e=this.ads.shift();this.log("ad wrapper sequence",e.wrapperSequence);var i=e.creatives[0];if(this.log("creative",i),0==i.mediaFiles.length)return this.log("no media file"),this.logger("no_media",JSON.stringify(e.creatives)),void this.switchNext("no_media");var r=this.getVPAIDMedia(i.mediaFiles);this.log("vpaid media",r,i.mediaFiles);var o=new n.VASTTracker(null,e,i,this.getDynamicParams.bind(this));if(this.currentAdId=this.currentPartner.id,null!==r){this.currentAdType="vpaid";var a=this.createVideoElem(this.config.slot);this.subscribeToVideoEvents(a.player),this.config.slot.style.display="",this.config.slot.style.zIndex=200,a.wrapper.style.zIndex=100,this.log("SLOT",this.config.slot);let n=this.currentPartner.partner.fsnd?a.player:a.proxy;this.log("VIDEO SLOT",n,this.currentPartner.partner.fsnd),this.vpClient=new s.VPAIDHTML5Client(this.config.slot,n,{},{timeout:15e3,_w:this.w});var l=function(n,s,a){if(null!=s)return this.log("vpaid err",s),this.logger("vpaid_error",s),void this.switchNext("vpaid_error");this.sendEvent("loaded"),this.log("adUnit",arguments,a),this.adUnit=a,this.adUnit.vpURL=n,this.adUnit.impsCount=0,this.adUnit.hasImp=!1,this.adUnit.AdViewabilityObserved=!1,this.w.currentAdUnit=a,this.log("onLoad",n);var l=function(t,e,n){var s=this.config.slot.getBoundingClientRect().width,r=this.config.slot.getBoundingClientRect().height;this.log("handshake",s,r,"normal",-1),this.logger("handshake"),this.adUnit.initStart=new Date,this.adUnit.cData=i.adParameters,this.log("initAd",i.adParameters,this.adUnit),this.adUnit.initAd(s,r,"normal",500,{AdParameters:i.adParameters})}.bind(this),c=function(t,e){this.clearAllTimeoutes(),this.logger("ad_init",JSON.stringify({initiated:"initiaded"in this.adUnit})),this.log("onInit",t),this.callStageFn("sendStageManagerMessage",["on_init"]),this.adUnit.initiaded=!0}.bind(this),h=function(t,e){0==this.startFlag&&this.log("AdStarted without startAd() !!!"),this.logger("ad_start",JSON.stringify({startFlag:this.startFlag})),this.log("-> AdStarted",this.startFlag,t)}.bind(this),d=function(t,e){this.logger("ad_stop"),this.log("-> AdStopped",t),this.switchNext("ad_stop")}.bind(this),u=function(t,e,i){this.logger("ad_error",JSON.stringify({error:i})),this.log("-> AdError",t,e,this.currentAdId),this.switchNext("ad_error")}.bind(this),g=function(t,i){this.clearAllTimeoutes(),this.showVolContainer(),this.directAdsPlayed=!0,this.config.autoplay&&0==this.usingOurVideoElem&&this.setAdVolume(0,!0),this.log("Setting quartile timeout! (AdImpression)");var n=new Date;if(!("lastImp"in this.adUnit)||Math.floor((n.getTime()-this.adUnit.lastImp.getTime())/1e3)>5){if(o.trackImpression(),this.impsCount++,this.adUnit.impsCount++,this.log("Received message",m.AdImpression,t),"caft"in this.currentPartner.partner&&"AdViewabilityObserved"==this.currentPartner.partner.caft&&0==this.adUnit.AdViewabilityObserved)return this.logger("invisible_imp"),void(this.adUnit.hasImp=!0);this.adUnit.hasImp=!1,this.sendEvent(m.AdImpression),this.logger("wimp",JSON.stringify(e.wrapperSequence))}this.adUnit.lastImp=new Date,this.log("AD IMP",t),this.hidePreloader()}.bind(this),p=["AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError","viewable","notViewable","viewUndetermined","sent","init","launch","request","viewabilityObserved"],f=["AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdPaused","AdPlaying","viewable","notViewable","viewUndetermined","sent","init","launch","request","viewabilityObserved"],m={AdImpression:this.AD_IMP,AdVideoFirstQuartile:this.AD_FQ,AdVideoMidpoint:this.AD_MP,AdVideoThirdQuartile:this.AD_TQ,AdVideoComplete:this.AD_COMP,AdClickThru:this.AD_CLICK,AdSkipped:this.AD_SKIP,AdVideoStart:this.AD_VSTART},A={AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete"},v={AdImpression:this.AD_IMP,AdVideoFirstQuartile:this.AD_FQ,AdVideoMidpoint:this.AD_MP,AdVideoThirdQuartile:this.AD_TQ};p.forEach(function(t,e,i){this.adUnit.subscribe(i,function(t,e,n){this.log("NMODULE EVENT",i,t,n),-1!=f.indexOf(i)&&this.logger("vpaid_event",i),"AdViewabilityObserved"==i&&"caft"in this.currentPartner.partner&&"AdViewabilityObserved"==this.currentPartner.partner.caft&&(this.adUnit.AdViewabilityObserved=!0,this.adUnit.hasImp&&(this.adUnit.hasImp=!1,this.sendEvent(m.AdImpression))),"AdVideoStart"==i&&(o.track("start"),this.showVolContainer(),this.hidePreloader()),-1!=Object.keys(A).indexOf(i)&&(this.showVolContainer(),this.clearAllTimeoutes(),o.track(A[i]),this.hidePreloader()),Object.keys(v).indexOf(i),-1!=Object.keys(m).indexOf(i)&&(-1!=i.indexOf("AdVideo")&&this.hidePreloader(),this.log("Received message",m[i],t),this.sendEvent(m[i]),"AdClickThru"==i&&(this.log("Enter CLICK inside section"),o.click(),void 0!==n&&"data"in n&&"playerHandles"in n.data&&"url"in n.data&&1==n.data.playerHandles?(this.log("Enter CLICK IF inside section"),window.open(n.data.url,"_blank")):"playerHandles"in n&&"url"in n&&1==n.playerHandles&&(this.log("Enter CLICK ELSE IF inside section"),window.open(n.url,"_blank")))),"AdPaused"==i&&(this.startFlag?this.adUnit.resumeAd():this.adPaused=!0)}.bind(this,t,e))}.bind(this,r.fileURL,this.currentAdId)),this.adUnit.subscribe("AdImpression",g.bind(this,r.fileURL,this.currentAdId)),this.adUnit.subscribe("AdVideoComplete",this.adComplete.bind(this,t,r.fileURL)),this.adUnit.subscribe("AdVideoStart",this.hidePreloader.bind(this)),this.adUnit.subscribe("AdLoaded",c.bind(this,r.fileURL,this.currentAdId)),this.adUnit.subscribe("AdStarted",h.bind(this,r.fileURL,this.currentAdId)),this.adUnit.subscribe("AdStopped",d.bind(this,r.fileURL,this.currentAdId)),this.adUnit.subscribe("AdError",u.bind(this,r.fileURL,this.currentAdId)),this.adUnit.handshakeVersion("2.0",l.bind(this,r.fileURL))}.bind(this);this.vpClient.loadAdUnit(r.fileURL,l.bind(this,r.fileURL),this.currentPartner.partner.fsnd)}else{var c={};(function(){this.logger("video_quartile_timeout"),this.switchNext("video_quartile_timeout")}).bind(this),this.currentAdType="video",a=this.createVideoElem(this.config.slot),this.videoContent=a,this.config.slot.style.zIndex=100,a.wrapper.style.zIndex=200,this.fireClick(a.player),a.player.addEventListener("durationchange",function(t){this.w.setTimeout(function(){this.log("DURATION",t.target.duration,t.target),o.setDuration(t.target.duration)}.bind(this),1e3)}.bind(this)),a.player.addEventListener("durationchange",(function(t){o.setDuration(a.player.duration)})),a.player.addEventListener("timeupdate",function(t){o.setProgress(t.target.currentTime)}.bind(this)),this.hidePreloader.bind(this);let n=function(t){this.log("can play",t.target.paused),this.callStageFn("sendStageManagerMessage",["on_init"])}.bind(this);this.playVideoAd=function(){this.config.autoplay&&this.setAdVolume(0),a.player.play().then(h.bind(this)).catch(function(t){this.log("video play failed",t);var e={src:a.player.src,err:t,muted:a.player.muted,volume:a.player.volume,ap:this.config.mute};this.logger("video_play_failed",JSON.stringify(e)),(!e.muted||e.volume>0)&&(a.player.muted=!0,a.player.volume=0,a.player.play().then(h.bind(this)).catch(function(t){this.switchNext("video_ad_play_promise_error")}.bind(this)))}.bind(this)),a.player.removeEventListener("canplay",n)}.bind(this);var h=function(){this.config.autoplay&&this.setAdVolume(0),this.showVolContainer(),this.impsCount++,o.trackImpression(),this.sendEvent(this.AD_IMP),this.logger("video_impression",a.player.src),this.logger("wimp",JSON.stringify(e.wrapperSequence)),this.hidePreloader()}.bind(this);a.player.addEventListener("loadeddata",this.log.bind(this,"loadeddata")),a.player.addEventListener("loadeddata",this.log.bind(this,"loadedmetadata")),a.player.addEventListener("canplay",n),a.player.addEventListener("error",function(t){this.clearTimeout("fq",c),this.logger("video_elem_error",JSON.stringify(t)),this.switchNext("video_elem_error")}.bind(this)),a.wrapper.addEventListener("click",function(){o.click(),this.sendEvent(this.AD_CLICK)}.bind(this)),o.on("clickthrough",(function(t){window.open(t,"_blank").focus()}));var d={firstQuartile:this.AD_FQ,midpoint:this.AD_MP,thirdQuartile:this.AD_TQ,start:this.AD_VSTART};Object.keys(d).forEach(function(t){o.on(t,function(){this.showVolContainer(),this.clearTimeout("fq",c),this.sendEvent(d[t]),this.log("video_quartile",t)}.bind(this))}.bind(this));var u=this.getPlayableMedia(i.mediaFiles);if(null==u)return this.log("No suitable media files found!"),this.logger("no_valid_media",JSON.stringify(i.mediaFiles)),void this.switchNext("no_valid_media");this.log("selected mediaFile",u),a.player.setAttribute("src",u.fileURL),a.player.load(),"style"in a.player&&(a.player.style.display=""),a.player.addEventListener("ended",function(t){o.track("complete"),this.log("listener complete")}.bind(this)),o.on("complete",function(){this.clearTimeout("fq",c),this.sendEvent(this.AD_COMP),this.log("video_quartile","complete"),this.w.setTimeout(function(){this.adComplete(t)}.bind(this),1e3)}.bind(this)),"b"in a.player&&-1!=a.player.b.indexOf("goog")&&a.player.play()}},this.getPlayableMedia=function(t){var e=null,i=this.w.document.createElement("video");return t.some(function(t){if(-1!=["maybe","probably"].indexOf(i.canPlayType(t.mimeType)))return e=t,!0}.bind(this)),e},this.deployPMediaScript=t=>{let e=document.createElement("script");e.async=!0,e.src=t,this.w.document.body.appendChild(e)},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.initPortListener=t=>{t instanceof MessagePort&&(this.messagePort=t,t.onmessage=t=>{if("object"==typeof t.data&&"f"in t.data&&"p"in t.data&&"function"==typeof this[t.data.f]){let e=this[t.data.f].apply(this,t.data.p);void 0!==t.ports[0]&&t.ports[0].postMessage(e)}},t.postMessage({t:"st",f:"remoteReady",p:["initPortListener"]}))},this.initPortListener(e)}window.stagePlayer=r,t.exports=r},function(t,e,i){"use strict";var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function t(){n(this,t),this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[],this.wrapperSequence=[]},l=function t(){n(this,t),this.attributes={},this.children=[]},c=function t(){n(this,t),this.name=null,this.value=null,this.attributes={}},h=function t(){n(this,t),this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}},d=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.id=e.id||null,this.adId=e.adId||null,this.sequence=e.sequence||null,this.apiFramework=e.apiFramework||null,this.trackingEvents={}},u=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.type="companion",i.variations=[],i}return r(e,t),e}(d);function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];for(var n in e.ASSETURI&&(e.ASSETURI=p(e.ASSETURI)),e.CONTENTPLAYHEAD&&(e.CONTENTPLAYHEAD=p(e.CONTENTPLAYHEAD)),e.ERRORCODE&&!/^[0-9]{3}$/.test(e.ERRORCODE)&&(e.ERRORCODE=900),e.CACHEBUSTING=f(Math.round(1e8*Math.random()).toString()),e.TIMESTAMP=p((new Date).toISOString()),e.RANDOM=e.random=e.CACHEBUSTING,t){var s=t[n];if("string"==typeof s){for(var r in e){var o=e[r],a="["+r+"]",l="%%"+r+"%%";s=(s=s.replace(a,o)).replace(l,o)}i.push(s)}}return i}function p(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%"+t.charCodeAt(0).toString(16)}))}function f(t){return t.length<8?m(0,8-t.length,!1).map((function(t){return"0"})).join("")+t:t}function m(t,e,i){for(var n=[],s=t<e,r=i?s?e+1:e-1:e,o=t;s?o<r:o>r;s?o++:o--)n.push(o);return n}var A={track:function(t,e){g(t,e).forEach((function(t){"undefined"!=typeof window&&null!==window&&((new Image).src=t)}))},resolveURLTemplates:g,encodeURIComponentRFC3986:p,leftpad:f,range:m,isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},flatten:function t(e){return e.reduce((function(e,i){return e.concat(Array.isArray(i)?t(i):i)}),[])}},v=function(t,e){var i=t.childNodes;for(var n in i){var s=i[n];if(s.nodeName===e)return s}},y=function(t,e){var i=[],n=t.childNodes;for(var s in n){var r=n[s];r.nodeName===e&&i.push(r)}return i},b=function(t,e){return e?0===t.indexOf("//")?""+location.protocol+t:-1===t.indexOf("://")?e.slice(0,e.lastIndexOf("/"))+"/"+t:t:t},w=function(t){return-1!==["true","TRUE","1"].indexOf(t)},C=function(t){return t&&(t.textContent||t.text||"").trim()},T=function(t,e,i){var n=e.getAttribute(t);n&&i.setAttribute(t,n)},S=function(t){if(null==t)return-1;if(A.isNumeric(t))return parseInt(t);var e=t.split(":");if(3!==e.length)return-1;var i=e[2].split("."),n=parseInt(i[0]);2===i.length&&(n+=parseFloat("0."+i[1]));var s=parseInt(60*e[1]),r=parseInt(60*e[0]*60);return isNaN(r)||isNaN(s)||isNaN(n)||s>3600||n>60?-1:r+s+n},I=function(t){var e=[],i=null;return t.forEach((function(n,s){if(n.sequence&&(n.sequence=parseInt(n.sequence,10)),n.sequence>1){var r=t[s-1];if(r&&r.sequence===n.sequence-1)return void(i&&i.push(n));delete n.sequence}i=[n],e.push(i)})),e},k=function(t,e){t.errorURLTemplates=e.errorURLTemplates.concat(t.errorURLTemplates),t.impressionURLTemplates=e.impressionURLTemplates.concat(t.impressionURLTemplates),t.extensions=e.extensions.concat(t.extensions),t.wrapperSequence=e.wrapperSequence.concat(t.wrapperSequence),t.creatives.forEach((function(t){if(e.trackingEvents&&e.trackingEvents[t.type])for(var i in e.trackingEvents[t.type]){var n=e.trackingEvents[t.type][i];t.trackingEvents[i]||(t.trackingEvents[i]=[]),t.trackingEvents[i]=t.trackingEvents[i].concat(n)}})),e.videoClickTrackingURLTemplates&&e.videoClickTrackingURLTemplates.length&&t.creatives.forEach((function(t){"linear"===t.type&&(t.videoClickTrackingURLTemplates=t.videoClickTrackingURLTemplates.concat(e.videoClickTrackingURLTemplates))})),e.videoCustomClickURLTemplates&&e.videoCustomClickURLTemplates.length&&t.creatives.forEach((function(t){"linear"===t.type&&(t.videoCustomClickURLTemplates=t.videoCustomClickURLTemplates.concat(e.videoCustomClickURLTemplates))})),e.videoClickThroughURLTemplate&&t.creatives.forEach((function(t){"linear"===t.type&&null==t.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate)}))};function _(t,e){var i=new u(e);return y(t,"Companion").forEach((function(t){var e=new h;e.id=t.getAttribute("id")||null,e.width=t.getAttribute("width"),e.height=t.getAttribute("height"),e.companionClickTrackingURLTemplates=[],y(t,"HTMLResource").forEach((function(t){e.type=t.getAttribute("creativeType")||"text/html",e.htmlResource=C(t)})),y(t,"IFrameResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.iframeResource=C(t)})),y(t,"StaticResource").forEach((function(i){e.type=i.getAttribute("creativeType")||0,y(t,"AltText").forEach((function(t){e.altText=C(t)})),e.staticResource=C(i)})),y(t,"TrackingEvents").forEach((function(t){y(t,"Tracking").forEach((function(t){var i=t.getAttribute("event"),n=C(t);i&&n&&(null==e.trackingEvents[i]&&(e.trackingEvents[i]=[]),e.trackingEvents[i].push(n))}))})),y(t,"CompanionClickTracking").forEach((function(t){e.companionClickTrackingURLTemplates.push(C(t))})),e.companionClickThroughURLTemplate=C(v(t,"CompanionClickThrough")),e.companionClickTrackingURLTemplate=C(v(t,"CompanionClickTracking")),i.variations.push(e)})),i}var E=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.type="linear",i.duration=0,i.skipDelay=null,i.mediaFiles=[],i.videoClickThroughURLTemplate=null,i.videoClickTrackingURLTemplates=[],i.videoCustomClickURLTemplates=[],i.adParameters=null,i.icons=[],i}return r(e,t),e}(d),M=function t(){n(this,t),this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null},D=function t(){n(this,t),this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null};function L(t,e){var i=void 0,n=new E(e);n.duration=S(C(v(t,"Duration")));var s=t.getAttribute("skipoffset");if(null==s)n.skipDelay=null;else if("%"===s.charAt(s.length-1)&&-1!==n.duration){var r=parseInt(s,10);n.skipDelay=n.duration*(r/100)}else n.skipDelay=S(s);var o=v(t,"VideoClicks");o&&(n.videoClickThroughURLTemplate=C(v(o,"ClickThrough")),y(o,"ClickTracking").forEach((function(t){n.videoClickTrackingURLTemplates.push(C(t))})),y(o,"CustomClick").forEach((function(t){n.videoCustomClickURLTemplates.push(C(t))})));var a=v(t,"AdParameters");a&&(n.adParameters=C(a)),y(t,"TrackingEvents").forEach((function(t){y(t,"Tracking").forEach((function(t){var e=t.getAttribute("event"),s=C(t);if(e&&s){if("progress"===e){if(!(i=t.getAttribute("offset")))return;e="%"===i.charAt(i.length-1)?"progress-"+i:"progress-"+Math.round(S(i))}null==n.trackingEvents[e]&&(n.trackingEvents[e]=[]),n.trackingEvents[e].push(s)}}))})),y(t,"MediaFiles").forEach((function(t){y(t,"MediaFile").forEach((function(t){var e=new D;e.id=t.getAttribute("id"),e.fileURL=C(t),e.deliveryType=t.getAttribute("delivery"),e.codec=t.getAttribute("codec"),e.mimeType=t.getAttribute("type"),e.apiFramework=t.getAttribute("apiFramework"),e.bitrate=parseInt(t.getAttribute("bitrate")||0),e.minBitrate=parseInt(t.getAttribute("minBitrate")||0),e.maxBitrate=parseInt(t.getAttribute("maxBitrate")||0),e.width=parseInt(t.getAttribute("width")||0),e.height=parseInt(t.getAttribute("height")||0);var i=t.getAttribute("scalable");i&&"string"==typeof i&&("true"===(i=i.toLowerCase())?e.scalable=!0:"false"===i&&(e.scalable=!1));var s=t.getAttribute("maintainAspectRatio");s&&"string"==typeof s&&("true"===(s=s.toLowerCase())?e.maintainAspectRatio=!0:"false"===s&&(e.maintainAspectRatio=!1)),n.mediaFiles.push(e)}))}));var l=v(t,"Icons");return l&&y(l,"Icon").forEach((function(t){var e=new M;e.program=t.getAttribute("program"),e.height=parseInt(t.getAttribute("height")||0),e.width=parseInt(t.getAttribute("width")||0),e.xPosition=function(t){return-1!==["left","right"].indexOf(t)?t:parseInt(t||0)}(t.getAttribute("xPosition")),e.yPosition=function(t){return-1!==["top","bottom"].indexOf(t)?t:parseInt(t||0)}(t.getAttribute("yPosition")),e.apiFramework=t.getAttribute("apiFramework"),e.offset=S(t.getAttribute("offset")),e.duration=S(t.getAttribute("duration")),y(t,"HTMLResource").forEach((function(t){e.type=t.getAttribute("creativeType")||"text/html",e.htmlResource=C(t)})),y(t,"IFrameResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.iframeResource=C(t)})),y(t,"StaticResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.staticResource=C(t)}));var i=v(t,"IconClicks");i&&(e.iconClickThroughURLTemplate=C(v(i,"IconClickThrough")),y(i,"IconClickTracking").forEach((function(t){e.iconClickTrackingURLTemplates.push(C(t))}))),e.iconViewTrackingURLTemplate=C(v(t,"IconViewTracking")),n.icons.push(e)})),n}var O=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.type="nonlinear",i.variations=[],i}return r(e,t),e}(d),R=function t(){n(this,t),this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null};function N(t,e){var i=new O(e);return y(t,"TrackingEvents").forEach((function(t){var e=void 0,n=void 0;y(t,"Tracking").forEach((function(t){e=t.getAttribute("event"),n=C(t),e&&n&&(null==i.trackingEvents[e]&&(i.trackingEvents[e]=[]),i.trackingEvents[e].push(n))}))})),y(t,"NonLinear").forEach((function(t){var e=new R;e.id=t.getAttribute("id")||null,e.width=t.getAttribute("width"),e.height=t.getAttribute("height"),e.expandedWidth=t.getAttribute("expandedWidth"),e.expandedHeight=t.getAttribute("expandedHeight"),e.scalable=w(t.getAttribute("scalable")),e.maintainAspectRatio=w(t.getAttribute("maintainAspectRatio")),e.minSuggestedDuration=S(t.getAttribute("minSuggestedDuration")),e.apiFramework=t.getAttribute("apiFramework"),y(t,"HTMLResource").forEach((function(t){e.type=t.getAttribute("creativeType")||"text/html",e.htmlResource=C(t)})),y(t,"IFrameResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.iframeResource=C(t)})),y(t,"StaticResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.staticResource=C(t)}));var n=v(t,"AdParameters");n&&(e.adParameters=C(n)),e.nonlinearClickThroughURLTemplate=C(v(t,"NonLinearClickThrough")),y(t,"NonLinearClickTracking").forEach((function(t){e.nonlinearClickTrackingURLTemplates.push(C(t))})),i.variations.push(e)})),i}function P(t){var e=t.childNodes;for(var i in e){var n=e[i];if(-1!==["Wrapper","InLine"].indexOf(n.nodeName)){if(T("id",t,n),T("sequence",t,n),"Wrapper"===n.nodeName)return U(n);if("InLine"===n.nodeName)return x(n)}}}function x(t){var e=t.childNodes,i=new a;for(var n in i.id=t.getAttribute("id")||null,i.sequence=t.getAttribute("sequence")||null,e){var s=e[n];switch(s.nodeName){case"Error":i.errorURLTemplates.push(C(s));break;case"Impression":i.impressionURLTemplates.push(C(s));break;case"Creatives":y(s,"Creative").forEach((function(t){var e={id:t.getAttribute("id")||null,adId:j(t),sequence:t.getAttribute("sequence")||null,apiFramework:t.getAttribute("apiFramework")||null};for(var n in t.childNodes){var s=t.childNodes[n];switch(s.nodeName){case"Linear":var r=L(s,e);r&&i.creatives.push(r);break;case"NonLinearAds":var o=N(s,e);o&&i.creatives.push(o);break;case"CompanionAds":var a=_(s,e);a&&i.creatives.push(a)}}}));break;case"Extensions":V(i.extensions,y(s,"Extension"));break;case"AdSystem":i.system={value:C(s),version:s.getAttribute("version")||null};break;case"AdTitle":i.title=C(s);break;case"Description":i.description=C(s);break;case"Advertiser":i.advertiser=C(s);break;case"Pricing":i.pricing={value:C(s),model:s.getAttribute("model")||null,currency:s.getAttribute("currency")||null};break;case"Survey":i.survey=C(s)}}return i}function U(t){var e=x(t),i=v(t,"VASTAdTagURI");if(i){e.nextWrapperURL=C(i);var n=new URL(e.nextWrapperURL);e.wrapperSequence.push(n.hostname)}else(i=v(t,"VASTAdTagURL"))&&(e.nextWrapperURL=C(v(i,"URL")),n=new URL(e.nextWrapperURL),e.wrapperSequence.push(n.hostname));if(e.creatives.forEach((function(t){if(-1!==["linear","nonlinear"].indexOf(t.type)){if(t.trackingEvents){e.trackingEvents||(e.trackingEvents={}),e.trackingEvents[t.type]||(e.trackingEvents[t.type]={});var i=function(i){var n=t.trackingEvents[i];e.trackingEvents[t.type][i]||(e.trackingEvents[t.type][i]=[]),n.forEach((function(n){e.trackingEvents[t.type][i].push(n)}))};for(var n in t.trackingEvents)i(n)}t.videoClickTrackingURLTemplates&&(e.videoClickTrackingURLTemplates||(e.videoClickTrackingURLTemplates=[]),t.videoClickTrackingURLTemplates.forEach((function(t){e.videoClickTrackingURLTemplates.push(t)}))),t.videoClickThroughURLTemplate&&(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate),t.videoCustomClickURLTemplates&&(e.videoCustomClickURLTemplates||(e.videoCustomClickURLTemplates=[]),t.videoCustomClickURLTemplates.forEach((function(t){e.videoCustomClickURLTemplates.push(t)})))}})),e.nextWrapperURL)return e}function V(t,e){e.forEach((function(e){var i=new l,n=e.attributes,s=e.childNodes;if(e.attributes)for(var r in n){var o=n[r];o.nodeName&&o.nodeValue&&(i.attributes[o.nodeName]=o.nodeValue)}for(var a in s){var h=s[a],d=C(h);if("#comment"!==h.nodeName&&""!==d){var u=new c;if(u.name=h.nodeName,u.value=d,h.attributes){var g=h.attributes;for(var p in g){var f=g[p];u.attributes[f.nodeName]=f.nodeValue}}i.children.push(u)}}t.push(i)}))}function j(t){return t.getAttribute("AdID")||t.getAttribute("adID")||t.getAttribute("adId")||null}function Z(){}function G(){G.init.call(this)}function z(t){return void 0===t._maxListeners?G.defaultMaxListeners:t._maxListeners}function W(t,e,i){if(e)t.call(i);else for(var n=t.length,s=K(t,n),r=0;r<n;++r)s[r].call(i)}function H(t,e,i,n){if(e)t.call(i,n);else for(var s=t.length,r=K(t,s),o=0;o<s;++o)r[o].call(i,n)}function B(t,e,i,n,s){if(e)t.call(i,n,s);else for(var r=t.length,o=K(t,r),a=0;a<r;++a)o[a].call(i,n,s)}function F(t,e,i,n,s,r){if(e)t.call(i,n,s,r);else for(var o=t.length,a=K(t,o),l=0;l<o;++l)a[l].call(i,n,s,r)}function Y(t,e,i,n){if(e)t.apply(i,n);else for(var s=t.length,r=K(t,s),o=0;o<s;++o)r[o].apply(i,n)}function X(t,e,i,n){var s,r,o,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((r=t._events)?(r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),o=r[e]):(r=t._events=new Z,t._eventsCount=0),o){if("function"==typeof o?o=r[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),!o.warned&&(s=z(t))&&s>0&&o.length>s){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=r[e]=i,++t._eventsCount;return t}function Q(t,e,i){var n=!1;function s(){t.removeListener(e,s),n||(n=!0,i.apply(t,arguments))}return s.listener=i,s}function J(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function K(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}Z.prototype=Object.create(null),G.EventEmitter=G,G.usingDomains=!1,G.prototype.domain=void 0,G.prototype._events=void 0,G.prototype._maxListeners=void 0,G.defaultMaxListeners=10,G.init=function(){this.domain=null,G.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Z,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},G.prototype.getMaxListeners=function(){return z(this)},G.prototype.emit=function(t){var e,i,n,s,r,o,a,l=!1,c="error"===t;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(e=arguments[1],!a){if(e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(i=o[t]))return!1;var d="function"==typeof i;switch(n=arguments.length){case 1:W(i,d,this);break;case 2:H(i,d,this,arguments[1]);break;case 3:B(i,d,this,arguments[1],arguments[2]);break;case 4:F(i,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(n-1),r=1;r<n;r++)s[r-1]=arguments[r];Y(i,d,this,s)}return l&&a.exit(),!0},G.prototype.addListener=function(t,e){return X(this,t,e,!1)},G.prototype.on=G.prototype.addListener,G.prototype.prependListener=function(t,e){return X(this,t,e,!0)},G.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,Q(this,t,e)),this},G.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Q(this,t,e)),this},G.prototype.removeListener=function(t,e){var i,n,s,r,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new Z:(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,r=i.length;r-- >0;)if(i[r]===e||i[r].listener&&i[r].listener===e){o=i[r].listener,s=r;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new Z,this;delete n[t]}else!function(t,e){for(var i=e,n=i+1,s=t.length;n<s;i+=1,n+=1)t[i]=t[n];t.pop()}(i,s);n.removeListener&&this.emit("removeListener",t,o||e)}return this},G.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new Z,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new Z:delete i[t]),this;if(0===arguments.length){for(var n,s=Object.keys(i),r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new Z,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},G.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},G.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):J.call(t,e)},G.prototype.listenerCount=J,G.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var q=function(t,e,i){var n="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0;if(!n)return i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"));n.async=!1;var s=s();s.open("GET",t),s.timeout=e.timeout||0,s.withCredentials=e.withCredentials||!1,s.send(),s.onprogress=function(){},s.onload=function(){n.loadXML(s.responseText),i(null,n)}},$=function(){return!!function(){var t=void 0;return window.XDomainRequest&&(t=new XDomainRequest),t}()},tt=function(t,e,i){i(new Error("Please bundle the library for node to use the node urlHandler"))},et=function(t,e,i){if("https:"===window.location.protocol&&0===t.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var n=new XMLHttpRequest;n.open("GET",t),n.ontimeout=function(e){i({type:"timeout",url:t,e:e})},n.timeout=e.timeout||0,n.withCredentials=e.withCredentials||!1,t.indexOf("code.moviead55.ru"),n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){void 0!==window.debugxhr&&console.log("readyState",n.readyState,"status",n.status),4===n.readyState&&(200===n.status?null==n.responseXML?i(new Error("XHRURLHandler: Empty XML, url: "+t+", responseText: "+n.responseText)):i(null,n.responseXML):0!=n.status?i(new Error("XHRURLHandler: "+n.status+", url: "+t)):i(new Error("XHRURLHandler: unreachable url, url: "+t)))},n.send()}catch(t){console.log("err",t),i(new Error("XHRURLHandler: Unexpected error"))}},it=function(){return!!function(){try{var t=new window.XMLHttpRequest;return"withCredentials"in t?t:null}catch(t){return console.log("Error in XHRURLHandler support check:",t),null}}()},nt={get:function(t,e,i){return i||("function"==typeof e&&(i=e),e={}),"undefined"==typeof window||null===window?tt(t,e,i):it()?et(t,e,i):$()?q(t,e,i):i(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}},st=function t(){n(this,t),this.ads=[],this.errorURLTemplates=[]},rt={ERRORCODE:900,extensions:[]},ot=function(t){function e(){n(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.remainingAds=[],t.parentURLs=[],t.errorURLTemplates=[],t.rootErrorURLTemplates=[],t.maxWrapperDepth=null,t.URLTemplateFilters=[],t.fetchingOptions={},t}return r(e,t),s(e,[{key:"addURLTemplateFilter",value:function(t){"function"==typeof t&&this.URLTemplateFilters.push(t)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];this.emit("VAST-error",Object.assign.apply(Object,[rt,e].concat(n))),A.track(t,e)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"fetchVAST",value:function(t,e,i){var n=this;return new Promise((function(s,r){n.URLTemplateFilters.forEach((function(e){t=e(t)})),n.parentURLs.push(t),n.emit("VAST-resolving",{url:t,wrapperDepth:e,originalUrl:i}),n.urlHandler.get(t,n.fetchingOptions,(function(e,i){n.emit("VAST-resolved",{url:t,error:e}),e?r(e):s(i)}))}))}},{key:"initParsingStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.rootURL="",this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=t.wrapperLimit||10,this.fetchingOptions={timeout:t.timeout,withCredentials:t.withCredentials},this.urlHandler=t.urlhandler||nt}},{key:"getRemainingAds",value:function(t){var e=this;if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));var i=t?A.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(i,{wrapperDepth:0,originalUrl:this.rootURL}).then((function(t){return e.buildVASTResponse(t)}))}},{key:"getAndParseVAST",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(i),this.rootURL=t,this.fetchVAST(t).then((function(n){return i.originalUrl=t,i.isRootVAST=!0,e.parse(n,i).then((function(t){return e.buildVASTResponse(t)}))}))}},{key:"parseVAST",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(i),i.isRootVAST=!0,this.parse(t,i).then((function(t){return e.buildVASTResponse(t)}))}},{key:"buildVASTResponse",value:function(t){var e=new st;return e.ads=t,e.errorURLTemplates=this.getErrorURLTemplates(),this.completeWrapperResolving(e),e}},{key:"parse",value:function(t,e){var i=e.resolveAll,n=void 0===i||i,s=e.wrapperSequence,r=void 0===s?null:s,o=e.originalUrl,a=void 0===o?null:o,l=e.wrapperDepth,c=void 0===l?0:l,h=e.isRootVAST,d=void 0!==h&&h;if(!t||!t.documentElement||"VAST"!==t.documentElement.nodeName)return Promise.reject(new Error("Invalid VAST XMLDocument"));var u=[],g=t.documentElement.childNodes;for(var p in g){var f=g[p];if("Error"===f.nodeName){var m=C(f);d?this.rootErrorURLTemplates.push(m):this.errorURLTemplates.push(m)}if("Ad"===f.nodeName){var A=P(f);A?u.push(A):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}var v=u.length,y=u[v-1];return 1===v&&null!=r&&y&&!y.sequence&&(y.sequence=r),!1===n&&(this.remainingAds=I(u),u=this.remainingAds.shift()),this.resolveAds(u,{wrapperDepth:c,originalUrl:a})}},{key:"resolveAds",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments[1],n=i.wrapperDepth,s=i.originalUrl,r=[];return e.forEach((function(e){var i=t.resolveWrappers(e,n,s);r.push(i)})),Promise.all(r).then((function(e){var i=A.flatten(e);if(!i&&t.remainingAds.length>0){var r=t.remainingAds.shift();return t.resolveAds(r,{wrapperDepth:n,originalUrl:s})}return i}))}},{key:"resolveWrappers",value:function(t,e,i){var n=this;return new Promise((function(s,r){if(e++,!t.nextWrapperURL)return delete t.nextWrapperURL,s(t);if(e>=n.maxWrapperDepth||-1!==n.parentURLs.indexOf(t.nextWrapperURL))return t.errorCode=302,delete t.nextWrapperURL,s(t);t.nextWrapperURL=b(t.nextWrapperURL,i);var o=t.sequence;i=t.nextWrapperURL,n.fetchVAST(t.nextWrapperURL,e,i).then((function(r){return n.parse(r,{originalUrl:i,wrapperSequence:o,wrapperDepth:e}).then((function(e){if(delete t.nextWrapperURL,0===e.length)return t.creatives=[],s(t);e.forEach((function(e){e&&k(e,t)})),s(e)}))})).catch((function(e){t.errorCode=301,t.errorMessage=e.message,s(t)}))}))}},{key:"completeWrapperResolving",value:function(t){if(0===t.ads.length)this.trackVastError(t.errorURLTemplates,{ERRORCODE:303});else for(var e=t.ads.length-1;e>=0;e--){var i=t.ads[e];(i.errorCode||0===i.creatives.length)&&(this.trackVastError(i.errorURLTemplates.concat(t.errorURLTemplates),{ERRORCODE:i.errorCode||303},{ERRORMESSAGE:i.errorMessage||""},{extensions:i.extensions},{system:i.system}),t.ads.splice(e,1))}}}]),e}(G),at=null,lt={data:{},length:0,getItem:function(t){return this.data[t]},setItem:function(t,e){this.data[t]=e,this.length=Object.keys(this.data).length},removeItem:function(t){delete data[t],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}},ct=function(){function t(){n(this,t),this.storage=this.initStorage()}return s(t,[{key:"initStorage",value:function(){if(at)return at;try{at="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(t){at=null}return at&&!this.isStorageDisabled(at)||(at=lt).clear(),at}},{key:"isStorageDisabled",value:function(t){var e="__VASTStorage__";try{if(t.setItem(e,e),t.getItem(e)!==e)return t.removeItem(e),!0}catch(t){return!0}return t.removeItem(e),!1}},{key:"getItem",value:function(t){return this.storage.getItem(t)}},{key:"setItem",value:function(t,e){return this.storage.setItem(t,e)}},{key:"removeItem",value:function(t){return this.storage.removeItem(t)}},{key:"clear",value:function(){return this.storage.clear()}}]),t}(),ht=function(){function t(e,i,s){n(this,t),this.cappingFreeLunch=e||0,this.cappingMinimumTimeInterval=i||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new ot,this.storage=s||new ct,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return s(t,[{key:"getParser",value:function(){return this.vastParser}},{key:"hasRemainingAds",value:function(){return this.vastParser.remainingAds.length>0}},{key:"getNextAds",value:function(t){return this.vastParser.getRemainingAds(t)}},{key:"get",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Date.now();return(i=Object.assign(this.defaultOptions,i)).hasOwnProperty("resolveAll")||(i.resolveAll=!1),this.totalCallsTimeout<n?(this.totalCalls=1,this.totalCallsTimeout=n+36e5):this.totalCalls++,new Promise((function(s,r){if(e.cappingFreeLunch>=e.totalCalls)return r(new Error("VAST call canceled – FreeLunch capping not reached yet "+e.totalCalls+"/"+e.cappingFreeLunch));var o=n-e.lastSuccessfulAd;if(o<0)e.lastSuccessfulAd=0;else if(o<e.cappingMinimumTimeInterval)return r(new Error("VAST call canceled – ("+e.cappingMinimumTimeInterval+")ms minimum interval reached"));e.vastParser.getAndParseVAST(t,i).then((function(t){return s(t)})).catch((function(t){return r(t)}))}))}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(t){this.storage.setItem("vast-client-last-successful-ad",t)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(t){this.storage.setItem("vast-client-total-calls",t)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(t){this.storage.setItem("vast-client-total-calls-timeout",t)}}]),t}(),dt=function(t){function e(t,i,s,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,e);var l=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));for(var c in l.ad=i,l.creative=s,l.externalVariables=r,l.variation=a,l.muted=!1,l.impressed=!1,l.skippable=!1,l.trackingEvents={},l.dynamicVariables={},l._alreadyTriggeredQuartiles={},l.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],l.creative.trackingEvents){var h=l.creative.trackingEvents[c];l.trackingEvents[c]=h.slice(0)}return l.creative instanceof E?l._initLinearTracking():l._initVariationTracking(),t&&l.on("start",(function(){t.lastSuccessfulAd=Date.now()})),l}return r(e,t),s(e,[{key:"extend",value:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}},{key:"_initLinearTracking",value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}},{key:"_initVariationTracking",value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var t in this.variation.trackingEvents){var e=this.variation.trackingEvents[t];this.trackingEvents[t]?this.trackingEvents[t]=this.trackingEvents[t].concat(e.slice(0)):this.trackingEvents[t]=e.slice(0)}this.variation instanceof R?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):this.variation instanceof h&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}},{key:"setDuration",value:function(t){this.assetDuration=t,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}},{key:"setProgress",value:function(t){var e=this,i=this.skipDelay||-1;if(-1===i||this.skippable||(i>t?this.emit("skip-countdown",i-t):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){var n=[];if(t>0){var s=Math.round(t/this.assetDuration*100);for(var r in n.push("start"),n.push("progress-"+s+"%"),n.push("progress-"+Math.round(t)),this.quartiles)this.isQuartileReached(r,this.quartiles[r],t)&&(n.push(r),this._alreadyTriggeredQuartiles[r]=!0)}n.forEach((function(t){e.track(t,!0)})),t<this.progress&&this.track("rewind")}this.progress=t}},{key:"isQuartileReached",value:function(t,e,i){var n=!1;return e<=i&&!this._alreadyTriggeredQuartiles[t]&&(n=!0),n}},{key:"setMuted",value:function(t){this.muted!==t&&this.track(t?"mute":"unmute"),this.muted=t}},{key:"setPaused",value:function(t){this.paused!==t&&this.track(t?"pause":"resume"),this.paused=t}},{key:"setFullscreen",value:function(t){this.fullscreen!==t&&this.track(t?"fullscreen":"exitFullscreen"),this.fullscreen=t}},{key:"setExpand",value:function(t){this.expanded!==t&&this.track(t?"expand":"collapse"),this.expanded=t}},{key:"setSkipDelay",value:function(t){"number"==typeof t&&(this.skipDelay=t)}},{key:"trackImpression",value:function(){this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")}},{key:"errorWithCode",value:function(t){this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:t})}},{key:"complete",value:function(){this.track("complete")}},{key:"close",value:function(){this.track(this.linear?"closeLinear":"close")}},{key:"skip",value:function(){this.track("skip"),this.trackingEvents=[]}},{key:"click",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates);var e=this.clickThroughURLTemplate||t;if(e){var i=this.linear?{CONTENTPLAYHEAD:this.progressFormatted()}:{},n=A.resolveURLTemplates([e],i)[0];this.emit("clickthrough",n)}}},{key:"track",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"closeLinear"===t&&!this.trackingEvents[t]&&this.trackingEvents.close&&(t="close");var i=this.trackingEvents[t],n=this.emitAlwaysEvents.indexOf(t)>-1;i?(this.emit(t,""),this.trackURLs(i)):n&&this.emit(t,""),e&&(delete this.trackingEvents[t],n&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(t),1))}},{key:"trackURLs",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(e.ASSETURI=this.creative.mediaFiles[0].fileURL),e.CONTENTPLAYHEAD=this.progressFormatted()),"function"==typeof this.externalVariables&&(e=this.extend(e,this.externalVariables())),A.track(t,e)}},{key:"progressFormatted",value:function(){var t=parseInt(this.progress),e=t/3600;e.length<2&&(e="0"+e);var i=t/60%60;i.length<2&&(i="0"+i);var n=t%60;return n.length<2&&(n="0"+i),e+":"+i+":"+n+"."+parseInt(100*(this.progress-t))}}]),e}(G);e.VASTClient=ht,e.VASTParser=ot,e.VASTTracker=dt},function(t,e,i){"use strict";var n=i(0),s=n.unique("vpaidIframe"),r=i(4);function o(t,e,i,n){i=i||{},this._id=s(),this._destroyed=!1,this._w=window,this._frameContainer=t,this._videoEl=e,this._vpaidOptions=n||{timeout:1e4},"_w"in this._vpaidOptions&&(this._w=this._vpaidOptions._w),this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="referrer" content="unsafe-url" /><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="viewport" content="width=device-width, initial-scale=1.0"><script type="text/javascript">{{smute}}<\/script>{{mutescript}}<script type="text/javascript" src="{{iframeURL_JS}}"><\/script></head><body style="margin:0;padding:0;width:100%;height:100vh;"><div class="ad-element" style="margin:0;padding:0;width:100%;height:100%;"></div><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}", "vendor": "mads"}\', \'*\');<\/script></body></html>',extraOptions:i.extraOptions||{}}}function a(t){var e=this[t];e&&e.parentNode&&(e.parentNode.removeChild(e),delete this[t])}function l(){h.call(this),delete this._adUnit}function c(){h.call(this),u.call(this)}function h(){a.call(this,"_frame"),d.call(this)}function d(){this._onLoad&&(this._w.removeEventListener("message",this._onLoad),delete this._onLoad)}function u(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function g(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}o.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,c.call(this))},o.prototype.isDestroyed=function(){return this._destroyed},o.prototype.loadAdUnit=function(t,e,i){if(this._onLoad)return;g.call(this),c.call(this);var s=this;t="//"==t.substring(0,2)?"https:"+t:t;let o=void 0!==i&&1==i?"true":"false",a="";void 0!==i&&1==i&&(a='<script type="text/javascript" src="data:text/javascript;base64,SFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUub3BsYXkgPSBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5wbGF5OwoKY29uc3QgeyBwcm90b3R5cGUgfSA9IEhUTUxNZWRpYUVsZW1lbnQ7CmNvbnN0IHsgc2V0OiBzZXR0ZXIsIGdldDogZ2V0dGVyIH0gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvdHlwZSwgJ3ZvbHVtZScpOwpjb25zdCB7IHNldDogbXNldHRlciwgZ2V0OiBtZ2V0dGVyIH0gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvdHlwZSwgJ211dGVkJyk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAncGhtYWQnLCB7CiAgICBnZXQ6IG1nZXR0ZXIsCiAgICBzZXQ6IG1zZXR0ZXIKfSk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnc3ZvbCcsIHsKICAgIGdldDogZ2V0dGVyLAogICAgc2V0OiBzZXR0ZXIKfSk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnbXV0ZWQnLCB7CiAgICBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mbXV0ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnBobWFkOwogICAgfSwKICAgIHNldChhcmcpIHsKICAgICAgICBpZiAodGhpcy5waG1hKSB7CiAgICAgICAgICAgIHRoaXMuZm11dGUgPSBhcmc7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBobWFkID0gYXJnOwogICAgfQp9KTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICd2b2x1bWUnLCB7CiAgICBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vdm9sOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuc3ZvbDsKICAgIH0sCiAgICBzZXQoYXJnKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICB0aGlzLm92b2wgPSBhcmc7CgogICAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgIH0KICAgICAgICB0aGlzLnN2b2wgPSBhcmc7CiAgICB9Cn0pOwoKSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0eXBlb2Ygd2luZG93LnBobWEgIT0gInVuZGVmaW5lZCIgJiYgd2luZG93LnBobWEpIHsKICAgICAgICB0aGlzLnBobWEgPSB0cnVlOwogICAgICAgIHRoaXMucGhtYWQgPSB0cnVlOwogICAgICAgIHRoaXMuc3ZvbCA9IDA7CiAgICAgICAgdGhpcy5vdm9sID0gMTsKICAgICAgICB0aGlzLmZtdXRlID0gZmFsc2U7CiAgICB9CgogICAgbGV0IHByb21pc2UgPSB0aGlzLm9wbGF5KCk7CgogICAgaWYgKHR5cGVvZiBwcm9taXNlID09ICd1bmRlZmluZWQnIHx8ICEocHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpKSB7CiAgICAgICAgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKXsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgMTAwMCk7CiAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgIH0KCiAgICByZXR1cm4gcHJvbWlzZTsKfTsK"><\/script>');var h=n.createIframeWithContent(this._frameContainer,this._templateConfig.template,n.extend({iframeURL_JS:t,iframeID:this.getID(),smute:"window.phma = "+o+";",mutescript:a},this._templateConfig.extraOptions));this._frame=h,this._onLoad=n.callbackTimeout(this._vpaidOptions.timeout,function(t){try{var i=JSON.parse(t.data)}catch(t){return}if("mads"===i.vendor&&i.id===s.getID()){var o,a,c;if(s._frame.contentWindow?(c=s._frame.contentWindow.getVPAIDAd,a=n.validate("function"==typeof c,"the ad didn't return a function to create an ad")):a="the iframe is not anymore in the DOM tree",!a){var h=s._frame.contentWindow.document.querySelector(".ad-element");(o=new r(c(),h,s._videoEl,s._frame)).subscribe("AdStopped",l.bind(s)),a=n.validate(o.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return o.vpClient=s,s._adUnit=o,e(a,a?null:o),d.call(s),!0}}.bind(this),function(){e("timeout",null)}.bind(this)),this._w.addEventListener("message",this._onLoad)},o.prototype.unloadAdUnit=function(){c.call(this)},o.prototype.getID=function(){return this._id},t.exports.VPAIDHTML5Client=o},function(t,e,i){"use strict";var n=i(5),s=i(6),r=n.checkVPAIDInterface,o=i(0),a=(n.METHODS,n.EVENTS.filter((function(t){return"AdClickThru"!=t})));function l(t,e,i,n){this._isValid=r(t),this._isValid&&(this._creative=t,this._el=e,this._videoEl=i,this._iframe=n,this._subscribers=new s,o.setFullSizeStyle(e),c.call(this))}function c(){if(a.forEach(function(t){this._creative.subscribe(d.bind(this,t),t)}.bind(this)),this._creative.subscribe(h.bind(this),"AdClickThru"),this._videoEl){var t=this._iframe.contentDocument.documentElement,e=this._videoEl;t.addEventListener("click",(function(i){i.target===t&&e.click()}))}}function h(t,e,i){this._subscribers.triggerSync("AdClickThru",{url:t,id:e,playerHandles:i})}function d(t){for(var e=new Array(arguments.length),i=0;i<e.length;++i)e[i]=arguments[i];if("AdError"==t){var n=JSON.stringify(e.slice(1));console.log("AdUNIT Error",n)}else n=Array.prototype.slice(arguments,1);this._subscribers.trigger(t,n)}function u(t,e,i,n){t?t(i,n):i&&e.trigger("AdError",i)}l.prototype=Object.create(n.prototype),l.prototype.isValidVPAIDAd=function(){return this._isValid},n.METHODS.forEach((function(t){-1===["subscribe","unsubscribe","initAd"].indexOf(t)&&(l.prototype[t]=function(){var e=n.METHODS_LENGTH[t],i=Array.prototype.slice.call(arguments),s=e===i.length?i.pop():void 0;setTimeout(function(){var e,n=null;try{e=this._creative[t].apply(this._creative,i)}catch(t){n=t}u(s,this._subscribers,n,e)}.bind(this),0)})})),l.prototype.initAd=function(t,e,i,n,s,r,a){s=s||{},r=o.extend({slot:this._el,videoSlot:this._videoEl},r||{}),setTimeout(function(){var o;try{console.log("INIT AD",r),this._creative.initAd(t,e,i,n,s,r),console.log(this._creative)}catch(t){o=t}u(a,this._subscribers,o)}.bind(this),0)},l.prototype.subscribe=function(t,e,i){this._subscribers.subscribe(e,t,i)},l.prototype.unsubscribe=function(t,e){this._subscribers.unsubscribe(e,t)},l.prototype.on=l.prototype.subscribe,l.prototype.off=l.prototype.unsubscribe,n.GETTERS.forEach((function(t){l.prototype[t]=function(e){setTimeout(function(){var i,n=null;try{i=this._creative[t]()}catch(t){n=t}u(e,this._subscribers,n,i)}.bind(this),0)}})),l.prototype.setAdVolume=function(t,e){setTimeout(function(){var i,n=null;try{this._creative.setAdVolume(t),i=this._creative.getAdVolume()}catch(t){n=t}n||(n=o.validate(i===t,"failed to apply volume: "+t)),u(e,this._subscribers,n,i)}.bind(this),0)},l.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},t.exports=l},function(t,e,i){"use strict";var n=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function s(t,e,i){}s.prototype.handshakeVersion=function(t,e){},s.prototype.initAd=function(t,e,i,n,s,r,o){},s.prototype.startAd=function(t){},s.prototype.stopAd=function(t){},s.prototype.skipAd=function(t){},s.prototype.resizeAd=function(t,e,i,n){},s.prototype.pauseAd=function(t){},s.prototype.resumeAd=function(t){},s.prototype.expandAd=function(t){},s.prototype.collapseAd=function(t){},s.prototype.subscribe=function(t,e,i){},s.prototype.unsubscribe=function(t,e){},s.prototype.getAdLinear=function(t){},s.prototype.getAdWidth=function(t){},s.prototype.getAdHeight=function(t){},s.prototype.getAdExpanded=function(t){},s.prototype.getAdSkippableState=function(t){},s.prototype.getAdRemainingTime=function(t){},s.prototype.getAdDuration=function(t){},s.prototype.getAdVolume=function(t){},s.prototype.getAdCompanions=function(t){},s.prototype.getAdIcons=function(t){},s.prototype.setAdVolume=function(t,e){},o(s,"METHODS",n),o(s,"METHODS_LENGTH",{handshakeVersion:2,initAd:7,startAd:1,stopAd:1,skipAd:1,resizeAd:4,pauseAd:1,resumeAd:1,expandAd:1,collapseAd:1,subscribe:3,unsubscribe:2}),o(s,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),o(s,"SETTERS",["setAdVolume"]),o(s,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var r=n.filter((function(t){return-1===["skipAd"].indexOf(t)}));function o(t,e,i){Object.defineProperty(t,e,{writable:!1,configurable:!1,value:i})}o(s,"checkVPAIDInterface",(function(t){return r.every((function(e){return"function"==typeof t[e]}))})),t.exports=s},function(t,e,i){"use strict";function n(){this._subscribers={}}n.prototype.subscribe=function(t,e,i){this.isHandlerAttached(t,e)||this.get(e).push({handler:t,context:i,eventName:e})},n.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter((function(e){return t!==e.handler}))},n.prototype.unsubscribeAll=function(){this._subscribers={}},n.prototype.trigger=function(t,e){var i=this;this.get(t).concat(this.get("*")).forEach((function(t){setTimeout((function(){i.isHandlerAttached(t.handler,t.eventName)&&t.handler.call(t.context,e)}),0)}))},n.prototype.triggerSync=function(t,e){this.get(t).concat(this.get("*")).forEach((function(t){t.handler.call(t.context,e)}))},n.prototype.get=function(t){return this._subscribers[t]||(this._subscribers[t]=[]),this._subscribers[t]},n.prototype.isHandlerAttached=function(t,e){return this.get(e).some((function(e){return t===e.handler}))},t.exports=n},function(t,e){const i="ybndrfg8ejkmcpqxot1uwisza345h769",n={};for(let t=0;t<i.length;t++)n[i[t]]=t;function s(t){for(;t<0;)t+=256;return t%=256,String.fromCharCode(t)}e.decode=function(t){for(var e=t.split(""),i=0,r=[],o=[];e.length>0&&!((i=(o=e.splice(0,8)).length)<8);){var a=n[o[0]],l=n[o[1]],c=n[o[2]],h=n[o[3]],d=n[o[4]],u=n[o[5]],g=n[o[6]],p=n[o[7]];r.push(s(a<<3|l>>2)),r.push(s(l<<6|c<<1|h>>4)),r.push(s(h<<4|d>>1)),r.push(s(d<<7|u<<2|g>>3)),r.push(s(g<<5|p))}if(i>0){var f=[];switch(i){case 7:g=n[o[6]],u=n[o[5]];case 5:d=n[o[4]];case 4:h=n[o[3]],c=n[o[2]];case 2:l=n[o[1]],a=n[o[0]]}switch(i){case 7:f.push(s(d<<7|u<<2|g>>3));case 5:f.push(s(h<<4|d>>1));case 4:f.push(s(l<<6|c<<1|h>>4));case 2:f.push(s(a<<3|l>>2))}r=r.concat(f.reverse())}return r.join("")}},function(t,e){String.prototype.replaceArray=function(t,e){for(var i=this,n=0;n<t.length;n++){let s=Array.isArray(e)?e[n]:e;i=i.replace(t[n],s)}return i};const i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];t.exports=class{constructor(t){this.k=t}get(t){let e=(t=>{var e=(t=t.replaceArray([" ",".",",",";"],"")).split(""),n=[];e.forEach((function(t){-1==n.indexOf(t)&&n.push(t)}));let s=n.join("");var r={};return n.forEach((function(t,e){var n=i.indexOf(t),s=i.slice(n,i.length),o=i.slice(0,n);r[e]=s.concat(o)})),{key:s,matrix:r}})(this.k);var n="",s=t.split(""),r=0;return s.forEach((function(t,s){var o=e.matrix[r].indexOf(t);n+=i[o],r==e.key.length-1?r=0:r++})),n=n.replaceArray(["SP","STOP","VIR","DOTVR","2DT","aGR","eGR","eAC","iGR","oGR","uGR"],[" ",".",",",";",":","а","и","й","м","т","щ"])}}},function(t,e){var i={utf8:{stringToBytes:function(t){return i.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(i.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],i=0;i<t.length;i++)e.push(255&t.charCodeAt(i));return e},bytesToString:function(t){for(var e=[],i=0;i<t.length;i++)e.push(String.fromCharCode(t[i]));return e.join("")}}};t.exports=i},function(t,e){String.prototype.isAlpha=function(){return!!this.match(/^[a-z]+$/i)},String.prototype.isUpper=function(){return!!this.match(/^[A-Z]+$/)},String.prototype.isLower=function(){return!!this.match(/^[a-z]+$/)},String.prototype.isDigit=function(){return!!this.match(/^[0-9]+$/)},String.prototype.isSpace=function(){return!!this.match(/^\s+$/)},String.prototype.isEmpty=function(){return""==this},String.prototype.isPunctuation=function(){return!!this.match(/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~\\"]/)},String.prototype.removeDuplicate=function(){return[...new Set(Array.from(this))].join("")},String.prototype.reverse=function(){return Array.from(this).reverse().join("")},String.prototype.replaceStringDuplicate=function(t){let e=this.toUpperCase();for(let i of t.toUpperCase())e=e.replace(i,"");return e},String.prototype.toArray=function(t=!1){return Array.from(t?this.replace(" ",""):this)},String.prototype.shuffle=function(){let t=Array.from(this);for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t.join("")},String.prototype.matchCase=function(t){let e=Array.from(this.replace(/[^\w\s]|[0-9]|\s/g,"")),i="";for(let n of t)n.isAlpha()?(n.isUpper()?i+=e[0].toUpperCase():i+=e[0].toLowerCase(),e.shift()):i+=n;return i},Array.prototype.toDict=function(t){let e=t;return Object.assign(...this.map((t,i)=>({[t]:e[i]})))},Number.prototype.negativeMod=function(t){return(this%t+t)%t},Number.prototype.isNegative=function(){return-1==Math.sign(this)},Number.prototype.isPositive=function(){return 1==Math.sign(this)},Number.prototype.isZero=function(){return 0==Math.sign(this)},String.prototype.replaceArray=function(t,e){for(var i=this,n=0;n<t.length;n++){let s=Array.isArray(e)?e[n]:e;i=i.replace(t[n],s)}return i}},function(t,e,i){var n,s,r,o,a;n=i(12),s=i(9).utf8,r=i(13),o=i(9).bin,(a=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?o.stringToBytes(t):s.stringToBytes(t):r(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var i=n.bytesToWords(t),l=8*t.length,c=1732584193,h=-271733879,d=-1732584194,u=271733878,g=0;g<i.length;g++)i[g]=16711935&(i[g]<<8|i[g]>>>24)|4278255360&(i[g]<<24|i[g]>>>8);i[l>>>5]|=128<<l%32,i[14+(l+64>>>9<<4)]=l;var p=a._ff,f=a._gg,m=a._hh,A=a._ii;for(g=0;g<i.length;g+=16){var v=c,y=h,b=d,w=u;c=p(c,h,d,u,i[g+0],7,-680876936),u=p(u,c,h,d,i[g+1],12,-389564586),d=p(d,u,c,h,i[g+2],17,606105819),h=p(h,d,u,c,i[g+3],22,-1044525330),c=p(c,h,d,u,i[g+4],7,-176418897),u=p(u,c,h,d,i[g+5],12,1200080426),d=p(d,u,c,h,i[g+6],17,-1473231341),h=p(h,d,u,c,i[g+7],22,-45705983),c=p(c,h,d,u,i[g+8],7,1770035416),u=p(u,c,h,d,i[g+9],12,-1958414417),d=p(d,u,c,h,i[g+10],17,-42063),h=p(h,d,u,c,i[g+11],22,-1990404162),c=p(c,h,d,u,i[g+12],7,1804603682),u=p(u,c,h,d,i[g+13],12,-40341101),d=p(d,u,c,h,i[g+14],17,-1502002290),c=f(c,h=p(h,d,u,c,i[g+15],22,1236535329),d,u,i[g+1],5,-165796510),u=f(u,c,h,d,i[g+6],9,-1069501632),d=f(d,u,c,h,i[g+11],14,643717713),h=f(h,d,u,c,i[g+0],20,-373897302),c=f(c,h,d,u,i[g+5],5,-701558691),u=f(u,c,h,d,i[g+10],9,38016083),d=f(d,u,c,h,i[g+15],14,-660478335),h=f(h,d,u,c,i[g+4],20,-405537848),c=f(c,h,d,u,i[g+9],5,568446438),u=f(u,c,h,d,i[g+14],9,-1019803690),d=f(d,u,c,h,i[g+3],14,-187363961),h=f(h,d,u,c,i[g+8],20,1163531501),c=f(c,h,d,u,i[g+13],5,-1444681467),u=f(u,c,h,d,i[g+2],9,-51403784),d=f(d,u,c,h,i[g+7],14,1735328473),c=m(c,h=f(h,d,u,c,i[g+12],20,-1926607734),d,u,i[g+5],4,-378558),u=m(u,c,h,d,i[g+8],11,-2022574463),d=m(d,u,c,h,i[g+11],16,1839030562),h=m(h,d,u,c,i[g+14],23,-35309556),c=m(c,h,d,u,i[g+1],4,-1530992060),u=m(u,c,h,d,i[g+4],11,1272893353),d=m(d,u,c,h,i[g+7],16,-155497632),h=m(h,d,u,c,i[g+10],23,-1094730640),c=m(c,h,d,u,i[g+13],4,681279174),u=m(u,c,h,d,i[g+0],11,-358537222),d=m(d,u,c,h,i[g+3],16,-722521979),h=m(h,d,u,c,i[g+6],23,76029189),c=m(c,h,d,u,i[g+9],4,-640364487),u=m(u,c,h,d,i[g+12],11,-421815835),d=m(d,u,c,h,i[g+15],16,530742520),c=A(c,h=m(h,d,u,c,i[g+2],23,-995338651),d,u,i[g+0],6,-198630844),u=A(u,c,h,d,i[g+7],10,1126891415),d=A(d,u,c,h,i[g+14],15,-1416354905),h=A(h,d,u,c,i[g+5],21,-57434055),c=A(c,h,d,u,i[g+12],6,1700485571),u=A(u,c,h,d,i[g+3],10,-1894986606),d=A(d,u,c,h,i[g+10],15,-1051523),h=A(h,d,u,c,i[g+1],21,-2054922799),c=A(c,h,d,u,i[g+8],6,1873313359),u=A(u,c,h,d,i[g+15],10,-30611744),d=A(d,u,c,h,i[g+6],15,-1560198380),h=A(h,d,u,c,i[g+13],21,1309151649),c=A(c,h,d,u,i[g+4],6,-145523070),u=A(u,c,h,d,i[g+11],10,-1120210379),d=A(d,u,c,h,i[g+2],15,718787259),h=A(h,d,u,c,i[g+9],21,-343485551),c=c+v>>>0,h=h+y>>>0,d=d+b>>>0,u=u+w>>>0}return n.endian([c,h,d,u])})._ff=function(t,e,i,n,s,r,o){var a=t+(e&i|~e&n)+(s>>>0)+o;return(a<<r|a>>>32-r)+e},a._gg=function(t,e,i,n,s,r,o){var a=t+(e&n|i&~n)+(s>>>0)+o;return(a<<r|a>>>32-r)+e},a._hh=function(t,e,i,n,s,r,o){var a=t+(e^i^n)+(s>>>0)+o;return(a<<r|a>>>32-r)+e},a._ii=function(t,e,i,n,s,r,o){var a=t+(i^(e|~n))+(s>>>0)+o;return(a<<r|a>>>32-r)+e},a._blocksize=16,a._digestsize=16,t.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var i=n.wordsToBytes(a(t,e));return e&&e.asBytes?i:e&&e.asString?o.bytesToString(i):n.bytesToHex(i)}},function(t,e){var i,n;i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&n.rotl(t,8)|4278255360&n.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=n.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],i=0,n=0;i<t.length;i++,n+=8)e[n>>>5]|=t[i]<<24-n%32;return e},wordsToBytes:function(t){for(var e=[],i=0;i<32*t.length;i+=8)e.push(t[i>>>5]>>>24-i%32&255);return e},bytesToHex:function(t){for(var e=[],i=0;i<t.length;i++)e.push((t[i]>>>4).toString(16)),e.push((15&t[i]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],i=0;i<t.length;i+=2)e.push(parseInt(t.substr(i,2),16));return e},bytesToBase64:function(t){for(var e=[],n=0;n<t.length;n+=3)for(var s=t[n]<<16|t[n+1]<<8|t[n+2],r=0;r<4;r++)8*n+6*r<=8*t.length?e.push(i.charAt(s>>>6*(3-r)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],n=0,s=0;n<t.length;s=++n%4)0!=s&&e.push((i.indexOf(t.charAt(n-1))&Math.pow(2,-2*s+8)-1)<<2*s|i.indexOf(t.charAt(n))>>>6-2*s);return e}},t.exports=n},function(t,e){function i(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */t.exports=function(t){return null!=t&&(i(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&i(t.slice(0,0))}(t)||!!t._isBuffer)}},function(t,e,i){"use strict";i.r(e);var n=function(){this.check={percentViewable:0,percentFps:0,percentIntersection:0,acceptedViewablePercentage:50,acceptedMrcPercentage:50,viewabilityStatus:!1,duration:0,measureTime:2e3},this.timer=null,this.ad=null,this.statusCallback=null,this.startTime=null,this.config={},this.log=function(){if(this.config.debug||this.config.showLog){var t=["%cMOVIEADS-Stage OAV ["+this.config.stageNum.toString()+"]: ","background-color: orange; color: black; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}},this.DEBUG_MODE=!1,this.cancelCheck=function(){window.cancelAnimationFrame(this.timer)},this.getTime=function(){return"object"==typeof window.performance?window.performance.now():(new Date).getTime()},this.checkViewability=function(t,e){this.ad=t,this.statusCallback=e,this.startTime=this.getTime(),this.timer=window.requestAnimationFrame(this.countDownStart.bind(this))},this.countDownStart=function(){this.log("MRC countDownStart"),this.checkViewable()||(this.log("OAV MRC TRACKER STATS, visibility: ",this.check.percentFps,", mrc vis: ",this.check.percentFps,"accepted fps: ",this.check.acceptedMrcPercentage," viwability: ",this.check.acceptedViewablePercentage,"fps: ",this.ad.fps),this.startTime=this.getTime(),this.resetCheck());var t=this.getTime()-this.startTime,e=t>=this.check.measureTime;this.check.duration=t,e?(this.check.viewabilityStatus=this.check.percentViewable>=this.check.acceptedViewablePercentage,this.check.viewabilityStatus&&this.statusCallback(this.check)):this.timer=window.requestAnimationFrame(this.countDownStart.bind(this))},this.resetCheck=function(){this.check.percentFps=0,this.check.percentIntersection=0,this.check.percentViewable=0,this.check.duration=0,this.check.viewabilityStatus=!1},this.checkViewable=function(){let t=this.ad.visibility;return Math.floor(100*this.ad.fps/this.ad.baseFps),this.check.percentIntersection=t,this.check.percentViewable=Math.floor(t),!(t<this.check.acceptedViewablePercentage||t<this.check.acceptedMrcPercentage)&&this.check.percentViewable}};const s=i(1);var r=function(t){this.setupConfig=t,this.defaultZIndex=800,this.mutedVideoScript="SFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUub3BsYXk9SFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUucGxheTtjb25zdHtwcm90b3R5cGU6cHJvdG90eXBlfT1IVE1MTWVkaWFFbGVtZW50LHtzZXQ6c2V0dGVyLGdldDpnZXR0ZXJ9PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG90eXBlLCJ2b2x1bWUiKSx7c2V0Om1zZXR0ZXIsZ2V0Om1nZXR0ZXJ9PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG90eXBlLCJtdXRlZCIpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsInNtdXRlZCIse2dldDptZ2V0dGVyLHNldDptc2V0dGVyfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwic3ZvbCIse2dldDpnZXR0ZXIsc2V0OnNldHRlcn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsIm11dGVkIix7Z2V0KCl7cmV0dXJuIHRoaXMuc211dGU/dGhpcy5mbXV0ZTp0aGlzLnNtdXRlZH0sc2V0KHQpe3RoaXMuc211dGU/dGhpcy5mbXV0ZT10OnRoaXMuc211dGVkPXR9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZSwidm9sdW1lIix7Z2V0KCl7cmV0dXJuIHRoaXMuc211dGU/dGhpcy5vdm9sOnRoaXMuc3ZvbH0sc2V0KHQpe3RoaXMuc211dGU/dGhpcy5vdm9sPXQ6dGhpcy5zdm9sPXR9fSksSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUucGxheT1mdW5jdGlvbigpe3ZvaWQgMCE9PXdpbmRvdy5zbXV0ZSYmd2luZG93LnNtdXRlJiYodGhpcy5zbXV0ZT0hMCx0aGlzLnNtdXRlZD0hMCx0aGlzLnN2b2w9MCx0aGlzLm92b2w9MSx0aGlzLmZtdXRlPSExKTtsZXQgdD10aGlzLm9wbGF5KCk7cmV0dXJuIHZvaWQgMCE9PXQmJnQgaW5zdGFuY2VvZiBQcm9taXNlfHwodD1uZXcgUHJvbWlzZShmdW5jdGlvbih0LGUpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXt0KCEwKX0uYmluZCh0aGlzKSwyZTMpfS5iaW5kKHRoaXMpKSksdH07",this.config={friendly:!0,stageNum:0,mspLink:"",stageManager:null,nvpaid:null,container:null,videoSlot:null,channel:null,rounds:1,ap:!0,key:null,mips:500,debug:!1,session:null,subsession:null,logall:!1,volume:0,pxy:!1,disableLogger:!0,showLog:!1,currentPartner:{ci:"impression",tag:"",mvt:0,id:0,trackings:{i:[],f:[],m:[],t:[],c:[],ck:[],tt:[],s:[]},mrc:!1,pos:1,fl:!1,dnr:!1,fsnd:!1},tmts:{evt:30,int:30,sti:30,fst:30},instant:!1,moduleNCSS:"",fle:[]},this.ttiTimeout=30,this.ttiImps=0,this.onInit=!1,this.workedRounds=0,this.listenerWindow=null,this.stageFrame=null,this.module_ready=!1,this.lastEvent=null,this.impsCount=0,this.imp_uuid=null,this.startFlag=!1,this.lastTouch=new Date,this.rendered=!1,this.mrcStatus=!1,this.fraudStart=!1,this.watcherStarted=!1,this.globalInitTimeout=60,this.frameMessagePort=null,this.timeouts=[],this.intervals=[],this.currentAdLinkTime=null,this.showStageTime=null,this.dynamicParams={"[gguid]":this.imp_uuid},this.AD_ERROR="movieads_error",this.AD_SKIP="movieads_ad_skip",this.AD_CLICK="movieads_ad_click",this.AD_NOADS="movieads_no_ads",this.AD_IMP="movieads_ad_imp",this.AD_FQ="movieads_ad_fq",this.AD_MP="movieads_ad_mp",this.AD_TQ="movieads_ad_tq",this.AD_COMP="movieads_ad_complete",this.MOVIEADS_MODULE_READY="movieads_ready",this.AD_VSTART="movieads_ad_vstart",this.AD_ROLL_COMP="movieads_ad_roll_complete",this.eventBinds={movieads_ad_imp:"impression",movieads_ad_fq:"firstQuartile",movieads_ad_mp:"midpoint",movieads_ad_tq:"thirdQuartile",movieads_ad_complete:"complete"},this.initRetries=1,this.oav=null,this.init=function(t){if(this.startFlag=!1,this.fraudStart=!1,null!=this.stageFrame&&this.stageFrame.parentNode.removeChild(this.stageFrame),this.config=Object.assign({},this.config,this.setupConfig),this.config.friendly=!("friendly"in this.config.currentPartner)||this.config.currentPartner.friendly,this.log("config",this.config),this.setDynamicParam("[adsrc]",this.config.currentPartner.adsrc),this.oav=new n,this.oav.check.acceptedViewablePercentage=this.config.currentPartner.mvt,this.oav.check.acceptedMrcPercentage=this.config.currentPartner.avt_min,this.oav.check.measureTime=this.config.currentPartner.avt_time,this.oav.config=this.config,void 0===t){let t=setTimeout(function(){0==this.rendered&&this.initRetries>0?(this.log("STAGE RENDER TIMEOUT"),this.init(!0),this.initRetries--):0==this.initRetries&&(this.logger("stage_init_timeout",this.config.stageNum,void 0,!0),this.destroy("stage_init_timeout"),this.log("DESTROING BY INIT TIMEOUT"))}.bind(this),3e3);this.timeouts.push(t)}this.remoteReady=t=>{if(this.log("RENDER STAGE CALLBACK",t),1==this.rendered)return;if(this.config.friendly&&void 0===this.listenerWindow.manager)return this.logger("listenerWindow_manager_undefined",JSON.stringify({caller:t,stageNum:this.config.stageNum,manager:typeof this.listenerWindow.manager}),void 0,!0),void this.log("stageFrame_contentDocument",this.stageFrame.contentDocument);this.rendered=!0;let e={mute:!0,autoplay:this.config.ap,key:this.config.key,slot:"content",mips:this.config.mips,debug:this.config.debug,vpaidModule:this,session:this.config.session,logall:this.config.logall,volume:this.config.volume,pxy:this.config.pxy,proxyVideo:this.config.pxy?this.config.proxyVideo:null,disableLogger:this.config.disableLogger,stageNum:this.config.stageNum,showLog:this.config.showLog,currentPartner:this.config.currentPartner,fle:this.config.fle,friendly:this.config.friendly};0==this.config.friendly?e.vpaidModule=null:e.slot=this.listenerWindow.document.getElementById("content"),this.callStpFunction("init",[e]),this.logger("render_stage_callback",this.config.stageNum)},this.renderStage(this.remoteReady),this.log("REF",document.referrer)},this.callStpFunction=(t,e)=>{if(this.config.friendly)return this.listenerWindow.manager[t].apply(this.listenerWindow.manager,e);{let i={t:"stp",f:t,p:e};this.frameMessagePort.postMessage(i)}},this.touch=function(){this.lastTouch=new Date},this.runAds=function(t){let e=this.config.currentPartner.run_state;if("fsz"in this.config.currentPartner){let t=this.config.currentPartner.fsz,e=window.document.body.getBoundingClientRect();if(e.width<t.x||e.height<t.y)return this.logger("small_player_skip",""),this.log("SMALL PLAYER SKIP"),void this.destroy("small_player_skip")}if(0==this.config.stageManager.playerVisible&&"visible"!=document.visibilityState||"visible"==e&&e!=document.visibilityState){var i={tag:this.config.currentPartner.tag,mvt:this.config.currentPartner.mvt,fps:this.config.nvpaid.fps,id:this.config.currentPartner.id,cvt:this.config.nvpaid.visibility,rst:e,vst:document.visibilityState,pvt:this.config.stageManager.playerVisible,pvts:this.config.stageManager.playerVisibleChecks,instant:this.config.instant};return this.logger("invisible_player_skip",JSON.stringify(i)),this.log("INVISIBLE PLAYER SKIP"),void this.destroy("invisible_player_skip")}this.showStage("this.runAds"),this.lastEvent=new Date,0==this.startFlag&&(this.currentAdLinkTime=new Date,this.initEventWatcher()),this.startFlag=!0,setTimeout(function(){this.callStpFunction("runAds",[])}.bind(this),1e3),this.log("RUN STAGE",t,this.config.stageNum);let n={visibility:this.config.nvpaid.visibility,fps:this.config.nvpaid.fps,playerVisible:this.config.stageManager.playerVisible,docVisibility:document.visibilityState,cvt:this.config.nvpaid.visibility};this.logger("run_ads",JSON.stringify(n))},this.moduleReady=function(){this.log("module ready"),0==this.module_ready&&(this.module_ready=!0,this.runPartner("MODULE_READY"))},this.stageStarted=function(){"fsz"in this.config.currentPartner&&this.config.stageManager.setFsz(this.config.currentPartner.fsz,this.config.currentPartner.id)},this.runPartner=function(t){if(this.log("runPartner",t),this.lastEvent=new Date,this.ping(),0==this.config.currentPartner.avt){let t=!0;if(0==(this.config.nvpaid.visibility>=this.config.currentPartner.mvt&t)){var e={tag:this.config.currentPartner.tag,mvt:this.config.currentPartner.mvt,fps:this.config.nvpaid.fps,id:this.config.currentPartner.id,cvt:this.config.nvpaid.visibility,instant:this.config.instant,vst:document.visibilityState};return this.logger("min_vt_skip",JSON.stringify(e),void 0,!0),this.log("MIN_VT_MRC SKIP"),this.config.nvpaid.nullVisibility(),void this.destroy("min_vt_mrc")}}let i=this.config.currentPartner.run_state;if("visible"==i&&i!=document.visibilityState)return this.logger("invisible_run_partner_skip"),void this.destroy("invisible_run_partner_skip");this.logger("run_partner",t),this.log("TRYING AD",t),"ttitmt"in this.config.currentPartner||(this.config.currentPartner.ttitmt=this.ttiTimeout),this.globalInitTimeout=this.config.currentPartner.ttitmt,"rawTag"in this.config.currentPartner?this.config.currentPartner.tag=this.config.currentPartner.rawTag:this.config.currentPartner.rawTag=this.config.currentPartner.tag,"fsz"in this.config.currentPartner&&this.config.stageManager.setFsz(this.config.currentPartner.fsz,this.config.currentPartner.id),this.config.currentPartner.tag=this.config.nvpaid.replaceLinkParams(this.config.currentPartner.tag,this.dynamicParams),this.log("currentPartner",this.config.currentPartner),this.logger("current_partner",this.config.currentPartner.tag),this.currentAdLink=this.config.currentPartner.tag,this.currentAdLinkTime=new Date;var n={tag:this.config.currentPartner.tag,mvt:this.config.currentPartner.mvt,id:this.config.currentPartner.id,cvt:this.visibility,fl:this.config.currentPartner.fl,partner:this.config.currentPartner,tmts:this.config.tmts};this.config.friendly?this.listenerWindow.manager.playAds(n,this.destroy.bind(this)):this.callStpFunction("playAds",[n,"destroy"]),this.startInitTimeout()},this.writeFrame=function(t,e){let i=setTimeout(function(){let i=e.open(),n=i.readyState;this.log("doc write status",n,i),e.write(t),e.close()}.bind(this),100);this.timeouts.push(i)},this.renderRemoteStage=()=>{},this.renderStage=function(t){var e=this.config.container&&"DIV"===this.config.container.nodeName;this.log("slotExists",e,this.config.container),this.defaultZIndex-=this.config.stageNum;var i=document.createElement("iframe");i.style.width="100%",i.style.height="100%",i.style.minHeight="100%",i.style.minWidth="100%",i.style.backgroundColor="transparent",i.style.position="absolute",i.style.top=0,i.style.zIndex=this.defaultZIndex.toString();let n=this.guid();if(i.setAttribute("id",n),i.setAttribute("frameborder","0"),i.setAttribute("allow","autoplay"),i.setAttribute("scrolling","no"),i.setAttribute("frameborder","0"),i.setAttribute("marginheight","0px"),i.setAttribute("marginwidth","0px"),i.setAttribute("webkitallowfullscreen","true"),i.setAttribute("allowfullscreen","true"),i.setAttribute("mozallowfullscreen","true"),this.log("friendly",this.config.friendly),this.config.friendly)i.onload=function(){i.onload=null,this.log("Stage frame onload");let e=i.contentWindow.document||i.contentDocument;this.listenerWindow=i.contentWindow,this.stageFrame=i,this.listenerWindow.vpaidModule=this,this.listenerWindow.readyCallback=t,this.listenerWindow.cssReady=!1,this.listenerWindow.jsReady=!1,this.listenerWindow.blankMP4="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAJ21kYXQBQCKAo3hQhS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAAC8G1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAALAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIadHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAALAAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAAB////9QAACAAAAQAAAAABkm1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAABdwAAAAQAVcQAAAAAAC1oZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU291bmRIYW5kbGVyAAAAAT1taW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAQFzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAAAAAAAAAAADNlc2RzAAAAAAOAgIAiAAEABICAgBRAFQAAAAAAWtIAAFrSBYCAgAIQCAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAAABAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAfAAAAAQAAABRzdGNvAAAAAAAAAAEAAAAsAAAAGnNncGQBAAAAcm9sbAAAAAIAAAAB//8AAAAcc2JncAAAAAByb2xsAAAAAQAAAAEAAAABAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ny44My4xMDA=",this.listenerWindow.stagePlayer=s,this.listenerWindow.initPlayer=function(t){t.manager=new this.stagePlayer(this)},this.log("doc ready state",e.readyState),this.listenerWindow.stagePlayer=s;let r='setInterval(function () { console.log("WORKING", "'+n+'") }, 1000);';r="",this.log("STAGENUM",this.config.stageNum,typeof this.config.stageNum,e);let o=["<!doctype html>",'<html style="margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%;">',"<head>",'<meta charset="UTF-8">','<meta name="referrer" content="unsafe-url" />','<meta name="viewport" content="width=device-width, initial-scale=1.0">','<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">','<link rel="stylesheet" href="'+this.config.moduleNCSS+'"/>',this.config.currentPartner.fsnd?'<script type="text/javascript" src="data:text/javascript;base64,SFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUub3BsYXkgPSBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5wbGF5OwoKY29uc3QgeyBwcm90b3R5cGUgfSA9IEhUTUxNZWRpYUVsZW1lbnQ7CmNvbnN0IHsgc2V0OiBzZXR0ZXIsIGdldDogZ2V0dGVyIH0gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvdHlwZSwgJ3ZvbHVtZScpOwpjb25zdCB7IHNldDogbXNldHRlciwgZ2V0OiBtZ2V0dGVyIH0gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvdHlwZSwgJ211dGVkJyk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAncGhtYWQnLCB7CiAgICBnZXQ6IG1nZXR0ZXIsCiAgICBzZXQ6IG1zZXR0ZXIKfSk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnc3ZvbCcsIHsKICAgIGdldDogZ2V0dGVyLAogICAgc2V0OiBzZXR0ZXIKfSk7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCAnbXV0ZWQnLCB7CiAgICBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mbXV0ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnBobWFkOwogICAgfSwKICAgIHNldChhcmcpIHsKICAgICAgICBpZiAodGhpcy5waG1hKSB7CiAgICAgICAgICAgIHRoaXMuZm11dGUgPSBhcmc7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBobWFkID0gYXJnOwogICAgfQp9KTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsICd2b2x1bWUnLCB7CiAgICBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vdm9sOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuc3ZvbDsKICAgIH0sCiAgICBzZXQoYXJnKSB7CiAgICAgICAgaWYgKHRoaXMucGhtYSkgewogICAgICAgICAgICB0aGlzLm92b2wgPSBhcmc7CgogICAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgIH0KICAgICAgICB0aGlzLnN2b2wgPSBhcmc7CiAgICB9Cn0pOwoKSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0eXBlb2Ygd2luZG93LnBobWEgIT0gInVuZGVmaW5lZCIgJiYgd2luZG93LnBobWEpIHsKICAgICAgICB0aGlzLnBobWEgPSB0cnVlOwogICAgICAgIHRoaXMucGhtYWQgPSB0cnVlOwogICAgICAgIHRoaXMuc3ZvbCA9IDA7CiAgICAgICAgdGhpcy5vdm9sID0gMTsKICAgICAgICB0aGlzLmZtdXRlID0gZmFsc2U7CiAgICB9CgogICAgbGV0IHByb21pc2UgPSB0aGlzLm9wbGF5KCk7CgogICAgaWYgKHR5cGVvZiBwcm9taXNlID09ICd1bmRlZmluZWQnIHx8ICEocHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpKSB7CiAgICAgICAgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKXsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgMTAwMCk7CiAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgIH0KCiAgICByZXR1cm4gcHJvbWlzZTsKfTsK"><\/script>':"",'<script type="text/javascript">window.movieadsLoaded = true;<\/script>',"</head>",'<body style="margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background-color: black">','<div class="debugmarker" style="width: 50px;height:50px;line-height: 50px;text-align: center;background-color: red;color: white;top: 0; left: 0; font-size: 25px; display: none;position: absolute;"></div>','<div id="content" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 100;">',"</div>",'<script type="text/javascript">',"(function () {",(this.config.stageNum,""),"window.initPlayer(window);","})();","<\/script>","</body>","</html>"],a=this.writeFrame(o.join(""),e);this.log("DOC WRITE",a);var l=setInterval(function(){if(void 0===this.listenerWindow.document)return;let e=this.listenerWindow.document.readyState;-1!=["complete","interactive"].indexOf(e)&&void 0!==this.listenerWindow.manager&&(this.log("DOC STATE IS: ",e),clearInterval(l),t("ready_state_watcher"),this.logger("ready_state_watcher_callback",this.config.stageNum))}.bind(this),500);this.intervals.push(l)}.bind(this);else{const t=new MessageChannel;t.port1.onmessage=this.portExecutor,this.frameMessagePort=t.port1,i.onload=()=>{this.listenerWindow=i.contentWindow,this.stageFrame=i,i.contentWindow.postMessage("hello_stp","*",[t.port2])};let e={fsnd:this.config.currentPartner.fsnd?"yes":"no",dbg:this.config.debug?"yes":"no",stn:this.config.stageNum},n=[];for(let t in e)"swapDict"!=t&&n.push(t+"="+encodeURIComponent(e[t]));let s=n.join("&"),r="https://"+this.config.currentPartner.td+"/stp.php?"+s;this.log("foreign fakeFrame url",r),i.src=r}i.onerror=function(){this.logger("fake_frame_load_error","",void 0,!0),this.destroy("fake_frame_load_error")}.bind(this),this.config.container.appendChild(i)},this.checkAlive=()=>new Promise((t,e)=>{let i=setTimeout(()=>{t(!1)},2e3);if(this.config.friendly){let e=this.callStpFunction("checkAlive");clearTimeout(i),t(e)}else{const e=new MessageChannel;e.port1.onmessage=({data:n})=>{clearTimeout(i),e.port1.close(),t(n)};let n={t:"stp",f:"checkAlive",p:[]};this.frameMessagePort.postMessage(n,[e.port2])}}),this.portExecutor=t=>{"object"==typeof t.data&&"t"in t.data&&"f"in t.data&&"p"in t.data&&("stm"==t.data.t&&"function"==typeof this.config.stageManager[t.data.f]&&this.config.stageManager[t.data.f].apply(this.config.stageManager,t.data.p),"st"==t.data.t&&"function"==typeof this[t.data.f]&&this[t.data.f].apply(this,t.data.p))},this.initEventWatcher=function(){if(this.watcherStarted)return;this.watcherStarted=!0;let t=setInterval(function(){let t=(new Date).getTime(),e=(t-this.lastEvent.getTime())/1e3;null!=this.showStageTime&&(t-this.showStageTime.getTime())/1e3>=this.config.tmts.fst&&0==this.impsCount&&0==this.fraudStart&&(this.fraudStart=!0,this.log("EVENT_WATCHER","Fraud start!"),this.logger("event_watcher","fraud_start"),this.config.stageManager.runNextStage("fraud_stage_start")),e>=this.config.tmts.evt&&(this.log("EVENT_WATCHER","Destroying stage!"),this.logger("event_watcher","no_events"),this.destroy("no_events"))}.bind(this),5e3);this.intervals.push(t)},this.eventTracker=function(t){(new Image).src=t},this.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.logger=function(t,e,i,n){if(-1==this.config.fle.indexOf(t)&&this.config.disableLogger&&0==this.config.currentPartner.fl&&"invisible_player_skip"!=t&&(void 0===n||0==n))return;let s=void 0===e?"":e;var r=void 0!==window.location.ancestorOrigins?JSON.stringify(window.location.ancestorOrigins):"",o={t:"stage",c:this.config.session,a:t,m:s,v:this.config.key,o:r,cid:"object"==typeof this.config.currentPartner&&"id"in this.config.currentPartner?this.config.currentPartner.id:0},a=[];for(var l in o)"swapDict"!=l&&a.push(l+"="+encodeURIComponent(o[l]));var c=a.join("&"),h=new Image;void 0!==i&&(h.onload=i,h.onerror=i),h.src="https://l2.moviead55.ru/logger.php?"+c},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.destroyed=!1,this.destroy=function(t){this.workedRounds++;var e=new Date;null==this.currentAdLinkTime&&(this.currentAdLinkTime=new Date);var i=(e.getTime()-this.currentAdLinkTime.getTime())/1e3;if(this.logger("vast_work",JSON.stringify({work_time:i.toString(),imps:this.impsCount,round:this.workedRounds})),"fsz"in this.config.currentPartner&&this.config.stageManager.nextFsz(this.config.currentPartner.id),this.impsCount>0&&this.config.rounds>this.workedRounds&&0==this.config.currentPartner.dnr)return this.runPartner("partner_retry"),this.log("partner_retry"),void this.logger("partner_retry",this.config.stageNum);this.destroyed?this.log("ALREADY DESTROYED!"):(this.hideStage("destroy"),this.destroyed=!0,this.clearTimeouts(),this.log("BEFORE REMOVE"),this.config.container.removeChild(this.stageFrame),this.log("BEFORE STAGE DESTROY"),this.config.stageManager.destroyStage(this.config.stageNum),this.log("Destroing STAGE",t),this.logger("destroy_stage",t))},this.clearTimeouts=function(){this.log("Clearing timeouts and intervals"),this.config.debug,this.intervals.length>0&&this.intervals.forEach((function(t){clearInterval(t)})),this.timeouts.length>0&&this.timeouts.forEach((function(t){clearTimeout(t)}))},this.sendStageManagerMessage=function(t){this.config.stageManager.receiveStageMassage(this.config.stageNum,t)},this.receiveEvent=function(t){this.log("Receive EVENT",t,this.config.currentPartner.id),t!=this.AD_IMP&&(this.config.nvpaid.receiveEvent(t),t in this.eventBinds&&this.config.currentPartner.ci==this.eventBinds[t]&&this.config.nvpaid.receiveEvent(this.AD_IMP)),this.sendStageManagerMessage(t),this.lastEvent=new Date,"on_init"==t&&(this.onInit=!0),t==this.AD_COMP&&(this.onInit=!0,this.oav.cancelCheck(),this.initEventWatcher(),this.trackEvent("c"),this.log(this.impsCount,this.config.mips),this.config.mips>0&&this.impsCount>=this.config.mips&&(this.logger("max_imps_reached",JSON.stringify({mips:this.config.mips,impsCount:this.impsCount}),void 0,!0),this.destroy("max_imps_reached"))),t==this.AD_NOADS&&(this.logger("vpaid_module","no_ads",""),this.destroy("no_ads")),t==this.AD_ROLL_COMP&&(this.logger("ad_roll_complete",this.impsCount),this.oav.cancelCheck(),this.config.mips>0&&this.impsCount>=this.config.mips&&this.destroy("max_imps_reached_roll_comp")),t==this.AD_FQ&&(this.ttiImps,this.onInit=!0,this.initEventWatcher(),this.trackEvent("f")),t==this.AD_VSTART&&this.trackEvent("st"),t==this.AD_MP&&(this.onInit=!0,this.trackEvent("m"),this.initEventWatcher()),t==this.AD_TQ&&(this.onInit=!0,this.trackEvent("t"),this.initEventWatcher()),t==this.AD_SKIP&&this.trackEvent("s"),t==this.AD_CLICK&&this.trackEvent("ck"),t==this.AD_IMP&&(this.onInit=!0,this.initEventWatcher(),this.runImpressionLogic(),t in this.eventBinds&&this.config.currentPartner.ci==this.eventBinds[t]&&this.config.nvpaid.receiveEvent(t))},this.startInitTimeout=function(){let t=setInterval(function(){if(0==this.ttiImps&&0==this.globalInitTimeout)return clearInterval(t),void this.destroy("global_init_timeout");this.globalInitTimeout--}.bind(this),1e3);this.intervals.push(t)},this.setDynamicParam=function(t,e){this.dynamicParams[t]=e},this.recalculateTimeout=function(t){t>2&&(this.globalInitTimeout=t*this.config.currentPartner.ttitmt,this.globalInitTimeout=this.globalInitTimeout>45?45:this.globalInitTimeout,this.log("Recalculated GLOBAL INIT TIMEOUT!",this.globalInitTimeout))},this.trackEvent=function(t){this.ping(),this.config.currentPartner.avt&&0==this.mrcStatus?this.log("SKIP EVENT TRACK, event:",t,", mrcStatus",this.mrcStatus):t in this.config.currentPartner.trackings&&this.config.currentPartner.trackings[t].length>0&&this.config.currentPartner.trackings[t].forEach(function(e){this.log("tracking event",t,e);let i=this.config.nvpaid.replaceLinkParams(e,this.dynamicParams);this.eventTracker(i)}.bind(this))},this.log=function(){if(this.config.debug||this.config.showLog){var t=["%cMOVIEADS-Stage ["+this.config.stageNum.toString()+"]: ","background-color: orange; color: black; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}},this.runImpressionLogic=function(){this.log("RUN IMPRESSION LOGIC"),this.ttiImps++,this.config.nvpaid.onStage(),this.imp_uuid=this.guid(),this.setDynamicParam("[gguid]",this.imp_uuid),this.impsCount++;var t=((new Date).getTime()-this.currentAdLinkTime.getTime())/1e3;1==this.ttiImps?this.setDynamicParam("[tti]",t):this.setDynamicParam("[tti]",-1);var e={visibility:this.config.nvpaid.visibility,imp_uuid:this.imp_uuid,vastUrl:this.config.currentPartner.tag,subs:this.config.subsession,tti:t,ttiImp:this.impsCount,startFlag:this.startFlag,stageNum:this.config.stageNum,impressingStage:this.config.stageManager.impressingStages.toString(),stageOnline:this.config.stageManager.stageOnline,zIndex:this.stageFrame.style.zIndex};if(this.logger("ad_impression",JSON.stringify(e),void 0,!0),"js"in this.config.currentPartner.pm){let t=this.config.nvpaid.replaceLinkParams(this.config.currentPartner.pm.js,this.dynamicParams);this.callStpFunction("deployPMediaScript",[t])}this.config.currentPartner.avt?this.oav.checkViewability(this.config.nvpaid,function(t){this.log("MRC CALLBACK",t),t.viewabilityStatus?(this.log("MRC VIEWABILITY TRACKED!",t),this.mrcStatus=!0,this.trackEvent("i"),this.trackEvent("tt"),0!=this.config.nvpaid.creativeData_.cimp&&this.eventTracker(this.config.nvpaid.creativeData_.cimp)):this.log("AD IS NOT VIEWABLE! SKIP TRACKING!")}.bind(this)):(this.trackEvent("i"),this.trackEvent("tt"),0!=this.config.nvpaid.creativeData_.cimp&&this.eventTracker(this.config.nvpaid.creativeData_.cimp))},this.ping=function(){this.config.nvpaid.ping()},this.showStage=function(t){null==this.showStageTime&&(this.showStageTime=new Date),this.setZIndex("10000"),this.log("SHOW STAGE:",this.config.stageNum,t),this.logger("show_stage",this.config.stageNum)},this.setZIndex=function(t){this.log("ZINDEX change: ",t),this.logger("ZINDEX change: ",t),this.stageFrame.style.zIndex=t},this.hideStage=function(){1e4==parseInt(this.stageFrame.style.zIndex)&&(this.log("HIDE STAGE, zIndex: ",this.stageFrame.style.zIndex,"->",this.defaultZIndex),this.logger("HIDE STAGE, zIndex: ",this.stageFrame.style.zIndex+"->"+this.defaultZIndex),this.setZIndex(this.defaultZIndex.toString()))},this.once=function(t,e){var i;return function(){return t&&(i=t.apply(e||this,arguments),t=null),i}}};i(1);var o=function(t){this.setupConfig=t,this.lastDeploy=null,this.config={stageNum:0,mspLink:"",stageManager:null,workingStagesNum:4,nvpaid:null,container:null,videoSlot:null,channel:null,rounds:1,ap:!0,key:null,isp:0,mips:500,debug:!1,session:null,subsession:null,logall:!1,volume:0,pxy:!1,disableLogger:!0,showLog:!1,irun:!0,firstBlockQueue:4,tmts:{evt:30,int:30,sti:30},instant:!1,moduleNCSS:"",fle:[]},this.fsz={},this.lastReceivedStageMassage=null,this.lastStageShowTime=null,this.stageOnline=null,this.playerVisible=!0,this.canPlayHidden=!0,this.playerStarted=!1,this.workingStages={},this.impressingStages=[],this.destroyedStages=[],this.stagesOnHold=[],this.jmap=[],this.jmap2=[],this.bannersJmap=[],this.bannerManager=null,this.firstBlockImpression=!1,this.twoBlocks=!1,this.stageCount=1,this.countdownTimer=null,this.preloader=null,this.impsCount=0,this.stageTimeout=120,this.stageImps=0,this.AD_ERROR="movieads_error",this.AD_SKIP="movieads_ad_skip",this.AD_CLICK="movieads_ad_click",this.AD_NOADS="movieads_no_ads",this.AD_IMP="movieads_ad_imp",this.AD_FQ="movieads_ad_fq",this.AD_MP="movieads_ad_mp",this.AD_TQ="movieads_ad_tq",this.AD_COMP="movieads_ad_complete",this.MOVIEADS_MODULE_READY="movieads_ready",this.AD_VSTART="movieads_ad_vstart",this.AD_ROLL_COMP="movieads_ad_roll_complete",this.HAVE_DIRECT_ADS="movieads_have_direct_ads",this.adEvents=[this.AD_IMP,this.AD_FQ,this.AD_MP,this.AD_TQ,this.AD_COMP],this.partnerSwitch=function(){this.log("FSZ partner switch");try{window.parent.postMessage("partner_switch","*")}catch(t){}},this.closeLogicSent=!1,this.currentCloseLogic=0,this.setCloseLogic=function(t){this.log("SETTING Close Logic to: ",t);try{window.parent.postMessage("movieads_close"+t.toString(),"*")}catch(t){}},this.nextFsz=function(t){t in this.fsz&&delete this.fsz[t];let e=Object.keys(this.fsz);if(1==e.length){let i=this.fsz[e[0]];try{this.log("Setting FSZ (if)",i),window.parent.postMessage({fsz:i},"*")}catch(t){}}else if(e.length>1){let e=Object.entries(this.fsz).sort((function(t,e){return t[1].x<e[1].x?1:t[1].x>e[1].x?-1:0})).shift();try{this.log("Setting FSZ (elif)",e),window.parent.postMessage({fsz:e},"*")}catch(t){}}else this.partnerSwitch()},this.setFsz=function(t,e){this.log("Received FSZ command",e,t);let i=Object.keys(this.fsz);if(-1!=i.indexOf(e))return void this.log("Partner FSZ already in QUEUE");let n=!1;if(i>0&&Object.entries(this.fsz).forEach(function(i){let s=i[1];this.log("Checking FSZ",s.x,t.x,s.x>t.x,s.y,t.y,s.y>t.y),(s.x>t.x||s.y>t.y)&&(this.log("Partners FSZ is lower than received",e,t),n=!0)}.bind(this)),this.fsz[e]=t,0==n)try{this.log("Setting FSZ",e,t),window.parent.postMessage({fsz:t},"*")}catch(t){}},this.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.init=function(){this.config=Object.assign({},this.config,this.setupConfig),this.config.stageManager=this,this.log("setupConfig",this.setupConfig),this.log("config",this.config),this.initStageChecker()},this.runManager=function(t){0==this.config.relFrame?(this.log("jmap size",t.length),t.forEach(function(t,e){this.log("check ff",t.id,"ff"in t,t.ff),"ff"in t&&1==t.ff?(this.jmap.push(t),this.twoBlocks=!0,this.log("two blocks","pushing entry")):this.jmap2.push(t)}.bind(this)),this.log("ff block1 size: ",this.jmap.length,"block2 size: ",this.jmap2.length)):this.jmap=t,this.initDocumentVisibilityCheck(function(t){t&&(this.playerStarted=!0,this.deployStage("run_manager"),this.logger("run_manager"),this.log("RUN MANAGER"))}.bind(this))},this.getPartnerJmap=function(){return this.jmap.length>0?this.jmap.splice(0,1)[0]:this.jmap2.length>0?(this.twoBlocks=!1,this.jmap2.splice(0,1)[0]):null},this.deployStage=function(t,e){if(this.lastReceivedStageMassage=new Date,void 0===e&&(e=0),this.log("DEPLOY STAGE",t,e),"visible"!=document.visibilityState)return this.log("DEPLOY :: PLAYER NOT VISIBLE"),void this.logger("failed_to_deploy",t,e,!0);if(this.logger("deploy_next_stage",t,e),this.log("block check",this.jmap.length,this.twoBlocks,Object.keys(this.workingStages).length,this.firstBlockImpression),0==this.jmap.length&&this.twoBlocks){if(0!=Object.keys(this.workingStages).length)return void(this.stagesOnHold.length>0&&this.runNextStage("run_next_stage_in_block"));if(this.firstBlockImpression)return void this.stop("trailer_after_first_block")}if(Object.keys(this.workingStages).length<this.config.workingStagesNum&&(this.jmap.length>0||this.jmap2.length>0)){if(this.log("DEPLOY 1"),null!=this.lastDeploy&&this.config.ap){let i=((new Date).getTime()-this.lastDeploy.getTime())/1e3;if(i<3)return this.log("!!! DEPLOY SUSPENDED !!!",i,t),void setTimeout(function(){this.log("RETRYING DEPLOY"),this.deployStage(t,e)}.bind(this),3e3)}let i=this.getPartnerJmap(),n=Object.assign({},this.config,{currentPartner:i,stageNum:this.stageCount}),s=new r(n);s.init(),this.lastDeploy=new Date,this.workingStages[this.stageCount]={stage:s,onStage:!1,impressed:!1,isFirstEvent:!0,allowed:!1},this.stageCount++,Object.keys(this.workingStages).length<this.config.workingStagesNum&&(this.log("DEPLOY 2"),this.deployStage("add_stage"))}else 0==this.jmap.length&&0==this.jmap2.length&&this.stagesOnHold.length>0&&this.runNextStage("deploy_stage");this.log("DEPLOY, working stages: ",Object.keys(this.workingStages).length),0==Object.keys(this.workingStages).length&&(this.log("DEPLOY 4"),this.stop("empty_queue"))},this.logger=function(t,e,i,n){if(-1==this.config.fle.indexOf(t)&&this.config.disableLogger&&(void 0===n||0==n))return;let s=void 0===e?"":e;var r=void 0!==window.location.ancestorOrigins?JSON.stringify(window.location.ancestorOrigins):"",o={t:"stage_manager",c:this.config.session,a:t,m:s,v:this.config.key,o:r,cid:void 0!==i?i:0},a=[];for(var l in o)"swapDict"!=l&&a.push(l+"="+encodeURIComponent(o[l]));var c=a.join("&"),h=new Image;"undefined"!=typeof callback&&(h.onload=callback,h.onerror=callback),h.src="https://l2.moviead55.ru/logger.php?"+c},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.receiveStageMassage=function(t,e){if(this.log("Stage ["+t+"] Event: ",e,"Stage online: ",this.stageOnline,"queue:",this.stagesOnHold.toString(),"impressing: ",this.impressingStages.toString()),this.lastReceivedStageMassage=new Date,-1!=this.adEvents.indexOf(e)&&(this.hidePreloader(),-1==this.impressingStages.indexOf(t)&&this.impressingStages.push(t),e==this.AD_IMP&&(this.stageOnline==t&&this.showStage(t),this.twoBlocks)&&"ff"in this.workingStages[t].stage.config.currentPartner&&1==this.workingStages[t].stage.config.currentPartner.ff&&(this.log("FIRST BLOCK IMPRESSION"),this.firstBlockImpression=!0),this.log("Stage ["+t+"]","AD EVENT",e),0==this.workingStages[t].allowed&&(this.logger("ad_event_without_permission",JSON.stringify({event:e,partner:this.workingStages[t].stage.config.currentPartner.id}),this.workingStages[t].stage.config.currentPartner.id),this.log("ad_event_without_permission",e,this.workingStages[t].stage.config.currentPartner.id)),e==this.AD_IMP&&0==this.workingStages[t].isFirstEvent&&this.impsCount++,this.workingStages[t].isFirstEvent&&(this.impsCount++,this.workingStages[t].isFirstEvent=!1,this.workingStages[t].impressed=!0,this.log("Stage ["+t+"] FIRST EVENT")),null==this.stageOnline?this.showStage(t):this.stageOnline!=t&&(this.logger("ad_event_overlap",JSON.stringify({event:e,partner:this.workingStages[t].stage.config.currentPartner.id}),this.workingStages[t].stage.config.currentPartner.id),this.log("ad_event_overlap",e,this.workingStages[t].stage.config.currentPartner.id),e==this.AD_IMP&&0==this.impressingStages.filter(e=>e!=t).length&&(this.runStage(t,"impression_out_of_turn"),this.showStage(t,!0))),e==this.AD_COMP&&0==this.workingStages[t].isFirstEvent)){let e=this.impressingStages.indexOf(t);-1!=e&&this.impressingStages.splice(e,1)}if(e==this.HAVE_DIRECT_ADS&&this.stageOnline!=t&&null!=this.stageOnline&&this.forceTryRunStage(t),this.AD_SKIP,"on_init"==e)if(0==this.workingStages[t].stage.onInit&&(this.workingStages[t].stage.onInit=!0),null==this.stageOnline)this.log("Stage is FREE! RUNNING!"),0!=this.config.ap&&0!=this.config.irun||(this.stageOnline=t),this.runStage(t,"on_init"),this.showStage(t),this.workingStages[t].allowed=!0;else if(this.stageOnline==t)this.runStage(t,"on_init");else if(-1==this.stagesOnHold.indexOf(t)){let e=this.workingStages[t].stage.config.currentPartner.queue;this.log("["+t+"], Stage is busy! ON HOLD!",e),"push"==e?this.stagesOnHold.push(t):this.stagesOnHold.unshift(t)}},this.forceTryRunStage=function(t){let e=new Date,i=Math.ceil((e.getTime()-this.lastStageShowTime.getTime())/1e3);if(this.log("Direct ads received, diff: ",i),i>=6){let e=0==this.impressingStages.filter(e=>e!=t).length;this.log("Direct ads received, impressingStageEmpty: ",e),e&&(this.showStage(t),this.runStage(t,"force_run_stage"),this.log("FORCE RUN STAGE"))}else{let e=this.stagesOnHold.indexOf(t);0!=t&&(this.stagesOnHold.splice(e,1),this.stagesOnHold.unshift(t)),setTimeout(function(t){this.log("Retry direct ads run",t),this.forceTryRunStage(t)}.bind(this,t),1e3*(6-i))}},this.log=function(){if(this.config.debug||this.config.showLog){var t=["%cMOVIEADS-stageManager: ","background-color: green; color: white; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}else if(this.config.logall){var i=["init module","vpaid module","adUnit"];if(e=Array.prototype.slice.call(arguments),-1!=i.indexOf(e[0]))return;this.logger("logger1","movieads_ima",JSON.stringify(e))}},this.runNextStage=function(t){if(1!=this.playerPaused){if(this.twoBlocks&&this.firstBlockImpression)return this.log("Unable to runNextStage, because of twoBlocks && firstBlockImpression"),void this.stop("trailer_after_first_block");if(null==this.stageOnline||-1!=["visibility_change","fraud_stage_start","hanged"].indexOf(t)||this.stageOnline==this.stagesOnHold[0]){if(this.logger("run_next_stage",t),this.log("run_next_stage check imps",this.impsCount,this.config.mips),this.impsCount>=this.config.mips)return this.log("Max IMPS count reached!"),this.logger("max_imps"),void this.stop("max_imps");if(this.log("RUNNING NEXT STAGE!","STAGES ON HOLD: ",this.stagesOnHold.toString(),t),this.stagesOnHold.length>0){let t=this.stagesOnHold.splice(0,1).shift();this.log("SELECTED STAGE: ",t),t in this.workingStages?(this.runStage(t,"run_next_stage"),this.showStage(t),this.workingStages[t].allowed=!0):(this.logger("run_next_stage_missing","",0,!0),this.runNextStage("next_stage_missing"))}else this.config.workingStagesNum++,this.deployStage("run_next_stage")}else this.log("!!! FORBIDDEN TO START NEXT PARTNER, WHILE STAGE IS BUSY !!!!")}},this.stopped=!1,this.stop=function(t){this.stopped||(this.stopped=!0,Object.entries(this.workingStages).forEach(function([t,e]){this.log("Stage entries",t,e),e.stage.destroy("stage_manager_stop")}.bind(this)),this.log("ALL FINISHED!",t),this.logger("stop",t),this.logger("stop_state",JSON.stringify({stageOnline:this.stageOnline,onHold:this.stagesOnHold.length,workingStages:Object.keys(this.workingStages).length})),this.config.nvpaid.stopAd(t))},this.initPreloader=function(){let t=document.createElement("div");t.classList.add("loader-wrapper");let e=document.createElement("div");e.setAttribute("id","loader");let i=document.createElement("div");i.classList.add("hm-spinner"),e.appendChild(i);let n=document.createElement("div");n.classList.add("circle"),n.style.display="none",t.appendChild(e),t.appendChild(n),this.preloader=t,this.countdownTimer=n,this.config.container.appendChild(t),this.log("LOADER",t)},this.showPreloader=function(){},this.checkState=function(){},this.showStage=function(t,e){let i="tr"in this.workingStages[t].stage.config.currentPartner&&1==this.workingStages[t].stage.config.currentPartner.tr,n="close0"in this.workingStages[t].stage.config.currentPartner&&1==this.workingStages[t].stage.config.currentPartner.close0;if(i&&0==n?this.setCloseLogic(2):1==n?this.setCloseLogic(0):this.setCloseLogic(1),n&&this.config.nvpaid.onStage(),this.logger("show_stage",JSON.stringify({currentStage:this.stageOnline,stageNum:t,temp:e})),this.config.nvpaid.adOnStage(),Object.entries(this.workingStages).forEach((function([e,i]){e!=t&&(i.stage.hideStage(),i.onStage=!1)})),t in this.workingStages&&void 0!==this.workingStages[t].stage){let i=this.lastStageShowTime;try{this.lastStageShowTime=new Date,this.workingStages[t].stage.showStage("stageManager.showStage"),this.workingStages[t].onStage=!0,void 0===e&&(this.stageOnline=t)}catch(n){this.lastStageShowTime=i,this.log("SHOW STAGE FAILED!"),this.logger("show_stage_failed_2",JSON.stringify({stageNum:t,temp:e,stageDestroyed:-1!=this.destroyedStages.indexOf(t),typeOfStage:typeof this.workingStages[t]}),void 0,!0),this.runNextStage("stage_missing")}}else this.log("STAGE MISSING!"),this.logger("show_stage_failed",JSON.stringify({stageNum:t,temp:e,stageDestroyed:-1!=this.destroyedStages.indexOf(t),typeOfStage:typeof this.workingStages[t]}),void 0,!0),this.runNextStage("stage_missing")},this.runStage=function(t,e){let i=this.stagesOnHold.indexOf(t);-1!=i&&this.stagesOnHold.splice(i,1),this.config.nvpaid.adOnStage(),this.workingStages[t].stage.runAds(e)},this.hidePreloader=function(){},this.destroyStage=function(t){let e=0;if(-1==this.destroyedStages.indexOf(t)&&this.destroyedStages.push(t),t in this.workingStages){e=this.workingStages[t].stage.config.currentPartner.id,this.log("Destroy STAGE",t,this.stageOnline),this.logger("destroy_stage",JSON.stringify({stageNum:t,stageOnline:this.stageOnline,onHold:this.stagesOnHold.length,workingStages:Object.keys(this.workingStages).length}),e);let i=this.stagesOnHold.indexOf(t);-1!=i&&this.stagesOnHold.splice(i,1);let n=this.impressingStages.indexOf(t);-1!=n&&this.impressingStages.splice(n,1),this.workingStages[t].stage=null,this.workingStages[t]=null,delete this.workingStages[t],this.stageOnline==t&&(this.config.nvpaid.offStage(),this.log("DESTROY 1"),this.stageOnline=null,this.runNextStage("destroy_stage"))}this.impsCount<this.config.mips?this.deployStage("destroy_stage",e):null==this.stageOnline&&(this.log("DESTROY 6"),this.stop("destroy_stage"))},this.videoTest=null,this.previousVisibilityState=null,this.playerPaused=!1,this.initDocumentVisibilityCheck=function(t){this.checkCanPlayVideo(t),null==this.previousVisibilityState&&(this.previousVisibilityState=document.visibilityState,setInterval(function(){document.visibilityState!=this.previousVisibilityState&&(this.previousVisibilityState=document.visibilityState,"visible"==document.visibilityState?1==this.playerPaused?(this.log("!!! PLAYER VISIBLE AGAIN WILL CONTINUE !!!"),this.playerPaused=!1,this.runNextStage("visibility_change")):0==this.playerStarted&&t(!0):(this.log("!!! PLAYER NOT VISIBLE WILL PAUSE !!!"),this.playerPaused=!0))}.bind(this),1e3))},this.checkMaxImpsReqched=function(){return this.impsCount>=this.config.mips},this.playerVisibleChecks=[],this.checkCanPlayVideo=function(t){"visible"==document.visibilityState?0==this.playerVisible?(this.playerVisible=!0,this.playerVisibleChecks=[],this.log("PLAYER VISIBLE AGAIN!!"),"function"==typeof t?t(!0):this.runNextStage("visibility_change")):"function"==typeof t&&t(!0):(this.playerVisible=!1,"function"==typeof t&&t(!1))},this.hangReported=!1,this.initStageChecker=function(){setInterval(function(){Object.keys(this.workingStages).length>0&&Object.entries(this.workingStages).forEach(async function([t,e]){if(-1!=this.destroyedStages.indexOf(t))return;if(-1==this.destroyedStages.indexOf(t)&&1==e.stage.destroyed)return e.stage.destroy("stage_checker_1"),this.destroyStage(t),void this.log("UNEXPECTED LOGIC!!!");if(0==e.stage.rendered)return;let i=!1;try{i=await e.stage.checkAlive()}catch(t){i=!1}0==i&&(this.logger("ALIVE_DESTROY",JSON.stringify({stageNum:t,rendered:e.stage.rendered}),e.stage.config.currentPartner.id),this.log("ALIVE DESTROY!","["+t+"]"),e.stage.destroy("stage_checker"),this.destroyStage(t))}.bind(this))}.bind(this),1e3),setInterval(function(){let t=new Date,e=null!=this.lastReceivedStageMassage?this.lastReceivedStageMassage.getTime():0;if(Math.ceil((t.getTime()-e)/1e3)>=60&&"visible"==document.visibilityState){if(console.log("!!!! PROBABLY HANGED !!!!"),0==this.hangReported){this.hangReported=!0;let t=Object.keys(this.workingStages).toString(),e=this.stagesOnHold.toString(),i=this.destroyedStages.toString();this.logger("player_hanged",JSON.stringify({lastStageMessage:this.lastReceivedStageMassage,lastShowTime:this.lastStageShowTime,lastDeploy:this.lastDeploy,stageOnline:this.stageOnline,workingStages:t,stageOnHold:e,destroyedStages:i}),void 0,!0)}this.runNextStage("hanged"),this.lastReceivedStageMassage=new Date}}.bind(this),5e3)},this.init()
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */},a=function(){return(a=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function l(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))}function c(t,e){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function h(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var i=[0,0,0,0];return i[3]+=t[3]+e[3],i[2]+=i[3]>>>16,i[3]&=65535,i[2]+=t[2]+e[2],i[1]+=i[2]>>>16,i[2]&=65535,i[1]+=t[1]+e[1],i[0]+=i[1]>>>16,i[1]&=65535,i[0]+=t[0]+e[0],i[0]&=65535,[i[0]<<16|i[1],i[2]<<16|i[3]]}function d(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var i=[0,0,0,0];return i[3]+=t[3]*e[3],i[2]+=i[3]>>>16,i[3]&=65535,i[2]+=t[2]*e[3],i[1]+=i[2]>>>16,i[2]&=65535,i[2]+=t[3]*e[2],i[1]+=i[2]>>>16,i[2]&=65535,i[1]+=t[1]*e[3],i[0]+=i[1]>>>16,i[1]&=65535,i[1]+=t[2]*e[2],i[0]+=i[1]>>>16,i[1]&=65535,i[1]+=t[3]*e[1],i[0]+=i[1]>>>16,i[1]&=65535,i[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],i[0]&=65535,[i[0]<<16|i[1],i[2]<<16|i[3]]}function u(t,e){return 32==(e%=64)?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:(e-=32,[t[1]<<e|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e])}function g(t,e){return 0==(e%=64)?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]}function p(t,e){return[t[0]^e[0],t[1]^e[1]]}function f(t){return t=p(t,[0,t[0]>>>1]),t=p(t=d(t,[4283543511,3981806797]),[0,t[0]>>>1]),p(t=d(t,[3301882366,444984403]),[0,t[0]>>>1])}function m(t){return parseInt(t)}function A(t){return parseFloat(t)}function v(t){return t.reduce((function(t,e){return t+(e?1:0)}),0)}function y(){var t=window,e=navigator;return v(["MSCSSMatrix"in t,"msSetImmediate"in t,"msIndexedDB"in t,"msMaxTouchPoints"in e,"msPointerEnabled"in e])>=4}function b(t,e,i){(function(t){return t&&"function"==typeof t.setValueAtTime})(e)&&e.setValueAtTime(i,t.currentTime)}function w(t){return new Promise((function(e,i){t.oncomplete=function(t){return e(t.renderedBuffer)};var n=3,s=function(){switch(t.startRendering(),t.state){case"running":setTimeout((function(){return i(T("timeout"))}),1e3);break;case"suspended":document.hidden||n--,n>0?setTimeout(s,500):i(T("suspended"))}};s()}))}function C(t){for(var e=0,i=4500;i<5e3;++i)e+=Math.abs(t[i]);return e}function T(t){var e=new Error(t);return e.name=t,e}Object.create,Object.create;var S=["monospace","sans-serif","serif"],I=["sans-serif-thin","ARNO PRO","Agency FB","Arabic Typesetting","Arial Unicode MS","AvantGarde Bk BT","BankGothic Md BT","Batang","Bitstream Vera Sans Mono","Calibri","Century","Century Gothic","Clarendon","EUROSTILE","Franklin Gothic","Futura Bk BT","Futura Md BT","GOTHAM","Gill Sans","HELV","Haettenschweiler","Helvetica Neue","Humanst521 BT","Leelawadee","Letter Gothic","Levenim MT","Lucida Bright","Lucida Sans","Menlo","MS Mincho","MS Outlook","MS Reference Specialty","MS UI Gothic","MT Extra","MYRIAD PRO","Marlett","Meiryo UI","Microsoft Uighur","Minion Pro","Monotype Corsiva","PMingLiU","Pristina","SCRIPTINA","Segoe UI Light","Serifa","SimHei","Small Fonts","Staccato222 BT","TRAJAN PRO","Univers CE 55 Medium","Vrinda","ZWAdobeF"],k={fontStyle:"normal",fontWeight:"normal",letterSpacing:"normal",lineBreak:"auto",lineHeight:"normal",textTransform:"none",textAlign:"left",textDecoration:"none",textShadow:"none",whiteSpace:"normal",wordBreak:"normal",wordSpacing:"normal",position:"absolute",left:"-9999px",fontSize:"48px"};function _(t){return t.toDataURL()}var E={osCpu:function(){return navigator.oscpu},languages:function(){var t,e=navigator,i=[],n=e.language||e.userLanguage||e.browserLanguage||e.systemLanguage;if(void 0!==n&&i.push([n]),Array.isArray(e.languages))(function(){var t=window,e=navigator;return v(["webkitPersistentStorage"in e,"webkitTemporaryStorage"in e,0===e.vendor.indexOf("Google"),"webkitResolveLocalFileSystemURL"in t,"BatteryManager"in t,"webkitMediaStream"in t,"webkitSpeechGrammar"in t])>=5})()&&v([!("MediaSettingsRange"in(t=window)),"RTCEncodedAudioFrame"in t,""+t.Intl=="[object Intl]",""+t.Reflect=="[object Reflect]"])>=3||i.push(e.languages);else if("string"==typeof e.languages){var s=e.languages;s&&i.push(s.split(","))}return i},colorDepth:function(){return window.screen.colorDepth},deviceMemory:function(){return void 0,"number"==typeof(t=A(navigator.deviceMemory))&&isNaN(t)?void 0:t;var t},screenResolution:function(){var t=screen,e=[m(t.width),m(t.height)];return e.sort().reverse(),e},availableScreenResolution:function(){var t=screen;if(t.availWidth&&t.availHeight){var e=[m(t.availWidth),m(t.availHeight)];return e.sort().reverse(),e}},hardwareConcurrency:function(){try{var t=m(navigator.hardwareConcurrency);return isNaN(t)?1:t}catch(t){return 1}},timezoneOffset:function(){var t=(new Date).getFullYear();return Math.max(A(new Date(t,0,1).getTimezoneOffset()),A(new Date(t,6,1).getTimezoneOffset()))},timezone:function(){var t,e=null===(t=window.Intl)||void 0===t?void 0:t.DateTimeFormat;if(e)return(new e).resolvedOptions().timeZone},sessionStorage:function(){try{return!!window.sessionStorage}catch(t){return!0}},localStorage:function(){try{return!!window.localStorage}catch(t){return!0}},indexedDB:function(){var t,e;if(!(y()||(t=window,e=navigator,v(["msWriteProfilerMark"in t,"MSStream"in t,"msLaunchUri"in e,"msSaveBlob"in e])>=3&&!y())))try{return!!window.indexedDB}catch(t){return!0}},openDatabase:function(){return!!window.openDatabase},cpuClass:function(){return navigator.cpuClass},platform:function(){return navigator.platform},plugins:function(){if(y())return[];if(navigator.plugins){for(var t=[],e=0;e<navigator.plugins.length;++e){var i=navigator.plugins[e];if(i){for(var n=[],s=0;s<i.length;++s){var r=i[s];n.push({type:r.type,suffixes:r.suffixes})}t.push({name:i.name,description:i.description,mimeTypes:n})}}return t}},canvas:function(){var t=function(){var t=document.createElement("canvas");return t.width=240,t.height=140,t.style.display="inline",[t,t.getContext("2d")]}(),e=t[0],i=t[1];if(!function(t,e){return!(!e||!t.toDataURL)}(e,i))return{winding:!1,data:""};i.rect(0,0,10,10),i.rect(2,2,6,6);var n=!i.isPointInPath(5,5,"evenodd");return i.textBaseline="alphabetic",i.fillStyle="#f60",i.fillRect(125,1,62,20),i.fillStyle="#069",i.font="11pt no-real-font-123",i.fillText("Cwm fjordbank 😃 gly",2,15),i.fillStyle="rgba(102, 204, 0, 0.2)",i.font="18pt Arial",i.fillText("Cwm fjordbank 😃 gly",4,45),i.globalCompositeOperation="multiply",i.fillStyle="rgb(255,0,255)",i.beginPath(),i.arc(50,50,50,0,2*Math.PI,!0),i.closePath(),i.fill(),i.fillStyle="rgb(0,255,255)",i.beginPath(),i.arc(100,50,50,0,2*Math.PI,!0),i.closePath(),i.fill(),i.fillStyle="rgb(255,255,0)",i.beginPath(),i.arc(75,100,50,0,2*Math.PI,!0),i.closePath(),i.fill(),i.fillStyle="rgb(255,0,255)",i.arc(75,75,75,0,2*Math.PI,!0),i.arc(75,75,25,0,2*Math.PI,!0),i.fill("evenodd"),{winding:n,data:_(e)}},touchSupport:function(){var t,e=navigator,i=0;void 0!==e.maxTouchPoints?i=m(e.maxTouchPoints):void 0!==e.msMaxTouchPoints&&(i=e.msMaxTouchPoints);try{document.createEvent("TouchEvent"),t=!0}catch(e){t=!1}return{maxTouchPoints:i,touchEvent:t,touchStart:"ontouchstart"in window}},fonts:function(){var t=document,e=t.body,i=t.createElement("div"),n=t.createElement("div"),s={},r={},o=function(){var e=t.createElement("span");e.textContent="mmMwWLliI0O&1";for(var i=0,n=Object.keys(k);i<n.length;i++){var s=n[i];e.style[s]=k[s]}return e},a=function(t){return S.some((function(e,i){return t[i].offsetWidth!==s[e]||t[i].offsetHeight!==r[e]}))},l=S.map((function(t){var e=o();return e.style.fontFamily=t,i.appendChild(e),e}));e.appendChild(i);for(var c=0,h=S.length;c<h;c++)s[S[c]]=l[c].offsetWidth,r[S[c]]=l[c].offsetHeight;var d=function(){for(var t={},e=function(e){t[e]=S.map((function(t){var i=function(t,e){var i=o();return i.style.fontFamily="'"+t+"',"+e,i}(e,t);return n.appendChild(i),i}))},i=0,s=I;i<s.length;i++)e(s[i]);return t}();e.appendChild(n);for(var u=[],g=0,p=I.length;g<p;g++)a(d[I[g]])&&u.push(I[g]);return e.removeChild(n),e.removeChild(i),u},audio:function(){return l(this,void 0,void 0,(function(){var t,e,i,n,s,r,o;return c(this,(function(a){switch(a.label){case 0:if(t=window,!(e=t.OfflineAudioContext||t.webkitOfflineAudioContext))return[2,-2];if(function(){var t=window,e=navigator;return v(["ApplePayError"in t,"CSSPrimitiveValue"in t,"Counter"in t,0===e.vendor.indexOf("Apple"),"getStorageUpdates"in e,"WebKitMediaKeys"in t])>=4}()&&!function(){var t=window;return v(["safari"in t,!("DeviceMotionEvent"in t),!("ongestureend"in t),!("standalone"in navigator)])>=3}()&&!function(){var t=window;return v(["DOMRectList"in t,"RTCPeerConnectionIceEvent"in t,"SVGGeometryElement"in t,"ontransitioncancel"in t])>=3}())return[2,-1];i=new e(1,44100,44100),(n=i.createOscillator()).type="triangle",b(i,n.frequency,1e4),s=i.createDynamicsCompressor(),b(i,s.threshold,-50),b(i,s.knee,40),b(i,s.ratio,12),b(i,s.reduction,-20),b(i,s.attack,0),b(i,s.release,.25),n.connect(s),s.connect(i.destination),n.start(0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,w(i)];case 2:return r=a.sent(),[3,5];case 3:if("timeout"===(o=a.sent()).name||"suspended"===o.name)return[2,-3];throw o;case 4:return n.disconnect(),s.disconnect(),[7];case 5:return[2,C(r.getChannelData(0))]}}))}))},pluginsSupport:function(){return void 0!==navigator.plugins},productSub:function(){return navigator.productSub},emptyEvalLength:function(){return eval.toString().length},errorFF:function(){try{throw"a"}catch(t){try{return t.toSource(),!0}catch(t){return!1}}},vendor:function(){return navigator.vendor},chrome:function(){return void 0!==window.chrome},cookiesEnabled:function(){var t=document;try{t.cookie="cookietest=1; SameSite=Strict;";var e=-1!==t.cookie.indexOf("cookietest=");return t.cookie="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",e}catch(t){return!1}}};function M(t){return JSON.stringify(t,(function(t,e){return e instanceof Error?a({name:(i=e).name,message:i.message,stack:null===(n=i.stack)||void 0===n?void 0:n.split("\n")},i):e;var i,n}),2)}function D(t){return function(t,e){e=e||0;var i,n=(t=t||"").length%16,s=t.length-n,r=[0,e],o=[0,e],a=[0,0],l=[0,0],c=[2277735313,289559509],m=[1291169091,658871167];for(i=0;i<s;i+=16)a=[255&t.charCodeAt(i+4)|(255&t.charCodeAt(i+5))<<8|(255&t.charCodeAt(i+6))<<16|(255&t.charCodeAt(i+7))<<24,255&t.charCodeAt(i)|(255&t.charCodeAt(i+1))<<8|(255&t.charCodeAt(i+2))<<16|(255&t.charCodeAt(i+3))<<24],l=[255&t.charCodeAt(i+12)|(255&t.charCodeAt(i+13))<<8|(255&t.charCodeAt(i+14))<<16|(255&t.charCodeAt(i+15))<<24,255&t.charCodeAt(i+8)|(255&t.charCodeAt(i+9))<<8|(255&t.charCodeAt(i+10))<<16|(255&t.charCodeAt(i+11))<<24],a=u(a=d(a,c),31),r=h(r=u(r=p(r,a=d(a,m)),27),o),r=h(d(r,[0,5]),[0,1390208809]),l=u(l=d(l,m),33),o=h(o=u(o=p(o,l=d(l,c)),31),r),o=h(d(o,[0,5]),[0,944331445]);switch(a=[0,0],l=[0,0],n){case 15:l=p(l,g([0,t.charCodeAt(i+14)],48));case 14:l=p(l,g([0,t.charCodeAt(i+13)],40));case 13:l=p(l,g([0,t.charCodeAt(i+12)],32));case 12:l=p(l,g([0,t.charCodeAt(i+11)],24));case 11:l=p(l,g([0,t.charCodeAt(i+10)],16));case 10:l=p(l,g([0,t.charCodeAt(i+9)],8));case 9:l=d(l=p(l,[0,t.charCodeAt(i+8)]),m),o=p(o,l=d(l=u(l,33),c));case 8:a=p(a,g([0,t.charCodeAt(i+7)],56));case 7:a=p(a,g([0,t.charCodeAt(i+6)],48));case 6:a=p(a,g([0,t.charCodeAt(i+5)],40));case 5:a=p(a,g([0,t.charCodeAt(i+4)],32));case 4:a=p(a,g([0,t.charCodeAt(i+3)],24));case 3:a=p(a,g([0,t.charCodeAt(i+2)],16));case 2:a=p(a,g([0,t.charCodeAt(i+1)],8));case 1:a=d(a=p(a,[0,t.charCodeAt(i)]),c),r=p(r,a=d(a=u(a,31),m))}return r=h(r=p(r,[0,t.length]),o=p(o,[0,t.length])),o=h(o,r),r=h(r=f(r),o=f(o)),o=h(o,r),("00000000"+(r[0]>>>0).toString(16)).slice(-8)+("00000000"+(r[1]>>>0).toString(16)).slice(-8)+("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)}(function(t){for(var e="",i=0,n=Object.keys(t);i<n.length;i++){var s=n[i],r=t[s],o=r.error?"error":JSON.stringify(r.value);e+=(e?"|":"")+s.replace(/([:|\\])/g,"\\$1")+":"+o}return e}(t))}var L=function(){function t(){}return t.prototype.get=function(t){return void 0===t&&(t={}),l(this,void 0,void 0,(function(){var e,i;return c(this,(function(n){switch(n.label){case 0:return[4,function(t,e,i){return l(this,void 0,void 0,(function(){var e,n,s,r,o,l,h,d,u;return c(this,(function(c){switch(c.label){case 0:e=Date.now(),n={},s=0,r=Object.keys(t),c.label=1;case 1:if(!(s<r.length))return[3,7];if(o=r[s],function(t,e){for(var i=0,n=t.length;i<n;++i)if(t[i]===e)return!0;return!1}(i,o))return[3,6];l=void 0,c.label=2;case 2:return c.trys.push([2,4,,5]),u={},[4,t[o](void 0)];case 3:return u.value=c.sent(),l=u,[3,5];case 4:return h=c.sent(),l=h&&"object"==typeof h&&"message"in h?{error:h}:{error:{message:h}},[3,5];case 5:d=Date.now(),n[o]=a(a({},l),{duration:d-e}),e=d,c.label=6;case 6:return s++,[3,1];case 7:return[2,n]}}))}))}(E,0,[])];case 1:return e=n.sent(),i=function(t){var e;return{components:t,get visitorId(){return void 0===e&&(e=D(this.components)),e},set visitorId(t){e=t}}}(e),t.debug&&console.log("Copy the text below to get the debug data:\n\n```\nversion: 3.0.6\nuserAgent: "+navigator.userAgent+"\ngetOptions: "+JSON.stringify(t,void 0,2)+"\nvisitorId: "+i.visitorId+"\ncomponents: "+M(e)+"\n```"),[2,i]}}))}))},t}(),O={load:function(t){var e=(void 0===t?{}:t).delayFallback,i=void 0===e?50:e;return l(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,(e=i,n=2*i,void 0===n&&(n=1/0),new Promise((function(t){var i=window.requestIdleCallback;i?i((function(){return t()}),{timeout:n}):setTimeout(t,Math.min(e,n))})))];case 1:return t.sent(),[2,new L]}var e,n}))}))},hashComponents:D,componentsToDebugString:M};i(10);var R=i(7),N=i(8),P=i(11),x=function(){this.version="718680ec40",this.initiated=!1,this.debug=!1,this.showLog=!1,this.logall=!1,this.impsCount=0,this.maxImps=500,this.stageManager=null,this.remainingTickerHolder=null,this.lastEvent=null,this.impressed=!1,this.slot_=null,this.originSlot=null,this.jmap=[],this.fp2=null,this.fp2result=null,this.visitorId=null,this.localAddress="0.0.0.0",this.baseFpsMeasure=[],this.baseFps=60,this.startReported=!1,this.visibility=100,this.jmapReady=!1,this.rendered=!1,this.initTimeout=30,this.initTimeoutHolder=null,this.initIntervalHolder=null,this.videoSlot_=null,this.eventCallbacks_={},this.odomains=["kinomans.website","filmskino.site"],(new Date).toISOString().slice(0,10).replace(/-/g,""),this.creativeData_={key:"",jmap:"",mspLink:"",testad:!1,session:"",it:1,tq:2,ap:!0,rounds:1,replay:1,mips:500,itout:30,bvps:[],dc:!0,pxy:!1,skid:null,disableLogger:!0,fbq:4,rcnt:0,tmts:{evt:30,int:30,sti:30},instant:!1,cimp:!1,moduleNCSS:"data:text/css;base64,I2NvbnRlbnQsYm9keSxodG1se3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7cGFkZGluZzowO21hcmdpbjowO3Bvc2l0aW9uOnJlbGF0aXZlO292ZXJmbG93OmhpZGRlbn12aWRlb3t3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS5sb2FkZXItd3JhcHBlcntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NTAlO2xlZnQ6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwtNTAlKTt6LWluZGV4Ojk5OX0uaG0tc3Bpbm5lcntoZWlnaHQ6MTE1cHg7d2lkdGg6MTE1cHg7Ym9yZGVyOjZweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItdG9wLWNvbG9yOiM5YzI3YjA7Ym9yZGVyLWJvdHRvbS1jb2xvcjojOWMyN2IwO2JvcmRlci1yYWRpdXM6NTAlO3Bvc2l0aW9uOnJlbGF0aXZlOy13ZWJraXQtYW5pbWF0aW9uOnNwaW4gM3MgbGluZWFyIGluZmluaXRlO2FuaW1hdGlvbjpzcGluIDNzIGxpbmVhciBpbmZpbml0ZX0uaG0tc3Bpbm5lcjo6YmVmb3Jle2NvbnRlbnQ6IiI7cG9zaXRpb246YWJzb2x1dGU7dG9wOjIwcHg7cmlnaHQ6MjBweDtib3R0b206MjBweDtsZWZ0OjIwcHg7Ym9yZGVyOjZweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItdG9wLWNvbG9yOiNiYTY4Yzg7Ym9yZGVyLWJvdHRvbS1jb2xvcjojYmE2OGM4O2JvcmRlci1yYWRpdXM6NTAlOy13ZWJraXQtYW5pbWF0aW9uOnNwaW4gMS41cyBsaW5lYXIgaW5maW5pdGU7YW5pbWF0aW9uOnNwaW4gMS41cyBsaW5lYXIgaW5maW5pdGV9QC13ZWJraXQta2V5ZnJhbWVzIHNwaW57ZnJvbXstd2Via2l0LXRyYW5zZm9ybTpyb3RhdGUoMCk7dHJhbnNmb3JtOnJvdGF0ZSgwKX10b3std2Via2l0LXRyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKTt0cmFuc2Zvcm06cm90YXRlKDM2MGRlZyl9fUBrZXlmcmFtZXMgc3Bpbntmcm9tey13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgwKTt0cmFuc2Zvcm06cm90YXRlKDApfXRvey13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO3RyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKX19LmNpcmNsZXtib3JkZXItcmFkaXVzOjUwJTtiYWNrZ3JvdW5kLWNvbG9yOiM5YzI3YjA7Y29sb3I6I2ZmZjt3aWR0aDo1MHB4O2hlaWdodDo1MHB4O3RvcDo1MCU7bGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLC01MCUpO3Bvc2l0aW9uOmFic29sdXRlO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjUwcHg7Zm9udC1mYW1pbHk6Um9ib3RvLHNhbnMtc2VyaWZ9I3BsYXllci12cGFpZC13cmFwcGVye3dpZG93czoxMDAlO2hlaWdodDoxMDAlO3RvcDowO2xlZnQ6MH0ucm1wLWFkLWNvbnRhaW5lcnt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO3RvcDowO2xlZnQ6MH0ucm1wLWFkLXZhc3QtdmlkZW8tcGxheWVye3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6MTB9LnJtcC12cGFpZC1jb250YWluZXJ7d2lkdGg6MTAwJTt0b3A6MDtoZWlnaHQ6MTAwJTtsZWZ0OjA7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDoyMH0="},this.readyState=0,this.imp_uuid=this.guid(),this.subs=this.guid(),this.dynamicParams={"[vt]":this.visibility,"[gguid]":this.imp_uuid,"[subs]":this.subs,"[session]":this.session,"[it]":2,"[tq]":2,"[puid9]":2,"[tti]":-1,"[fp]":60,"[rcnt]":0},this.attributes_={companions:"",desiredBitrate:256,duration:30,expanded:!1,height:0,icons:"",linear:!0,remainingTime:30,skippableState:!1,viewMode:"normal",width:0,volume:0},this.madsSession=this.guid(),this.times=[],this.fps=60,this.AD_ERROR="movieads_error",this.AD_SKIP="movieads_ad_skip",this.AD_CLICK="movieads_ad_click",this.AD_NOADS="movieads_no_ads",this.AD_IMP="movieads_ad_imp",this.AD_FQ="movieads_ad_fq",this.AD_MP="movieads_ad_mp",this.AD_TQ="movieads_ad_tq",this.AD_COMP="movieads_ad_complete",this.MOVIEADS_MODULE_READY="movieads_ready",this.AD_VSTART="movieads_ad_vstart",this.AD_ROLL_COMP="movieads_ad_roll_complete"};x.prototype.debounce=function(t,e){var i;return e=e||100,function(n){i&&clearTimeout(i),i=setTimeout(t,e,n)}},x.prototype.initSizeWatcher=function(){window.addEventListener("resize",this.debounce(function(){this.resizeAd(window.innerWidth,window.innerHeight,"normal")}.bind(this),200),!0)},x.prototype.initEventWatcher=function(){setInterval(function(){((new Date).getTime()-this.lastEvent.getTime())/1e3>60&&(console.log("EVENT_WATCHER","Skip to next!"),this.tryNextAd("EVENT_WATCHER"))}.bind(this),5e3)},x.prototype.getLocalNetwork=function(){var t=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,e=this;t&&function(){var i=new t({iceServers:[]});i.createDataChannel("",{reliable:!1}),i.onicecandidate=function(t){t.candidate&&r("a="+t.candidate.candidate)},i.createOffer((function(t){r(t.sdp),i.setLocalDescription(t)}),(function(t){console.warn("offer failed",t)}));var n=Object.create(null);n["0.0.0.0"]=!1;var s=function(t){if(!(t in n)){n[t]=!0;var i=Object.keys(n).filter((function(t){return n[t]}));e.localAddress=i.join(" or perhaps ")||"n/a",e.log("ADDR",e.localAddress)}}.bind(this),r=function(t){t.split("\r\n").forEach((function(t){if(~t.indexOf("a=candidate")){var e=(i=t.split(" "))[4];"host"===i[7]&&s(e)}else if(~t.indexOf("c=")){var i;e=(i=t.split(" "))[2],s(e)}}))}.bind(this)}.bind(this)()},x.prototype.initAd=function(){let t=[].slice.call(arguments);(async function(){const e=await O.load(),i=await e.get();this.fpResult=i,this.visitorId=i.visitorId,this.runVpaid.apply(this,t)}).bind(this)()},x.prototype.runVpaid=function(t,e,i,n,s,r){if(0==this.initiated){this.initPinger();let l=document.createElement("link");l.href=this.creativeData_.moduleNCSS,l.rel="stylesheet",l.type="text/css",document.head.appendChild(l),this.eventCallbacks_.AdLoaded(),this.initiated=!0,this.initSizeWatcher(),this.slot_=r.slot,this.videoSlot_=r.videoSlot,this.attributes_.width=t,this.attributes_.height=e,this.attributes_.viewMode=i,this.attributes_.desiredBitrate=n;var a=JSON.parse(s.AdParameters);this.slot_.style.backgroundColor="black",this.creativeData_=this.extend(this.creativeData_,a),this.setDynamicParam("[session]",this.creativeData_.session),this.session=this.creativeData_.session,this.setDynamicParam("[it]",this.creativeData_.it),this.setDynamicParam("[tq]",this.creativeData_.tq),this.setDynamicParam("[rcnt]",this.creativeData_.rcnt),!1===this.creativeData_.ap&&(this.attributes_.volume=.6),"sl"in this.creativeData_&&(this.showLog=this.creativeData_.sl),"debug"in this.creativeData_&&(this.debug=this.creativeData_.debug),"logall"in this.creativeData_&&(this.logall=this.creativeData_.logall),this.log("version",this.version),this.log("FP result",this.fpResult);let c={mute:this.creativeData_.ap,ap:this.creativeData_.ap,key:this.creativeData_.key,slot:this.slot_,container:this.slot_,mips:this.creativeData_.mips,debug:this.debug,nvpaid:this,session:this.session,subsession:this.subs,logall:this.logall,volume:this.attributes_.volume,pxy:this.creativeData_.pxy,proxyVideo:this.creativeData_.pxy?this.videoSlot_:null,disableLogger:this.creativeData_.disableLogger,showLog:this.showLog,irun:!1,rounds:this.creativeData_.rounds,ima:this.creativeData_.ima,visitorId:this.visitorId,relFrame:this.creativeData_.relFrame,firstBlockQueue:this.creativeData_.fbq,mspLink:this.creativeData_.mspLink,moduleNCSS:this.creativeData_.moduleNCSS,fle:[]};if("fle"in this.creativeData_&&(c.fle=this.creativeData_.fle),"workingStagesNum"in this.creativeData_&&(c.workingStagesNum=this.creativeData_.workingStagesNum),"irun"in this.creativeData_&&(c.irun=this.creativeData_.irun),this.stageManager=new o(c),window.stageManager=this.stageManager,this.log("runVpaid "+t+"x"+e+" "+i+" "+n),this.log("creative data",this.creativeData_),this.log("MODULE slot, videoSlot",this.videoSlot_,this.videoSlot_.nodeName,this.videoSlot_.nodeType,this.slot_),this.initVisibilityTracker(),this.requestJmap(function(){let t=this.jmap;if(1==this.creativeData_.dc){let t=R.decode(this.jmap);this.jmap=JSON.parse(t)}else this.jmap=JSON.parse(this.jmap);if(this.jmap.length<=0)return this.logger("empty_jmap",t),void this.stopAd();this.jmapReady=!0,this.stageManager.runManager(this.jmap)}.bind(this)),!1===this.creativeData_.ap){let t=this;this.initTimeoutHolder=setTimeout(function(){this.log("INIT TIMEOUT!","Impressed: ",t.impressed,t.impsCount),this.stopAd()}.bind(this),1e3*this.creativeData_.itout),this.initTimeout=this.creativeData_.itout,this.initIntervalHolder=setInterval(function(){this.initTimeout--,0==this.initTimeout&&clearInterval(this.initIntervalHolder)}.bind(this),1e3)}this.isEventSubscribed_("AdsModuleReady")&&this.eventCallbacks_.AdsModuleReady(),this.log("INIT END"),this.logger("init",this.version),"mstream"in this.creativeData_||0!=this.creativeData_.ap||(this.log("player_loaded"),this.logger("player_loaded"))}},x.prototype.initVisibilityTracker=function(){"undefined"!=typeof IntersectionObserver&&new IntersectionObserver(function(t){for(var e in t){var i=t[e];"NaN"!=Math.floor(100*i.intersectionRatio).toString()&&(this.visibility=Math.floor(100*i.intersectionRatio),this.log("MADS VISIBLE: "+this.visibility.toString()),this.setDynamicParam("[vt]",this.visibility.toString()))}}.bind(this),{threshold:[0,.1,.15,.2,.25,.3,.35,.4,.45,.5,.55,.6,.65,.7,.75,.8,.85,.9,.95,1]}).observe(this.slot_)},x.prototype.initPinger=function(){setInterval(function(){this.ping()}.bind(this),1e3)},x.prototype.refreshLoop=function(){window.requestAnimationFrame(function(){const t=performance.now();for(;this.times.length>0&&this.times[0]<=t-1e3;)this.times.shift();this.times.push(t),this.fps=this.times.length,this.refreshLoop()}.bind(this))},x.prototype.startFpsTracker=function(){void 0!==window.performance&&this.refreshLoop();var t=1e3;let e=setInterval(function(){if(t>0)this.baseFpsMeasure.push(this.fps),t-=100;else{clearInterval(e);let t=this.baseFpsMeasure.slice(4),i=t.reduce((t,e)=>t+e,0)/t.length||0;this.baseFps=Math.ceil(i),this.log("BASE FPS",this.baseFps),this.log("BASE FPS MEASURE",t)}}.bind(this),100);setInterval(function(){this.setDynamicParam("[fp]",this.fps)}.bind(this),1e3)},x.prototype.requestJmap=function(t,e){var i=void 0!==e?e+1:0;let n=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest),s=this.replaceLinkParams(this.creativeData_.jmap);if(s+="&vid="+this.visitorId,s+="&fpr="+this.creativeData_.skid,void 0!==window.location.ancestorOrigins){var r=Array.from(window.location.ancestorOrigins).pop();s+="&tanc="+encodeURIComponent(r)}n.withCredentials=!0,n.open("GET",s,!0),n.onerror=function(e){if(this.log("JMAP ERROR",e),this.logger("jmap_request_error"),5==i)return this.log("STOPPING JMAP"),void this.stopAd();setTimeout(function(){this.log("RETRYING JMAP",i),this.requestJmap(t,i)}.bind(this),5e3)}.bind(this),n.onload=function(){if(200==n.status){if(1==this.creativeData_.dc){let t=n.response.slice(0,10),e=n.response.slice(-10),i=new N(t+e).get(n.response.slice(10,-10));this.jmap=i}else this.jmap=n.response;t()}else this.logger("error_request_jmap",n.status),this.stopAd()}.bind(this),n.send()},x.prototype.replaceLinkParams=function(t,e){this.log("Replace Link params",t);var i=Object.assign({},this.dynamicParams,e);Object.keys(i).length>0&&Object.keys(i).forEach((function(e){t=t.replace(e,i[e])}));var n=P("mads"+i["[gguid]"]+i["[session]"]+"Sig");t=(t=(t=(t=(t=(t=(t=(t=t.replace("[sig]",n)).replace("[rnd]",(new Date).getTime())).replace("[w]",this.slot_.getBoundingClientRect().width)).replace("[h]",this.slot_.getBoundingClientRect().height)).replace("[sw]",window.screen.width)).replace("[sh]",window.screen.height)).replace("[ls]",void 0!==window.screen.orientation&&"type"in window.screen.orientation?window.screen.orientation.type:"undefined")).replace("[pr]",window.devicePixelRatio||1);let s="";return-1==this.odomains.indexOf(window.location.hostname)&&(s=encodeURIComponent(window.location.href)),t=t.replace("[lh]",s)},x.prototype.eventTracker=function(t){(new Image).src=t},x.prototype.renderSlot_=function(t){},x.prototype.ping=function(){try{window.parent.postMessage("mads_ping","*")}catch(t){this.logger("mads_ping_failed",t.toString(),void 0,!0)}},x.prototype.postParentMessage=function(t){try{window.parent.postMessage(t,"*")}catch(t){}},x.prototype.triggerEvent=function(t){this.log("RECEIVED EVENT FROM MODULE",t)},x.prototype.receiveEvent=function(t){if(this.log("REceiVe EVENT",t),this.lastEvent=new Date,t==this.AD_COMP){if(!this.isEventSubscribed_("AdVideoComplete"))return void this.log("Error: AdVideoComplete function callback not subscribed.");this.eventCallbacks_.AdVideoComplete()}if(this.AD_NOADS,this.AD_ROLL_COMP,t==this.AD_FQ){if(this.runOnStageLogic(),0==this.impsCount&&this.clearTimeouts(),!this.isEventSubscribed_("AdVideoFirstQuartile"))return void this.log("Error: AdVideoFirstQuartile function callback not subscribed.");this.eventCallbacks_.AdVideoFirstQuartile()}if(t==this.AD_VSTART){if(0==this.impsCount&&this.clearTimeouts(),!this.isEventSubscribed_("AdVideoStart"))return void this.log("Error: AdVideoStart function callback not subscribed.");this.log("Start reported",this.startReported),0==this.startReported&&(this.startReported=!0,this.eventCallbacks_.AdVideoStart())}if(t==this.AD_MP){if(this.runOnStageLogic(),!this.isEventSubscribed_("AdVideoMidpoint"))return void this.log("Error: AdVideoMidpoint function callback not subscribed.");this.eventCallbacks_.AdVideoMidpoint()}if(t==this.AD_TQ){if(this.runOnStageLogic(),!this.isEventSubscribed_("AdVideoThirdQuartile"))return void this.log("Error: AdVideoThirdQuartile function callback not subscribed.");this.eventCallbacks_.AdVideoThirdQuartile()}if(t==this.AD_SKIP){if(!this.isEventSubscribed_("AdSkipped"))return void this.log("Error: AdSkipped function callback not subscribed.");this.eventCallbacks_.AdSkipped()}if(t==this.AD_CLICK){if(!this.isEventSubscribed_("AdClickThru"))return void this.log("Error: AdClickThru function callback not subscribed.");this.eventCallbacks_.AdClickThru()}t==this.AD_IMP&&this.runImpressionLogic()},x.prototype.onStage=function(){try{this.log("AD ON STAGE"),window.parent.postMessage("movieads_onstage","*")}catch(t){}},x.prototype.offStage=function(){try{this.log("AD OFF STAGE"),window.parent.postMessage("movieads_offstage","*")}catch(t){}},x.prototype.clearTimeouts=function(){clearTimeout(this.initTimeoutHolder)},x.prototype.runOnStageLogic=function(){this.onStage(),this.clearTimeouts(),this.startRemainingTicker()},x.prototype.runImpressionLogic=function(){this.runOnStageLogic(),this.impsCount++,this.impressed=!0,this.isEventSubscribed_("AdImpression")?this.eventCallbacks_.AdImpression():this.log("Error: AdImpression function callback not subscribed.")},x.prototype.setDynamicParam=function(t,e){this.dynamicParams[t]=e},x.prototype.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},x.prototype.logger=function(t,e,i,n){let s="player_loaded"==t?"player_loaded":"multi_vpaid";if(this.creativeData_.disableLogger&&"multi_vpaid"==s&&(void 0===n||0==n))return;let r=void 0===e?"":e;var o=void 0!==window.location.ancestorOrigins?JSON.stringify(window.location.ancestorOrigins):"",a={t:s,c:this.session,a:t,m:r,v:this.creativeData_.key,o:o,cid:0},l=[];for(var c in a)"swapDict"!=c&&l.push(c+"="+encodeURIComponent(a[c]));var h=l.join("&"),d=new Image;void 0!==i&&(d.onload=i,d.onerror=i),d.src="https://l2.moviead55.ru/logger.php?"+h},x.prototype.handshakeVersion=function(t){return"2.0"},x.prototype.startAd=function(){this.log("Starting ad"),this.eventCallbacks_.AdStarted(),this.eventCallbacks_.AdStarted},x.prototype.startRemainingTicker=function(){null==this.remainingTickerHolder&&(this.remainingTickerHolder=setInterval(function(){this.attributes_.remainingTime-=1,this.attributes_.duration-this.attributes_.remainingTime>=15&&(this.attributes_.skippableState=!0),0==this.attributes_.remainingTime&&(clearInterval(this.remainingTickerHolder),this.attributes_.remainingTime=30)}.bind(this),1e3))},x.prototype.stopAd=function(t){this.log("Stopping ad"),"AdStopped"in this.eventCallbacks_?setTimeout(function(){this.eventCallbacks_.AdStopped(t)}.bind(this),1500):"AdError"in this.eventCallbacks_&&setTimeout(function(){this.eventCallbacks_.AdError()}.bind(this),1e3)},x.prototype.setAdVolume=function(t){var e=t>1?t/100:t;this.attributes_.volume=e,this.log("setting ad volume",t),"AdVolumeChange"in this.eventCallbacks_&&this.eventCallbacks_.AdVolumeChange()},x.prototype.getAdVolume=function(){return this.log("getAdVolume"),this.attributes_.volume},x.prototype.resizeAd=function(t,e,i){this.rendered&&(this.log("resizeAd "+t+"x"+e+" "+i),this.attributes_.width=t,this.attributes_.height=e,this.attributes_.viewMode=i,"AdSizeChange"in this.eventCallbacks_&&this.eventCallbacks_.AdSizeChange())},x.prototype.adOnStage=function(){this.log("AdOnStage"),"AdOnStage"in this.eventCallbacks_&&this.eventCallbacks_.AdOnStage()},x.prototype.pauseAd=function(){this.log("pauseAd"),"AdPaused"in this.eventCallbacks_&&this.eventCallbacks_.AdPaused()},x.prototype.resumeAd=function(){this.log("resumeAd"),"AdResumed"in this.eventCallbacks_&&this.eventCallbacks_.AdResumed()},x.prototype.expandAd=function(){this.log("expandAd"),this.attributes_.expanded=!0,"AdExpanded"in this.eventCallbacks_&&this.eventCallbacks_.AdExpanded()},x.prototype.getAdExpanded=function(){return this.log("getAdExpanded"),this.attributes_.expanded},x.prototype.getAdSkippableState=function(){return this.log("getAdSkippableState"),this.attributes_.skippableState},x.prototype.collapseAd=function(){this.log("collapseAd"),this.attributes_.expanded=!1},x.prototype.skipAd=function(){var t=this.attributes_.skippableState;this.log("skipAd",t,this.attributes_),t&&("AdSkipped"in this.eventCallbacks_?this.eventCallbacks_.AdSkipped():this.log("Error: Invalid ad skip request."))},x.prototype.subscribe=function(t,e,i){var n=t.bind(i);this.eventCallbacks_[e]=n},x.prototype.unsubscribe=function(t){this.eventCallbacks_[t]=null},x.prototype.getAdWidth=function(){return this.attributes_.width},x.prototype.getAdHeight=function(){return this.attributes_.height},x.prototype.getAdRemainingTime=function(){return this.attributes_.remainingTime},x.prototype.getAdDuration=function(){return this.attributes_.duration},x.prototype.getAdCompanions=function(){return this.attributes_.companions},x.prototype.getAdIcons=function(){return this.attributes_.icons},x.prototype.nullVisibility=function(){window.parent.postMessage("movieads_min_vt_skip","*")},x.prototype.getAdLinear=function(){return this.attributes_.linear},x.prototype.log=function(){if(this.debug||this.showLog){var t=["%cMOVIEADS-mvpaid: ","background-color: red; color: white; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}else this.logall&&(e=Array.prototype.slice.call(arguments),this.logger("logger1","nvpaid",JSON.stringify(e)))},x.prototype.adErrorHandler_=function(){if(this.isEventSubscribed_("AdError")){var t=this.getElement_("adErrorMsg").value;this.log("adError("+t+")"),this.eventCallbacks_.AdError(t)}else this.log("AdError function callback not subscribed.")},x.prototype.adInteractionHandler_=function(){if(this.isEventSubscribed_("AdInteraction")){var t=this.getElement_("adInteractionId").value;this.log("adLog("+t+")"),this.eventCallbacks_.AdInteraction(t)}else this.log("Error: AdInteraction function callback not subscribed.")},x.prototype.isEventSubscribed_=function(t){return"function"==typeof this.eventCallbacks_[t]},x.prototype.sendPostMessage=function(t){this.frame_.contentWindow.postMessage(t,"*")},x.prototype.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},window.getVPAIDAd=function(){return new x}},,function(t,e,i){"use strict";function n(t){this.setupConfig=t,this.forceShowTrailer=!1,this.baseConfig={debug:!1,mspLink:"",showLog:!1,container:"o-ads-player",key:null,relFrame:!1,rounds:1,playlist:[],base:!0,plyr:!1,plyrYt:!1,dc:!0,cb:null,ml:!0,ref:"",version:"",isp:0,jp:{},instant:!1,backstage:!1,rtm:15,rtm2:42,fbq:4,suri:"",p2p:!1,fle:[],tmts:{evt:30,int:30,sti:30,inst:1}},this.peers=0,this.dlStats={p2p:0,http:0},this.upStats={p2p:0,http:0},this.config={},this.nvpaid=null,this.receviveMessage=function(t){},this.subscribeEvents=["AdsModuleReady","AdStopped","AdLoaded","AdStarted","AdClickThru","AdOnStage","AdImpression"],this.init=function(){this.config=Object.assign({},this.baseConfig,this.setupConfig);try{let t=void 0!==window.isp?window.isp:0;this.config.isp=t}catch(t){}setInterval(function(){try{let t=void 0!==window.isp?window.isp:0;this.config.isp=t,this.nvpaid.setDynamicParam("[isp]",t),this.nvpaid.stageManager.config.isp=t}catch(t){}}.bind(this),100),this.log("setupConfig",this.setupConfig),this.log("baseConfig",this.baseConfig),this.log("config",this.config),this.session=-1==["null",null].indexOf(this.config.cb)?this.config.cb:this.guid(),this.nvpaid=window.getVPAIDAd(),this.subscribeEvents.forEach(function(t){this.nvpaid.subscribe((function(e){"AdsModuleReady"==t?window.parent.postMessage("movieads_ready","*"):"AdStopped"==t?(this.log("AD STOPPED!",this.config.backstage),0==this.config.jp.sova&&(void 0!==e&&"trailer_after_first_block"==e?(this.forceShowTrailer=!0,this.stopOstream(this.config.rtm2)):this.stopOstream()),this.hideContainer(),0==this.config.backstage&&this.playTrailer()):"AdClickThru"==t&&window.parent.postMessage("movieads_adclick","*"),"AdOnStage"==t&&this.showContainer(),"AdImpression"==t&&void 0!==window.ym&&this.log("GOAL REACHED!!!$"),this.receviveMessage(t)}),t,this)}.bind(this)),"string"==typeof this.config.container&&(this.config.container=document.getElementById(this.config.container)),this.config.backstage&&(this.hideContainer(),this.playTrailer());var t=this.config.container.getBoundingClientRect(),e={AdParameters:JSON.stringify(this.buildCreativeData())},i=document.createElement("video");0==t.width?setTimeout(function(){t=this.config.container.getBoundingClientRect(),this.nvpaid.initAd(t.width,t.height,"normal",500,e,{slot:this.config.container,videoSlot:i})}.bind(this),1e3):this.nvpaid.initAd(t.width,t.height,"normal",500,e,{slot:this.config.container,videoSlot:i});var n=((new Date).getTime()-window.movieadsFrameInit.getTime())/1e3;0==this.config.relFrame&&window.movieadsLogger("player_loaded","",JSON.stringify({loadTime:n,version:this.config.version}))},this.log=function(){if(this.config.debug||this.config.showLog){var t=["%cMOVIEADS-PL: ","background-color: DarkTurquoise; color: white; font-weight: bold"],e=Array.prototype.slice.call(arguments);t=t.concat(e),console.log.apply(console,t)}},this.clearContainer=function(){for(;this.config.container.childElementCount>0;)this.config.container.removeChild(this.config.container.firstElementChild)},this.reloadFrame=function(){1==this.config.relFrame?window.location.reload(!0):window.location.href=window.location.href+"&rel=true"},this.stopOstream=function(t){let e=void 0!==t?t:this.config.rtm,i=void 0!==t?"movieads_tlr_top":"movieads_tlr_start";window.parent.postMessage(i,"*"),"movieads_tlr_top"==i&&window.parent.postMessage("movieads_onstage","*"),this.log("RELOAD TIME",e),this.config.instant&&0==this.forceShowTrailer?setTimeout(function(){window.parent.postMessage("movieads_no_more_ads","*"),setTimeout(this.reloadFrame.bind(this),3e3)}.bind(this),1e3*this.config.tmts.inst):(0==this.config.debug&&setTimeout((function(){window.parent.postMessage("movieads_no_more_ads","*")}),1e3*e),setTimeout(function(){0==this.config.debug&&(1==this.config.p2p?setTimeout(this.reloadFrame.bind(this),1e3):this.reloadFrame())}.bind(this),1e3*(e+7)))},this.createVideoElem=function(t,e){"string"==typeof t&&(t=document.getElementById(t));var i=document.createElement("div");i.style.width="100%",i.style.height="100%";var n=document.createElement("video");return n.setAttribute("id","mads-player-video"),n.style.width="100%",n.style.height="100%",n.volume=0,n.muted=!0,(void 0===e||void 0!==e&&1==e)&&(n.autoplay=!0),n.setAttribute("playsinline","playsinline"),this.log(1),i.appendChild(n),this.log(2,t),t.appendChild(i),this.log(3,t),{player:n,wrapper:i}},this.initPlyrFloader=function(t){this.log("initPlyr P2P",t);let e=this.createVideoElem(this.config.playerContainer,!1);if(e.player.style.display="",this.player=new Plyr("#mads-player-video",{title:t.title,controls:["progress","current-time","duration","mute","volume","captions","fullscreen"],autoplay:!0,volume:0,muted:!0,storage:{enabled:!1}}),Hls.isSupported()){var i=new Hls({liveSyncDurationCount:7,enableWorker:!1,fLoader:window.fLoader});i.loadSource(t.hls),i.attachMedia(e.player),i.on(Hls.Events.MANIFEST_PARSED,()=>{this.hlsLevelSwitcher.init(i,level)})}else e.player.src=t.file;setTimeout(function(){this.player.play()}.bind(this),1e3)},this.initPlyrP2P=function(t){this.log("initPlyr P2P",t);let e=this.createVideoElem(this.config.playerContainer,!1);if(e.player.style.display="",this.player=new Plyr("#mads-player-video",{title:t.title,controls:["progress","current-time","duration","mute","volume","captions","fullscreen"],autoplay:!0,volume:0,muted:!0,storage:{enabled:!1}}),Hls.isSupported()&&p2pml.hlsjs.Engine.isSupported()){var i=new p2pml.hlsjs.Engine({loader:{trackerAnnounce:["wss://tracker.openwebtorrent.com"],simultaneousP2PDownloads:20,httpDownloadInitialTimeout:6e3,httpDownloadInitialTimeoutPerSegment:2e3}});i.createLoaderClass(),i.loader.on(p2pml.core.Events.PieceBytesDownloaded,function(t,e,i){this.dlStats[t]+=e}.bind(this)),i.loader.on(p2pml.core.Events.PieceBytesUploaded,function(t,e,i){this.upStats[t]+=e}.bind(this)),i.loader.on(p2pml.core.Events.PeerConnect,function(t){this.peers++}.bind(this)),i.loader.on(p2pml.core.Events.PeerClose,function(t){this.peers--}.bind(this));var n=new Hls({liveSyncDurationCount:3,loader:i.createLoaderClass()});p2pml.hlsjs.initHlsJsPlayer(n),n.loadSource(t.hls),n.attachMedia(e.player),n.on(Hls.Events.MANIFEST_PARSED,()=>{this.hlsLevelSwitcher.init(n,level)}),setInterval(function(){this.log("P2P STATS",this.dlStats,this.upStats,this.peers),window.movieadsLogger("p2p","stats",JSON.stringify({p2p:this.dlStats.p2p,http:this.dlStats.http,peers:this.peers})),this.dlStats={p2p:0,http:0}}.bind(this),5e3)}else e.player.src=t.file;setTimeout(function(){this.player.play()}.bind(this),1e3)},this.initPlyrYoutube=function(t){let e=document.createElement("div");e.setAttribute("id","mads-player-video"),e.style.width="100%",e.style.height="100%",e.setAttribute("data-plyr-provider","youtube"),e.setAttribute("data-plyr-embed-id",t);let i=this.config.playerContainer;"string"==typeof i&&(i=document.getElementById(i)),i.appendChild(e),this.player=new Plyr("#mads-player-video",{controls:["progress","current-time","duration","mute","volume","captions","fullscreen"],autoplay:!0,volume:0,muted:!0,ratio:"16:9",storage:{enabled:!1},loop:{active:!0},youtube:{noCookie:!0,rel:0,showInfo:0,iv_load_policy:3,modestbranding:1,disablekb:1,controls:0,autoplay:1}}),setTimeout(function(){this.player.play()}.bind(this),1e3)},this.initPlyr=function(t){this.log("initPlyr",t);let e=this.createVideoElem(this.config.playerContainer,!1);e.player.src=t.file,e.player.style.display="";let i=new Plyr("#mads-player-video",{title:t.title,controls:["progress","current-time","duration","mute","volume","captions","fullscreen"],autoplay:!0,volume:0,muted:!0,storage:{enabled:!1}});setTimeout((function(){i.play()}),1e3),i.on("ended",function(){1==this.config.jp.sova&&(1==this.config.relFrame?window.location.reload(!0):window.location.href=window.location.href+"&rel=true")}.bind(this))},this.initTrailerPlayer=function(t){let e=this.createVideoElem(this.config.container);e.player.addEventListener("canplay",function(t){t.target.paused&&e.player.play().then().catch(function(t){this.log("video play failed",t)}.bind(this))}.bind(this)),this.log(t),e.player.src=t.file,e.player.style.display=""},this.playTrailer=function(){if(this.config.instant&&0==this.forceShowTrailer)return;this.log(1,this.config.playlist),0==this.config.playlist.length&&this.stopOstream();let t=this.shuffle(this.config.playlist),e=t.splice(0,1);this.log(2,this.config.playlist),this.log(3,t),this.log(4,e),this.clearContainer(),this.log("plyr",this.config.plyr),1==this.config.plyrFl?this.initPlyrFloader(e[0]):1==this.config.p2p?this.initPlyrP2P(e[0]):1==this.config.plyr||1==this.config.jp.sova?this.initPlyr(e[0]):1==this.config.plyrYt?this.initPlyrYoutube(e[0]):this.initTrailerPlayer(e[0])},this.shuffle=function(t){var e,i,n;for(n=t.length-1;n>0;n--)e=Math.floor(Math.random()*(n+1)),i=t[n],t[n]=t[e],t[e]=i;return t},this.buildCreativeData=function(){let t={key:this.config.key,session:this.session,testad:!1,it:1,tq:2,mips:500,isp:this.config.isp,debug:this.config.debug,sl:this.config.showLog,jmap:this.buildJmap(),rounds:this.config.rounds,dc:this.config.dc,disableLogger:this.config.ml,sid:this.config.jp.sid,ap:!("preloader"==this.config.jp.sid),mstream:!0,relFrame:this.config.relFrame,fbq:this.config.fbq,sova:this.config.jp.sova?"yes":"no",rcnt:this.config.jp.rcnt,instant:this.config.instant,mspLink:this.config.mspLink,ma:this.config.jp.ma,fle:this.config.fle};return"workingStagesNum"in this.config&&(t.workingStagesNum=this.config.workingStagesNum),"ima"in this.config&&(t.ima=this.config.ima),t},this.buildJmap=function(){var t={v:this.config.key,"cp.referer":""!=this.config.ref?this.config.ref:document.referrer,it:1,tq:2,"cp.cb":this.guid(),session:this.session,position:"pre",vt:"[vt]",ostream:"true",b:this.config.debug||this.config.showLog?0:1,isp:this.config.isp,suri:this.config.suri};0!=this.config.jp.ma&&(t.ma=this.config.jp.ma),0==this.config.dc&&(t.raw="yes"),t=Object.assign({},t,this.config.jp);var e=[];for(var i in t)"swapDict"!=i&&e.push(i+"="+encodeURIComponent(t[i]));var n=e.join("&");return"https://"+(this.config.debug?"c1.moviead55.ru":"code.moviead55.ru")+"/jmap.php?"+n},this.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.extend=function(){let t={};Object.keys(arguments[0]).forEach((function(e,i,n){t[e]=arguments[0][e]}));for(var e=1;e<arguments.length;e++)for(var i in arguments[e])t[i]=arguments[e][i];return t},this.showContainer=function(){this.log("SHOW CONTAINER"),this.config.container.style.zIndex="1000",this.config.container.style.opacity=1,this.config.container.style.pointerEvents=""},this.hideContainer=function(){this.config.container.style.zIndex="1",this.config.container.style.opacity=0,this.config.container.style.pointerEvents="none"},this.init()}i.r(e),i(14),e.default=n,window.oStreamAds=n,window.player=new n(window.madsConfig)}]);